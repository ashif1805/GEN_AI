ace.querySql.searchEntityAlt=select distinct p.ALT_IDENTIFIER,p.ssn,\
  \ p.first_name, p.last_name from dbo.person p \
  inner join dbo.member m on m.person_id=p.person_id \
  inner join dbo.member_contract mc on mc.member_id=m.member_id \
  inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
  inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
  inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
  inner join dbo.product pd on pd.product_id=be.product_id \
  inner join dbo.plan pl on pl.plan_id=mc.plan_id where pbt.internal_name =?1 and mc.enable_self_service_access ='Y' and rownum=1
ace.querySql.personProfile=select distinct p.alt_identifier,p.ssn,p.first_name,p.last_name,p.sex,p.birth_date from dbo.person p Where p.alt_identifier=?1

ace.querySql.APISearchEntity=select distinct mc.code_01 lockin ,p.ssn ,p.alt_identifier ,p.last_name ,p.first_name ,p.birth_date dob ,p.sex gender \
  from dbo.member m \
  inner join dbo.person p \
  on p.person_id = m.person_id \
  inner join dbo.member_contract mc \
  on mc.member_id = m.member_id \
  inner join dbo.billing_entity be \
  on mc.billing_id = be.billing_id \
  and mc.employer_id = be.employer_id \
  inner join dbo.product_benefit_type pbt \
  on pbt.product_benefit_type_id = be.product_benefit_type_id  \
  where pbt.internal_name = 'STRUCTURED' \
  and p.status='L' and mc.member_contract_code_01='IP' and rownum<3

ace.querySql.DeceasedAnnuitantWInitiaLJA=SELECT  \
p.alt_identifier,  \
mc.member_contract_id,  \
pa.application_id  \
FROM  \
dbo.member m  \
JOIN dbo.member_contract      mc ON mc.member_id = m.member_id  \
JOIN dbo.billing_entity       be ON be.billing_id = mc.billing_id  \
AND be.employer_id = mc.employer_id  \
JOIN dbo.product              pr ON pr.product_id = be.product_id  \
JOIN dbo.product_benefit_type pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
AND pbt.internal_name = 'CLOSEOUTS'  \
JOIN dbo.person               p ON p.person_id = m.person_id  \
AND p.status <> 'L'  \
  \
JOIN dbo.pension_application  pa ON pa.member_contract_id = mc.member_contract_id  \
AND pa.status_id = 133  \
JOIN dbo.business_entity_relation   ber ON ber.key_value = m.person_id  \
JOIN dbo.business_entity_key        bek ON bek.business_entity_key_id = ber.business_entity_key_id  \
JOIN dbo.entity_relationship        er ON ber.entity_relationship_id = er.entity_relationship_id  \
AND er.entity_relationship_id = 2 FETCH FIRST 8 ROWS only

ace.querySql.InPayAnnuitantTwoBene= SELECT  \
p.alt_identifier,  \
mc.member_contract_id,  \
COUNT(bek.business_entity_key_id) no_of_beneficiaries  \
FROM  \
dbo.member m  \
JOIN dbo.member_contract             mc ON mc.member_id = m.member_id  \
JOIN dbo.business_entity_relation    ber ON ber.source_key_value = mc.member_contract_id  \
JOIN dbo.entity_relationship         er ON er.entity_relationship_id = ber.entity_relationship_id  \
AND er.entity_relationship_id = 3  \
JOIN dbo.business_entity_key         bek ON bek.business_entity_key_id = ber.business_entity_key_id  \
JOIN dbo.person                      p ON p.person_id = m.person_id  \
GROUP BY  \
p.alt_identifier,  \
mc.member_contract_id  \
HAVING  \
COUNT(bek.business_entity_key_id) = 2 FETCH FIRST 2 ROWS only


ace.querySql.InPayAnnuitantTwoBeneBulk= SELECT    \
p.alt_identifier,  \
mc.member_contract_id,  \
COUNT(bek.business_entity_key_id) no_of_beneficiaries  \
FROM  \
dbo.member m  \
JOIN dbo.member_contract          mc ON mc.member_id = m.member_id  \
AND mc.benefit_payment_type = 'B'  \
JOIN dbo.business_entity_relation ber ON ber.source_key_value = mc.member_contract_id  \
JOIN dbo.entity_relationship      er ON er.entity_relationship_id = ber.entity_relationship_id  \
AND er.entity_relationship_id = 3  \
JOIN dbo.business_entity_key      bek ON bek.business_entity_key_id = ber.business_entity_key_id  \
JOIN dbo.person                   p ON p.person_id = m.person_id  \
GROUP BY  \
p.alt_identifier,  \
mc.member_contract_id  \
HAVING  \
COUNT(bek.business_entity_key_id) = 2 FETCH FIRST 2 ROWS only

ace.querySql.deathNotificationDetails=select pbt.internal_name,\
    be.billing_entity_code                                                              gac,\
    be.billing_entity_name, 'Annuitant'                                                                         role,\
    p.alt_identifier,\
    mc.member_contract_id,\
    p.first_name                                                                        first_name,\
    p.middle_name                                                                       middle_name,\
    p.last_name                                                                         last_name,\
    decode(p.status, 'L', 'Living', 'D', 'Deceased',\
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record',\
           p.status)                                                                    life_status,\
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',\
           'D', 'Disability', 'IP',\
           'Immediate Pay',\
           'R',\
           'Retired',\
           'S',\
           'Survivor',\
           'T',\
           'Terminated',\
           'TV',\
           'Term Vested',\
           mc.member_contract_status)                                                   employment_status,\
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',\
           'D', 'Deferred', 'H', 'Hold', 'P',\
           'Pending',\
           mc.member_contract_code_01)                                                  pay_status,\
    pa.pension_effective_date                                                           annuity_commencement_date,\
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',\
           'S', 'On Hold', 'C', 'Complete', 'QP',\
           'Queued',\
           'OF',\
           'OFAC On Hold',\
           'AP',\
           'Approval Pending',\
           'P',\
           'Pending',\
           'DR',\
           'Draft',\
           'D',\
           'Denied',\
           ds.sched_status)                                                             status,\
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',\
           'RE', 'Rejected EFTs', 'PD',\
           'Presumed Dead',\
           'D',\
           'Death',\
           'DO',\
           'Death-Overpaid',\
           'R',\
           'Reported for Escheatment',\
           'LH',\
           'Legal Hold',\
           'BH',\
           'Broker Hold',\
           'O',\
           'Other',\
           'W',\
           'Write Off',\
           'EX',\
           'Expired',\
           'IP',\
           'Immediate Pay',\
           'AC',\
           'Application Cancelled',\
           'PI',\
           'Paid in IP',\
           'AR',\
           'Approval Reversed',\
           'IB',\
           'Ineligible for Benefit',\
           'IR',\
           'IP - Revision',\
           'UL',\
           'Unable to Locate',\
           'MR',\
           'Missing Required Info',\
           'EL',\
           'Elimination of Liability Clause',\
           'RC',\
           'Remarriage Clause',\
           'FC',\
           'Full Commutation',\
           'PC',\
           'Partial Commutation',\
           'CS',\
           'Child Support Lien Network',\
           'PQ',\
           'Pending IPAQS Exclusion Ratio Calc',\
           'EU',\
           'Escheating - Uncashed checks',\
           'ER',\
           'Escheating - Rejected EFT',\
           'TE',\
           'Escheated - Terminal Age',\
           'ED',\
           'Escheating - Benefit Deferred',\
           'EB',\
           'Escheating - Benefit Refused',\
           'EI',\
           'Escheating - Insufficient Data',\
           'EN',\
           'Escheating - No Contact',\
           'EP',\
           'Escheating - No Response',\
           'ES',\
           'Escheating - Death Process',\
           'EG',\
           'Escheating - Ret Pkg NIGO',\
           'ET',\
           'Escheating - Ret Pkg Not Returned',\
           'EK',\
           'Escheating - Client Directed',\
           'EC',\
           'Escheating - Client Directed',\
           'FL',\
           'Failure to Provide Proof of Life',\
           ds.sched_status_reason_code)                                                 status_reason,\
    pr.short_name,\
    p.death_date                                                                        death_date,\
    p.death_notification_date                                                           death_reporting_date,\
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice',\
           'RM', 'Returned Mail',\
           'EO',\
           'EDM Other',\
           'OT',\
           'Other',\
           'ES',\
           'EDM SSA/LN',\
           'DE',\
           'Data Enrichment',\
           p.death_notification_source)                                                 death_posted_by,\
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',\
           mc.benefit_payment_type)                                                     payment_type,\
    pa.application_id \
from \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
where \
    pbt.internal_name IN ( 'CLOSEOUTS' ) and mc.member_contract_code_01='IP' and mc.benefit_payment_type='B' and ds.sched_status='A' and p.status='L'  FETCH First 3 ROWS ONLY





ace.querySql.livingSSAnnuitant=SELECT \
    pbt.internal_name, \
    be.billing_entity_code                                                              gac, \
    be.billing_entity_name, \
    'Annuitant'                                                                         role, \
    p.alt_identifier, \
    mc.member_contract_id, \
    p.first_name                                                                        first_name, \
    p.middle_name                                                                       middle_name, \
    p.last_name                                                                         last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                                                                    life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
           'Immediate Pay', \
           'R', \
           'Retired', \
           'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)                                                   employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
           mc.member_contract_code_01)                                                  pay_status, \
    pa.pension_effective_date                                                           annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                                                             status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', 'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)                                                 status_reason, \
    pr.short_name, \
    p.death_date                                                                        death_date, \
    p.death_notification_date                                                           death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', 'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)                                                 death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)                                                     payment_type, \
    pa.application_id \
FROM \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'STRUCTURED' )  and mc.member_contract_code_01='IP' and mc.benefit_payment_type='D' and ds.sched_status='A' and p.status='L' ORDER BY DBMS_RANDOM.value FETCH FIRST 2 ROWS only  



ace.querySql.SecondaryJoint=SELECT er.internal_name AS person_type, p.alt_identifier AS secondary_alt_id, a.alt_identifier AS annuitant_alt_id, pdt.long_name    AS product_name, pbt.display_name AS product_benefit_type FROM   dbo.person p INNER JOIN business_entity_relation BER ON BER.business_entity_key_id = P.business_entity_key_id INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id INNER JOIN member_contract mc ON mc.member_contract_id = ber.source_key_value AND BER.source_entity_id = 798 INNER JOIN pension_application pa ON pa.member_id=mc.member_id INNER JOIN person a ON a.person_id = ber.key_value AND ber.entity_id = 254 \
INNER JOIN billing_entity be ON mc.billing_id = be.billing_id INNER JOIN product pdt ON pdt.product_id = be.product_id INNER JOIN product_benefit_type pbt ON pbt.product_benefit_type_id = pdt.product_benefit_type_id WHERE  er.internal_name = 'JOINT_ANNUITANT' AND a.status = 'D' \
AND mc.member_contract_code_01 = 'C' AND pdt.short_name LIKE '%MLIC%' AND pa.status_id=133 \
AND pbt.internal_name = ?1 ORDER BY DBMS_RANDOM.value FETCH FIRST 1 ROWS only 



ace.querySql.SecondaryBene=SELECT er.internal_name AS person_type, p.alt_identifier AS secondary_alt_id, a.alt_identifier AS annuitant_alt_id, pdt.long_name    AS product_name, pbt.display_name AS product_benefit_type FROM   dbo.person p INNER JOIN business_entity_relation BER ON BER.business_entity_key_id = P.business_entity_key_id INNER JOIN entity_relationship ER ON ER.entity_relationship_id = BER.entity_relationship_id INNER JOIN member_contract mc ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 INNER JOIN pension_application pa ON pa.member_id=mc.member_id INNER JOIN person a ON a.person_id = ber.key_value AND mc.member_contract_status!='IP' AND ber.entity_id = 254 INNER JOIN billing_entity be ON mc.billing_id = be.billing_id INNER JOIN product pdt \
ON pdt.product_id = be.product_id INNER JOIN product_benefit_type pbt ON pbt.product_benefit_type_id = pdt.product_benefit_type_id INNER JOIN beneficiary ben ON ben.person_id=a.person_id WHERE  er.internal_name = 'BENEFICIARY' AND a.status = 'D' AND mc.member_contract_code_01 = 'C' AND pdt.short_name LIKE '%MLIC%' AND ben.percent  IN (0,100) AND pa.status_id=133 AND pbt.internal_name = ?1 ORDER BY DBMS_RANDOM.value FETCH FIRST 1 ROWS only



ace.querySql.IIACaseActivatedAnnuitant =  SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL -- do not pick up secondary applications \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
                    AND ps.pension_status_code NOT IN ('SS_CANCELLED',	\
                                                'SS_NOT_TAKEN',	\
                                                'SS_UNLOCKED')	\
              where pbt.internal_name = 'IIA'\
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R'\
              and v.status='L'; 

ace.querySql.manualDeathLifeAnnuity = SELECT unique PER.ALT_IDENTIFIER as ALT_IDENTIFIER, \
 per.ssn SSN,per.first_name,PER.LAST_NAME,PBT.INTERNAL_NAME PRODUCT_NAME,BIL.BILLING_ENTITY_CODE GROUP_NUMBER,\
 BIL.BILLING_ENTITY_NAME GROUP_NAME,PS.STATUS_NAME PENSION_STATUS, pay.payment_form_name FOA, pay.joint_percent_death Joint_Percentage, \
    (case DISC.sched_status \
				when 'A' then 'In Pay' \
				when 'DR' then 'Draft' \
				when 'D' then 'Denied' \
				when 'V' then 'Void'   \
				when 'P' then 'Pending'\
				when 'S' then 'On Hold'\
				when 'C' then 'Complete'\
				when 'QP' then 'Queued'\
				when 'AP' then 'Approval Pending' \
				when 'OF' then 'OFAC On Hold' \
				Else 'Deferred' end)as STATUS, \
				PER.birth_date DOB \
  FROM DBO.PERSON PER \
  JOIN DBO.MEMBER MEM ON MEM.PERSON_ID=PER.PERSON_ID \
  JOIN DBO.MEMBER_CONTRACT MC ON MC.MEMBER_ID=MEM.MEMBER_ID \
  JOIN DBO.BILLING_ENTITY BIL ON MC.BILLING_ID= BIL.BILLING_ID \
  left JOIN DBO.PENSION_APPLICATION PA ON MC.member_contract_id = PA.member_contract_id \
  LEFT join DBO.PENSION_STATUS PS ON PA.STATUS_ID = PS.STATUS_ID \
  left join dbo.payment_form pay ON pa.application_id = pay.pension_application_id \
  left join dbo.disburse_schedule DISC on PA.application_id = DISC.source_key \
  JOIN DBO.PRODUCT_BENEFIT_TYPE PBT on PBT.PRODUCT_BENEFIT_TYPE_ID = BIL.PRODUCT_BENEFIT_TYPE_ID \
  WHERE \
  BIL.BILLING_ENTITY_CODE=?1 \
  and mc.member_contract_status NOT in ('IP') \
  and pay.payment_form_name in ('Life Annuity') \
  and DISC.sched_status NOT in ('C') \
  and PER.DEATH_DATE IS NULL \
  and PS.STATUS_NAME ='Approved' \
  and PER.PRIMARY_IDENTIFIER_ID in('10') \
  and PER.ALT_IDENTIFIER not in ('7611041191')\
  and ROWNUM <=1 \ 

ace.querySql.IIACaseActivatedAnnuitantLivingUS = SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL \
AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
AND ps.pension_status_code NOT IN ('SS_CANCELLED', \
'SS_NOT_TAKEN', \
'SS_UNLOCKED') \
where pbt.internal_name = 'IIA' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
  
ace.querySql.IIACaseActivatedAnnuitantDeceasedUS = SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL \
AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
AND ps.pension_status_code NOT IN ('SS_CANCELLED', \
'SS_NOT_TAKEN', \
'SS_UNLOCKED') \
where pbt.internal_name = 'IIA' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='D' \
  

ace.querySql.IIACaseActivatedAnnuitantLivingNonUS =  SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
from   dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL \
AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
AND ps.pension_status_code NOT IN ('SS_CANCELLED', \
'SS_NOT_TAKEN', \
'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value \
and a.country <>'US' \
and a.stop_date is null \
and a.address_type='R' \
where pbt.internal_name = 'IIA' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
  
ace.querySql.IIACaseActivatedAnnuitantNonUSDeceased =  SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
from   dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL \
AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
AND ps.pension_status_code NOT IN ('SS_CANCELLED', \
'SS_NOT_TAKEN', \
'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value \
and a.country <>'US' \
and a.stop_date is null \
and a.address_type='R' \
where pbt.internal_name = 'IIA' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='D' \

ace.querySql.IIACaseActivatedAnnuitantUS =  SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
                    AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED')	\
              inner join dbo.addresses a on v.person_id=a.key_value \
              where pbt.internal_name = 'IIA'\
              and bek.search_text_02 is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R'\
              and v.status='L' \
			  and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \
              and a.country = 'US'

ace.querySql.CONONUSCaseActivatedAnnuitant = SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
                    AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
              inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country <>'US' and a.stop_date is null  \
                    and a.address_type='R' \
              where pbt.internal_name = 'CLOSEOUTS' \
              and bek.search_text_02 is null \
              and a.address_2 is null \
              and a.address_3 is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' and v.status='L' \
              and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \
  
ace.querySql.SSACaseActivatedAnnuitant = SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
             from   dbo.V_ANNUITANT v  \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
              and v.alt_identifier = bek.alt_key_code  \
			   inner join dbo.person p on v.person_id=p.person_id \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID  \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
                    inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
                    inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
                    inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
                    AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED')	\
              where pbt.internal_name = 'STRUCTURED' \
              and bek.search_text_02 is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' \
			  and p.primary_identifier_id !=40 \
              and v.status='L' \
              and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \


ace.querySql.IIANONUSCaseActivatedAnnuitant = SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
                    AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
              inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country <>'US' and a.stop_date is null  \
                    and a.address_type='R' \
              where pbt.internal_name = 'IIA' \
              and a.address_2 is null \
              and a.address_3 is null \
              and bek.search_text_02 is null \
               and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' and v.status='L' \
              and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \ 

ace.querySql.CloseoutCaseactivation=  SELECT distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek \
                    on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
              inner join dbo.MEMBER_CONTRACT mc \
                    on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa \
                    on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
              inner join dbo.disburse_schedule ds \
                    on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be \
                    on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt \
                    on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps \
                    on ps.status_id = pa.status_id \
                    inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country ='US' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'CLOSEOUTS' \
                and mc.member_contract_code_04 in ('II', 'AF') \
              and pa.parent_application_id is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' \
               and bek.search_text_02 is null \
                and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED') \
                and v.status='L' \
                and v.PREFIX is null \
			    and v.SUFFIX is null \
				and v.SORT_NAME NOT LIKE '%-%' \
				and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \



ace.querySql.NonUSSSACaseactivation= SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
              inner join dbo.person p on v.person_id=p.person_id \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
              AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
            inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country <> 'US' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'STRUCTURED' \
              and a.address_2 is null \
              and a.address_3 is null \
              and bek.search_text_02 is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' \
              and v.status='L' \
              and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \
              and p.primary_identifier_id !=40 

ace.querySql.manualDeathJnS =SELECT unique PER.ALT_IDENTIFIER as ALT_IDENTIFIER, \
per.ssn SSN,per.first_name,PER.LAST_NAME,PBT.INTERNAL_NAME PRODUCT_NAME, \
BIL.BILLING_ENTITY_CODE GROUP_NUMBER,BIL.BILLING_ENTITY_NAME GROUP_NAME,PS.STATUS_NAME PENSION_STATUS, \
pay.payment_form_name FOA,pay.joint_percent_death Joint_Percentage,PER.PRIMARY_IDENTIFIER_ID, \
(case DISC.sched_status \
				when 'A' then 'In Pay'  \
				when 'DR' then 'Draft' \
				when 'D' then 'Denied' \
				when 'V' then 'Void'  \
				when 'P' then 'Pending' \
				when 'S' then 'On Hold' \
				when 'C' then 'Complete'\
				when 'QP' then 'Queued' \
				when 'AP' then 'Approval Pending' \
				when 'OF' then 'OFAC On Hold' \
				Else 'Deferred' end)as STATUS, \
PER.birth_date DOB \
FROM DBO.PERSON PER \
JOIN DBO.MEMBER MEM ON MEM.PERSON_ID=PER.PERSON_ID \
JOIN DBO.MEMBER_CONTRACT MC ON MC.MEMBER_ID=MEM.MEMBER_ID \
join DBO.BILLING_ENTITY BIL ON MC.BILLING_ID= BIL.BILLING_ID \
left JOIN DBO.PENSION_APPLICATION PA ON MC.member_contract_id = PA.member_contract_id \
LEFT join DBO.PENSION_STATUS PS ON PA.STATUS_ID = PS.STATUS_ID \
left join dbo.payment_form pay ON pa.application_id = pay.pension_application_id \
left join dbo.disburse_schedule DISC on PA.application_id = DISC.source_key \
JOIN DBO.PRODUCT_BENEFIT_TYPE PBT on PBT.PRODUCT_BENEFIT_TYPE_ID = BIL.PRODUCT_BENEFIT_TYPE_ID \
WHERE BIL.BILLING_ENTITY_CODE=?1 \
and mc.member_contract_status NOT in ('IP') \
and pay.payment_form_name like ('%Joint%') \
and DISC.sched_status NOT in ('C') \
and PER.DEATH_DATE IS NULL \
and PS.STATUS_NAME ='Approved' \
and PER.PRIMARY_IDENTIFIER_ID in('10') \
and pay.joint_percent_death like ?2 \
and ROWNUM <=1 \                   \

ace.querySql.Deferred=SELECT  \
	distinct be.billing_entity_code                  gac,  \
    pbt.internal_name,  \
    be.billing_entity_name,  \
    'Annuitant'                             role,  \
    p.alt_identifier,  \
    mc.member_contract_id,    \
    p.first_name                            first_name,  \
    p.middle_name                           middle_name,  \
    p.last_name                             last_name,   \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',  'PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
           p.status)                        life_status,  \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',  \
           'D', 'Disability', 'IP',  \
           'Immediate Pay', \
           'R',  \
           'Retired',  \
           'S',  \
           'Survivor',   \
           'T',  \
           'Terminated',  \
           'TV',  \
           'Term Vested', \
           mc.member_contract_status)       employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',  \
           'D', 'Deferred', 'H', 'Hold', 'P',   \
           'Pending',  \
           mc.member_contract_code_01)      pay_status,  \
    pa.pension_effective_date               annuity_commencement_date,  \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',  \
           'S', 'On Hold', 'C', 'Complete', 'QP',   \
           'Queued',  \
           'OF',  \
           'OFAC On Hold',  \
           'AP',  \
           'Approval Pending',  \
           'P',  \
           'Pending',  \
           'DR',  \
           'Draft',  \
           'D', \
           'Denied',  \
           ds.sched_status)                 status,  \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',   \
           'RE', 'Rejected EFTs',  \
           'PD',  \
           'Presumed Dead',  \
           'D',  \
           'Death',  \
           'DO',  \
           'Death-Overpaid',  \
           'R',  \
           'Reported for Escheatment',   \
           'LH',   \
           'Legal Hold',  \
           'BH',  \
           'Broker Hold',  \
           'O',   \
           'Other',  \
           'W',  \
           'Write Off',  \
           'EX', \
           'Expired',   \
           'IP',  \
           'Immediate Pay',  \
           'AC',  \
           'Application Cancelled',  \
           'PI',  \
           'Paid in IP',  \
           'AR',  \
           'Approval Reversed',  \
           'IB',  \
           'Ineligible for Benefit',   \
           'IR',  \
           'IP - Revision',  \
           'UL',  \
           'Unable to Locate',  \
           'MR', \
           'Missing Required Info',   \
           'EL',  \
           'Elimination of Liability Clause',   \
           'RC',   \
           'Remarriage Clause',  \
           'FC',  \
           'Full Commutation',  \
           'PC',  \
           'Partial Commutation',  \
           'CS',  \
           'Child Support Lien Network',  \
           'PQ',  \
           'Pending IPAQS Exclusion Ratio Calc',  \
           'EU',  \
           'Escheating - Uncashed checks',  \
           'ER',  \
           'Escheating - Rejected EFT',  \
           'TE',  \
           'Escheated - Terminal Age',  \
           'ED',  \
           'Escheating - Benefit Deferred',  \
           'EB',  \
           'Escheating - Benefit Refused',  \
           'EI',  \
           'Escheating - Insufficient Data',  \
           'EN',  \
           'Escheating - No Contact',  \
           'EP',  \
           'Escheating - No Response',  \
           'ES', \
           'Escheating - Death Process',   \
           'EG',  \
           'Escheating - Ret Pkg NIGO',  \
           'ET',   \
           'Escheating - Ret Pkg Not Returned', \
           'EK',  \
           'Escheating - Client Directed',  \
           'EC',  \
           'Escheating - Client Directed',   \
           'FL',  \
           'Failure to Provide Proof of Life',  \
           ds.sched_status_reason_code)     status_reason,  \
    pr.short_name,  \
    p.death_date                            death_date,  \
    p.death_notification_date               death_reporting_date,  \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice',  \
           'RM',   \
           'Returned Mail',  \
           'EO',  \
           'EDM Other',  \
           'OT',  \
           'Other',  \
           'ES',  \
           'EDM SSA/LN',   \
           'DE',   \
           'Data Enrichment',   \
           p.death_notification_source)     death_posted_by,  \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',  \
           mc.benefit_payment_type)         payment_type,  \
    pa.application_id,  \
    pf.payment_form_name   \
FROM \
         dbo.member m  \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id  \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id  \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id  \
                                  AND be.employer_id = mc.employer_id   \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id   \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id   \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id  \
                                AND pf.selected_flag = 'Y'  \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id  \
WHERE  \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status  IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'D' \
    AND mc.member_contract_code_01 = 'D' \
    AND p.status='L' \
    AND p.death_date IS NULL \
    AND p.death_notification_date IS NULL \
    AND p.death_notification_source IS NULL \
    AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    AND  pf.payment_form_name NOT IN( 'Life Annuity','120 Months Term Certain and Life Annuity','100 % Joint and Survivor Life Annuity', '50 % Joint and Survivor Life Annuity') ORDER BY DBMS_RANDOM.value FETCH FIRST 1 ROWS only 

ace.querySql.AnnuitantJointAnnuitantInPay=SELECT  \
    distinct be.billing_entity_code                  gac,  \
    pbt.internal_name,     be.billing_entity_name,  \
    'Annuitant'                             role,  \
    p.alt_identifier,   \
    mc.member_contract_id,   \
    p.first_name                            first_name,   \
    p.middle_name                           middle_name,  \
    p.last_name                             last_name,   \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',   \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
           p.status)                        life_status,  \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',  \
           'D', 'Disability', 'IP',   \
           'Immediate Pay', 'R',   \
           'Retired',   \
           'S',    \
           'Survivor',   \
           'T',   \
           'Terminated',  \
           'TV',    \
           'Term Vested',    \
           mc.member_contract_status)       employment_status,  \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',  \
           'D', 'Deferred', 'H', 'Hold', 'P',  \
           'Pending',    \
           mc.member_contract_code_01)      pay_status,   \
    pa.pension_effective_date               annuity_commencement_date,   \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',  \
           'S', 'On Hold', 'C', 'Complete', 'QP',  \
           'Queued',  \
           'OF',  \
           'OFAC On Hold',   \
           'AP',   \
           'Approval Pending',  \
           'P',   \
           'Pending',  \
           'DR',  \
           'Draft',   \
           'D',     \
           'Denied',    \
           ds.sched_status)                 status,   \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',   \
           'RE', 'Rejected EFTs',   \
           'PD',     \
           'Presumed Dead',    \
           'D',    \
           'Death',   \
           'DO',   \
           'Death-Overpaid',  \
           'R',  \
           'Reported for Escheatment',   \
           'LH',      \
           'Legal Hold',    \
           'BH',    \
           'Broker Hold',    \
           'O',     \
           'Other',     \
           'W',    \
           'Write Off',     \
           'EX',      \
           'Expired',    \
           'IP',      \
           'Immediate Pay',   \
           'AC',      \
           'Application Cancelled',   \
           'PI',   \
           'Paid in IP',   \
           'AR',    \
           'Approval Reversed',    \
           'IB',    \
           'Ineligible for Benefit',   \
           'IR',      \
           'IP - Revision',   \
           'UL',   \
           'Unable to Locate',  \
           'MR',    \
           'Missing Required Info',   \
           'EL',     \
           'Elimination of Liability Clause',   \
           'RC',   \
           'Remarriage Clause',   \
           'FC',   \
           'Full Commutation',   \
           'PC',  \
           'Partial Commutation',  \
           'CS',  \
           'Child Support Lien Network',  \
           'PQ',  \
           'Pending IPAQS Exclusion Ratio Calc',  \
           'EU',  \
           'Escheating - Uncashed checks',  \
           'ER',  \
           'Escheating - Rejected EFT',  \
           'TE', \
           'Escheated - Terminal Age',  \
           'ED',  \
           'Escheating - Benefit Deferred',  \
           'EB',  \
           'Escheating - Benefit Refused',  \
           'EI',  \
           'Escheating - Insufficient Data',\
           'EN',\
           'Escheating - No Contact',  \
           'EP',  \
           'Escheating - No Response',  \
           'ES',  \
           'Escheating - Death Process',  \
           'EG',  \
           'Escheating - Ret Pkg NIGO',  \
           'ET',  \
           'Escheating - Ret Pkg Not Returned',  \
           'EK',  \
           'Escheating - Client Directed',\
           'EC',  \
           'Escheating - Client Directed',  \
           'FL',  \
           'Failure to Provide Proof of Life',  \
           ds.sched_status_reason_code)     status_reason, \
    pr.short_name, \
    p.death_date                            death_date, \
    p.death_notification_date               death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', \
           'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN',  \
           'DE',  \
           'Data Enrichment',  \
           p.death_notification_source)     death_posted_by,  \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',  \
           mc.benefit_payment_type)         payment_type,  \
    pa.application_id,  \
    pf.payment_form_name, plan_identifier, pl.plan_name \
FROM  \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id   \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id   \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id   \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'D' AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' \
      AND p.status='L' \
    AND ds.sched_status= 'A' \
  AND  pf.payment_form_name  = '100 % Joint and Survivor Life Annuity' \
UNION ALL \
SELECT  \
    pbt.internal_name,  \
    be.billing_entity_code                  gac,    be.billing_entity_name,  \
    er.entity_relationship_name             role, \
    p.alt_identifier,  \
    mc.member_contract_id,  \
    p.first_name                            first_name,  \
    p.middle_name                           middle_name,  \
    p.last_name                             last_name,  \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',  \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
           p.status)                        life_status,  \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',  \
           'D', 'Disability', 'IP',  \
           'Immediate Pay',  \
           'R',  \
           'Retired',  \
           'S',  \
           'Survivor',  \
           'T',   \
           'Terminated',   \
           'TV',  \
           'Term Vested',   \
           mc.member_contract_status)       employment_status,  \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',  \
           'D', 'Deferred', 'H', 'Hold', 'P',   \
           'Pending',  \
           mc.member_contract_code_01)      pay_status,   \
    pa.pension_effective_date               annuity_commencement_date,  \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',   \
           'S', 'On Hold', 'C', 'Complete', 'QP',  \
           'Queued',  \
           'OF',  \
           'OFAC On Hold',  \
           'AP',  \
           'Approval Pending',  \
           'P',  \
           'Pending',  \
           'DR',  \
           'Draft',  \
           'D',  \
           'Denied',  \
           ds.sched_status)                 status,   \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',   \
           'RE', 'Rejected EFTs',   \
           'PD',   \
           'Presumed Dead',   \
           'D',   \
           'Death',  \
           'DO',  \
           'Death-Overpaid',  \
           'R',   \
           'Reported for Escheatment',  \
           'LH',  \
           'Legal Hold',   \
           'BH',   \
           'Broker Hold',   \
           'O',  \
           'Other',  \
           'W',   \
           'Write Off',  \
           'EX',  \
           'Expired',    \
           'IP',    \
           'Immediate Pay',   \
           'AC',   \
           'Application Cancelled',   \
           'PI',   \
           'Paid in   IP',  'AR',   \
           'Approval Reversed',   \
           'IB',   \
           'Ineligible for Benefit',   \
           'IR',  \
           'IP - Revision',   \
           'UL',   \
           'Unable to Locate',   \
           'MR',  \
           'Missing Required Info',   \
           'EL',   \
           'Elimination of Liability Clause',  \
           'RC',  \
           'Remarriage Clause',  \
           'FC',   \
           'Full Commutation',   \
           'PC',   \
           'Partial Commutation',   \
           'CS',  \
           'Child Support Lien Network',  \
           'PQ',   \
           'Pending IPAQS Exclusion Ratio Calc',   \
           'EU',  \
           'Escheating - Uncashed checks',   \
           'ER',   \
           'Escheating - Rejected EFT',   \
           'TE',   \
           'Escheated - Terminal Age',   \
           'ED',   \
           'Escheating - Benefit Deferred',    \
           'EB',   \
           'Escheating - Benefit Refused',    \
           'EI',   \
           'Escheating - Insufficient Data',    \
           'EN',    \
           'Escheating - No Contact',    \
           'EP',   \
           'Escheating - No Response',   \
           'ES',   \
           'Escheating - Death Process',   \
           'EG',   \
           'Escheating - Ret Pkg NIGO',  \
           'ET',  \
           'Escheating - Ret Pkg Not Returned',   \
           'EK',   \
           'Escheating - Client Directed',   \
           'EC',   \
           'Escheating - Client Directed',   \
           'FL',   \
           'Failure to Provide Proof of Life',   \
           ds.sched_status_reason_code)     status_reason,  \
    pr.short_name,   \
    p.death_date                            death_date,  \
    p.death_notification_date               death_reporting_date,  \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice',   \
           'RM',  \
           'Returned Mail',   \
           'EO',   \
           'EDM Other',  \
           'OT',    \
           'Other',   \
           'ES',   \
           'EDM SSA/LN',   \
           'DE',    \
           'Data Enrichment',   \
           p.death_notification_source)     death_posted_by,   \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',   \
           mc.benefit_payment_type)         payment_type,   \
    pa.application_id,   \
    pf.payment_form_name,plan_identifier, pl.plan_name   \
FROM   \
         dbo.member_contract mc    \
    JOIN dbo.business_entity_relation    ber ON mc.member_contract_id = ber.source_key_value  \
    JOIN dbo.entity_relationship         er ON ber.entity_relationship_id = er.entity_relationship_id   \
    JOIN dbo.business_entity_key         bek ON ber.business_entity_key_id = bek.business_entity_key_id   \
    JOIN dbo.person                      p ON bek.key_value = p.person_id   \
    JOIN dbo.pension_application         pa ON pa.member_contract_id = mc.member_contract_id   \
    JOIN dbo.billing_entity              be ON be.billing_id = mc.billing_id   \
                                  AND be.employer_id = mc.employer_id   \
    JOIN dbo.product                     pr ON pr.product_id = be.product_id   \
    JOIN dbo.product_benefit_type        pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id   \
    JOIN dbo.plan                        pl ON pl.plan_id = mc.plan_id  \
    JOIN dbo.payment_form                pf ON pf.pension_application_id = pa.application_id   \
                                AND pf.selected_flag = 'Y'   \
                                AND pf.master_payment_form_id IS NULL   \
    LEFT JOIN dbo.disburse_schedule           ds ON ds.source_key = pa.application_id   \
WHERE   \
    pbt.internal_name IN ( 'CLOSEOUTS' )   \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' )   \
    AND mc.benefit_payment_type = 'D'   \
    AND mc.member_contract_code_01 = 'D'   \
    AND er.entity_relationship_name ='Joint Annuitant'   \
    AND ds.sched_status='D'  \
    AND mc.member_contract_code_04='AF'  \
    AND mc.member_contract_code_04!='IP'   \
    and plan_identifier= '01'    \
    AND pf.payment_form_name  = '100 % Joint and Survivor Life Annuity'  FETCH FIRST 1 ROWS only  

ace.querySql.AnnuitantBeneficiary= SELECT    \
   distinct be.billing_entity_code                  gac,  \
 pbt.internal_name,    be.billing_entity_name,        \
    'Annuitant'                             role,   \
    p.alt_identifier,           \
    mc.member_contract_id,plan_identifier, pl.plan_name,    \
    p.first_name                            first_name,     \
    p.middle_name                           middle_name,     \
    p.last_name                             last_name,       \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',     \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record',    \
           p.status)                        life_status,     \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',   \
           'D', 'Disability', 'IP',     \
           'Immediate Pay' ,   \
           'R',          \
           'Retired',     \
           'S',         \
           'Survivor',     \
           'T',         \
           'Terminated',     \
           'TV',       \
           'Term Vested',   \
           mc.member_contract_status)       employment_status,  \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',   \
           'D', 'Deferred', 'H', 'Hold', 'P',     \
           'Pending',                   mc.member_contract_code_01)      pay_status,    \
    pa.pension_effective_date               annuity_commencement_date,   \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',    \
           'S', 'On Hold', 'C', 'Complete', 'QP',       \
           'Queued',     \
           'OF',     \
           'OFAC On Hold',     \
           'AP',      \
           'Approval Pending',  \
           'P',       \
           'Pending',  \
           'DR',      \
           'Draft',    \
           'D',     \
           'Denied',     \
           ds.sched_status)                 status,      \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',    \
           'RE', 'Rejected EFTs',    \
           'PD',    \
           'Presumed Dead',   \
           'D',    \
           'Death',   \
           'DO',     \
           'Death-Overpaid',   \
           'R',    \
           'Reported for Escheatment',    \
           'LH',      \
           'Legal Hold',   \
           'BH',  \
           'Broker Hold',    \
           'O',     \
           'Other',     \
           'W',     \
           'Write Off',    \
           'EX',       \
           'Expired',     \
           'IP',       \
           'Immediate Pay',     \
           'AC',     \
           'Application Cancelled',    \
           'PI',     \
           'Paid in IP',   \
           'AR',      \
           'Approval Reversed',    \
           'IB',    \
           'Ineligible for Benefit',    \
           'IR',    \
           'IP - Revision',       \
           'UL',        \
           'Unable to Locate',   \
           'MR',  \
           'Missing Required Info', \
           'EL',      \
           'Elimination of Liability Clause',    \
           'RC',       \
           'Remarriage Clause',     \
           'FC',       \
           'Full Commutation',     \
           'PC',      \
           'Partial Commutation',     \
           'CS',        \
           'Child Support Lien Network',     \
           'PQ',      \
           'Pending IPAQS Exclusion Ratio Calc',    \
           'EU',      \
           'Escheating - Uncashed checks',    \
           'ER',   \
           'Escheating - Rejected EFT',       \
           'TE',     \
           'Escheated - Terminal Age',      \
           'ED',       \
           'Escheating - Benefit Deferred',     \
           'EB',    \
           'Escheating - Benefit Refused',    \
           'EI',     \
           'Escheating - Insufficient Data',    \
           'EN',    \
           'Escheating - No Contact',    \
           'EP',   \
           'Escheating - No Response',     \
           'ES',       \
           'Escheating - Death Process',     \
           'EG',       \
           'Escheating - Ret Pkg NIGO',     \
           'ET',   \
           'Escheating - Ret Pkg Not Returned',    \
           'EK',     \
           'Escheating - Client Directed',     \
           'EC',      \
           'Escheating - Client Directed',    \
           'FL',    \
           'Failure to Provide Proof of Life',   \
           ds.sched_status_reason_code)     status_reason,   \
    pr.short_name,      \
    p.death_date                            death_date,     \
    p.death_notification_date               death_reporting_date,    \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice',   \
           'RM',      \
           'Returned Mail',    \
           'EO',      \
           'EDM Other',    \
           'OT',      \
           'Other',      \
           'ES',         \
           'EDM SSA/LN',    \
           'DE',   \
           'Data Enrichment',     \
           p.death_notification_source)     death_posted_by,     \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',    \
           mc.benefit_payment_type)         payment_type,    \
    pa.application_id,    \
    pf.payment_form_name    \
FROM       \
         dbo.member m    \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id   \
    JOIN dbo.person                  p ON p.person_id = m.person_id        \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id    \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id     \
                                  AND be.employer_id = mc.employer_id       \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id     \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id   \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id      \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id    \
                                AND pf.selected_flag = 'Y'       \
                                AND pf.master_payment_form_id IS NULL      \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id       \
WHERE     \
    pbt.internal_name IN ( 'CLOSEOUTS' )    \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' )   \
    AND mc.benefit_payment_type = 'D'        \
    AND mc.member_contract_code_01 = 'IP'     \
    AND p.status= 'L'       \
    AND ds.sched_status= 'A'   \
    AND mc.member_contract_code_04='AF'      \
    AND mc.member_contract_code_04!='IP'   \
    and plan_identifier= '01'    \
    AND  pf.payment_form_name IN( 'Term Certain and Life Annuity','60 Months Term Certain and Life Annuity',   \
    '180 Months Term Certain and Life Annuity',   \
    '3 Months Term Certain Only Annuity', '120 Months Term Certain Only Annuity', 'Term Certain Only Annuity')    \
    UNION ALL    \
SELECT      \
    distinct  be.billing_entity_code                  gac,   \
    pbt.internal_name,    \
    be.billing_entity_name,   \
    er.entity_relationship_name             role,    \
    p.alt_identifier,    \
    mc.member_contract_id, plan_identifier, pl.plan_name,   \
    p.first_name                            first_name,   \
    p.middle_name                           middle_name,    \
    p.last_name                             last_name,      \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',     \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
           p.status)                        life_status,   \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',  \
           'D', 'Disability', 'IP',  \
           'Immediate Pay',   \
           'R',  \
           'Retired',  \
           'S',    \
           'Survivor', \
           'T',  \
           'Terminated',  \
           'TV',  \
           'Term Vested',  \
           mc.member_contract_status)       employment_status,   \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',    \
           'D', 'Deferred', 'H', 'Hold', 'P',   \
           'Pending',  \
           mc.member_contract_code_01)      pay_status,  \
    pa.pension_effective_date               annuity_commencement_date,  \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',  \
           'S', 'On Hold', 'C', 'Complete', 'QP',  \
           'Queued',  \
           'OF',  \
           'OFAC On Hold',   \
           'AP',   \
           'Approval Pending',   \
           'P',   \
           'Pending',   \
           'DR',   \
           'Draft',  \
           'D',  \
           'Denied',  \
           ds.sched_status)                 status,   \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',   \
           'RE', 'Rejected EFTs',  \
           'PD',  \
           'Presumed Dead',  \
           'D',   \
           'Death',   \
           'DO',  \
           'Death-Overpaid',  \
           'R',   \
           'Reported for Escheatment',   \
           'LH',   \
           'Legal Hold',   \
           'BH',     \
           'Broker Hold',   \
           'O',    \
           'Other',  \
           'W',   \
           'Write Off',  \
           'EX',   \
           'Expired',  \
           'IP',   \
           'Immediate Pay',  \
           'AC',   \
           'Application Cancelled',  \
           'PI',    \
           'Paid in IP',  \
           'AR',          \
           'Approval Reversed',   \
           'IB',   \
           'Ineligible for Benefit',   \
           'IR',   \
           'IP - Revision',  \
           'UL',  \
           'Unable to Locate',   \
           'MR',    \
           'Missing Required Info',   \
           'EL',    \
           'Elimination of Liability Clause',   \
           'RC',    \
           'Remarriage Clause',   \
           'FC',    \
           'Full Commutation',   \
           'PC',    \
           'Partial Commutation',  \
           'CS',   \
           'Child Support Lien Network',   \
           'PQ',    \
           'Pending IPAQS Exclusion Ratio Calc',    \
           'EU',    \
           'Escheating - Uncashed checks',    \
           'ER',   \
           'Escheating - Rejected EFT',    \
           'TE',    \
           'Escheated - Terminal Age',     \
           'ED',     \
           'Escheating - Benefit Deferred',    \
           'EB',    \
           'Escheating - Benefit Refused',     \
           'EI',       \
           'Escheating - Insufficient Data',   \
           'EN',    \
           'Escheating - No Contact',      \
           'EP',     \
           'Escheating - No Response',     \
           'ES',      \
           'Escheating - Death Process',     \
           'EG',    \
           'Escheating - Ret Pkg NIGO',   \
           'ET',   \
           'Escheating - Ret Pkg Not Returned', \
           'EK',   \
           'Escheating - Client Directed',   \
           'EC',   \
           'Escheating - Client Directed',  \
           'FL',   \
           'Failure to Provide Proof of Life',   \
           ds.sched_status_reason_code)     status_reason,   \
    pr.short_name,  \
    p.death_date                            death_date,  \
    p.death_notification_date               death_reporting_date,  \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice',  \
           'RM',  \
           'Returned Mail',  \
           'EO',   \
           'EDM Other',  \
           'OT',   \
           'Other',   \
           'ES',  \
           'EDM SSA/LN',   \
           'DE',   \
           'Data Enrichment',  \
           p.death_notification_source)     death_posted_by,  \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',  \
           mc.benefit_payment_type)         payment_type,  \
    pa.application_id,   \
    pf.payment_form_name  \
FROM   \
         dbo.member_contract mc   \
    JOIN dbo.business_entity_relation    ber ON mc.member_contract_id = ber.source_key_value  \
    JOIN dbo.entity_relationship         er ON ber.entity_relationship_id = er.entity_relationship_id  \
    JOIN dbo.business_entity_key         bek ON ber.business_entity_key_id = bek.business_entity_key_id  \
    JOIN dbo.person                      p ON bek.key_value = p.person_id  \
    JOIN dbo.pension_application         pa ON pa.member_contract_id = mc.member_contract_id  \
    JOIN dbo.billing_entity              be ON be.billing_id = mc.billing_id  \
                                  AND be.employer_id = mc.employer_id   \
    JOIN dbo.product                     pr ON pr.product_id = be.product_id  \
    JOIN dbo.product_benefit_type        pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
    JOIN dbo.plan                        pl ON pl.plan_id = mc.plan_id   \
    JOIN dbo.payment_form                pf ON pf.pension_application_id = pa.application_id  \
                                AND pf.selected_flag = 'Y'  \
                                AND pf.master_payment_form_id IS NULL   \
    LEFT JOIN dbo.disburse_schedule           ds ON ds.source_key = pa.application_id   \
WHERE   \
    pbt.internal_name IN ( 'CLOSEOUTS' )  \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' )  \
    AND mc.benefit_payment_type = 'D'  \
    AND mc.member_contract_code_01 = 'IP'  \
     AND mc.member_contract_code_04='AF'  \
    AND mc.member_contract_code_04!='IP'  \
    and plan_identifier= '01'  \
    AND er.entity_relationship_name ='Beneficiary'  \
    AND ds.sched_status= 'A'   \
    AND  pf.payment_form_name IN( 'Term Certain and Life Annuity','60 Months Term Certain and Life Annuity',  \
    '180 Months Term Certain and Life Annuity',  \
    '3 Months Term Certain Only Annuity', '120 Months Term Certain Only Annuity', 'Term Certain Only Annuity')  \
    AND ds.sched_status_reason_code !='AC  FETCH FIRST 1 ROWS only 

ace.querySql.fetchGroupIdQuery=   with main_query as( \
select be.billing_entity_code,ogc.display_name, og.option_group_id, \
og.option_group_name,og.option_group_code,ann_op.annuity_option_name from \
dbo.billing_Entity be \
join dbo.product p on be.product_id=p.product_id \
join dbo.business_entity_key bek on bek.key_code=be.billing_entity_code \
join dbo.plan pl on pl.business_entity_key_id=bek.business_entity_key_id \
join dbo.pension_plan pp on pl.plan_code=pp.pension_plan_code \
join dbo.option_group og on og.pension_plan_id=pp.pension_plan_id \
join dbo.option_group_category ogc on ogc.option_group_category_id=og.option_group_category_id \
join dbo.annuity_option ann_op on ann_op.option_group_id=og.option_group_id \
where  be.product_benefit_type_id=1 \
and pl.ip_indicator_flag='N' \
) \
select * from ( \
select billing_entity_code from main_query \
where option_group_name like 'Purchased Form Package 2' and annuity_option_name like 'Life Annuity' \
intersect \
select billing_entity_code from main_query \
where option_group_name like 'Married Normal Form Package 1' and \
annuity_option_name like '100 % Joint and Survivor Life Annuity' \
intersect \
select billing_entity_code from main_query \
where option_group_name like 'Optional Forms Package 1 - Participant' and \
annuity_option_name like '120 Months Term Certain and Life Annuity' \
) where rownum<=1 \ 

ace.querySql.STIDetails=select distinct annuitant_id,\
business_event,GROUP_NUMBER,transaction_code,disbursement_id, \
memo_code,amount_code,disbursement_status,export_flag,amount,data_string \
from client.sti_export_history \
where disbursement_id=?1 and rownum=1

ace.querySql.PayeeDetailsOverpayment=SELECT P.ALT_IDENTIFIER as "Alternate Id", \
BE.BILLING_ENTITY_CODE,	\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID	AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND D.OVERPAYMENT_FLAG='Y' and sti.business_event = 'PYT' and sti.sti_trans_type = 'OPM' \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)  \
INNER JOIN DBO.V_ANNUITANT P \
ON STI.ANNUITANT_ID = P.ALT_IDENTIFIER \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON MC.MEMBER_ID = P.MEMBER_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='CLOSEOUTS' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
AND DS.SCHEDULE_TYPE            =?1 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?2 \
fetch first 1 row only

ace.querySql.PayeeDetails=SELECT P.ALT_IDENTIFIER,	\
BE.BILLING_ENTITY_CODE,	\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH	\
INNER JOIN DBO.EXPORT_DEFINITION ED	\
ON EH.EXPORT_ID             = ED.EXPORT_ID	\
AND ED.INTERNAL_NAME        = 'STI_EXPORT'	\
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3	\
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI	\
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID	\
AND STI.EXPORT_FLAG     = 'Y'	\
INNER JOIN DBO.DISBURSEMENT D	\
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID	\
INNER JOIN DBO.DISBURSEMENT_REQUEST DR	\
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)    \
INNER JOIN DBO.V_ANNUITANT P	\
ON STI.ANNUITANT_ID = P.ALT_IDENTIFIER	\
INNER JOIN DBO.MEMBER_CONTRACT MC	\
ON MC.MEMBER_ID = P.MEMBER_ID and mc.benefit_payment_type='D'	\
INNER JOIN DBO.PENSION_APPLICATION PA	\
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID	\
INNER JOIN DBO.BILLING_ENTITY BE	\
ON MC.BILLING_ID=BE.BILLING_ID	\
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT	\
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID	\
and PBT.INTERNAL_NAME='CLOSEOUTS'	\
INNER JOIN DBO.DISBURSE_SCHEDULE DS	\
ON DS.SOURCE_ENTITY             = 350	\
AND DS.SOURCE_KEY               = PA.APPLICATION_ID	\
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID	\
AND DS.SCHEDULE_TYPE            =?1	\
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID	\
INNER JOIN BENEFIT_ACCOUNT BA	\
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID	\
AND BA.INTERNAL_NAME LIKE ?2	\
fetch first 1 row only

ace.querySql.PayeeDetailsStopReissue=SELECT P.ALT_IDENTIFIER as "Alternate Id",	\
BE.BILLING_ENTITY_CODE,	\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH	\
INNER JOIN DBO.EXPORT_DEFINITION ED	\
ON EH.EXPORT_ID             = ED.EXPORT_ID	\
AND ED.INTERNAL_NAME        = 'STI_EXPORT'	\
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3	\
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI	\
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID	\
AND STI.EXPORT_FLAG     = 'Y'	\
INNER JOIN DBO.DISBURSEMENT D	\
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID	\
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P	\
ON STI.ANNUITANT_ID = P.ALT_IDENTIFIER	\
INNER JOIN DBO.MEMBER_CONTRACT MC	\
ON MC.MEMBER_ID = P.MEMBER_ID	\
INNER JOIN DBO.PENSION_APPLICATION PA	\
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID	\
INNER JOIN DBO.BILLING_ENTITY BE	\
ON MC.BILLING_ID=BE.BILLING_ID	\
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT	\
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID	\
and PBT.INTERNAL_NAME='CLOSEOUTS'	\
INNER JOIN DBO.DISBURSE_SCHEDULE DS	\
ON DS.SOURCE_ENTITY             = 350	\
AND DS.SOURCE_KEY               = PA.APPLICATION_ID	\
AND DS.SCHEDULE_TYPE            =?1	\
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='R'\
and (dsh.old_status='R1' or dsh.old_status='SR')    \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA	\
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID	\
AND BA.INTERNAL_NAME LIKE ?2	\
fetch FIRST 1 row only

ace.querySql.PayeeDetailsBulkCheck=SELECT P.ALT_IDENTIFIER as "Alternate Id", \
BE.BILLING_ENTITY_CODE,	\
D.Disbursement_id  as "bulk_disb", \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID \
inner join dbo.transaction tr on  dr.source_key_value = tr.trans_id \
and dr.source_entity_id = dbo.pkg_benefit_s.f_get_entity_id('TRANSACTION') \
inner join dbo.trans_detail td on tr.trans_id = td.trans_id \
inner join dbo.bulk_disb_request bdr on td.ref_trans_id = bdr.trans_id \
inner join DBO.DISBURSEMENT_REQUEST DRq \
ON drq.DISBURSEMENT_request_ID = bdr.DISBURSEMENT_request_ID \
INNER JOIN DBO.V_ANNUITANT P \
on p.person_id=bdr.tax_recipient_key_value and bdr.tax_recipient_entity_id=254 and p.status='L' \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON MC.MEMBER_ID = P.MEMBER_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='CLOSEOUTS' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?1    \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?2 \
fetch first 1 row only

ace.querySql.beneStopReissueFDB=SELECT PE.ALT_IDENTIFIER as "Alternate Id", 		\
BE.BILLING_ENTITY_CODE,	\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH	\
INNER JOIN DBO.EXPORT_DEFINITION ED	\
ON EH.EXPORT_ID             = ED.EXPORT_ID	\
AND ED.INTERNAL_NAME        = 'STI_EXPORT'	\
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?4	\
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI	\
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID	\
AND STI.EXPORT_FLAG     = 'Y'	\
INNER JOIN DBO.DISBURSEMENT D	\
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE	\
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER	\
INNER JOIN BUSINESS_ENTITY_RELATION BER	\
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID	\
INNER JOIN ENTITY_RELATIONSHIP ER	\
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID	\
AND ER.ENTITY_RELATIONSHIP_NAME= ?1                                           		\
INNER JOIN DBO.MEMBER_CONTRACT MC	\
ON BER.SOURCE_KEY_VALUE=MC.MEMBER_CONTRACT_ID	\
AND BER.SOURCE_ENTITY_ID = 798	\
and mc.benefit_payment_type='D'	\
INNER JOIN DBO.PENSION_APPLICATION PA	\
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID	\
INNER JOIN DBO.BILLING_ENTITY BE	\
ON MC.BILLING_ID=BE.BILLING_ID	\
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT	\
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID	\
and PBT.INTERNAL_NAME='CLOSEOUTS'	\
INNER JOIN DBO.DISBURSE_SCHEDULE DS	\
ON DS.SOURCE_ENTITY             = 350	\
AND DS.SOURCE_KEY               = PA.APPLICATION_ID	\
AND DS.SCHEDULE_TYPE            = ?2	\
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='R'	\
and (dsh.old_status='R1' or dsh.old_status='SR')	\
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA	\
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID	\
AND BA.INTERNAL_NAME like ?3                                                   		\
fetch first 1 row only

ace.querySql.caCommencement = SELECT DISTINCT P.SSN AS AN_SOC_SEC_NUM,P.FIRST_NAME AS AN_FIRST_NAME,P.MIDDLE_NAME AS AN_M_NM,P.LAST_NAME AS AN_LAST_NAME, \
    pf.payment_form_name,p.death_date AN_DOD,be.billing_entity_code as GROUP_ID,P_REL.SSN AS JA_SOC_SEC_NUM, \
    p_rel.first_name as JA_FNAME,p_rel.last_name as JA_LNAME,P_REL.BIRTH_DATE AS JA_DOB, \
    P_REL.SEX AS JA_GENDER, ROUND(PF.JOINT_AMOUNT_DEATH,2) AS BENEFIT_AMOUNT,PF.BASIC_AMOUNT, \
    ROUND(PF.JOINT_AMOUNT_DEATH / PF.BASIC_AMOUNT *100,4) as BENEFIT_JS_PERCENT,ps.status_name as JA_STATUS, p.birth_date , \
    ATTRVAL.DESCRIPTION AS DEATH_NOTIFICATION_SOURCE, AT.ANNUITY_TYPE_NAME , PF.JOINT_AMOUNT_DEATH , P.ALT_IDENTIFIER \
FROM DBO.PERSON P INNER JOIN \
DBO.MEMBER M  ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PLAN PL ON PL.PLAN_ID = MC.PLAN_ID \
INNER JOIN DBO.BILLING_ENTITY BE ON MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON BER.ENTITY_ID = 254 \
AND BER.KEY_VALUE = P.PERSON_ID \
AND BER.SOURCE_ENTITY_ID = 798 \
AND BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PERSON P_REL ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
AND PA.OWNER_BUSINESS_ENTITY_KEY_ID = P_REL.BUSINESS_ENTITY_KEY_ID \
AND PA.ESTIMATE_FLAG ='N' \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.PAYMENT_FORM PF ON PA.APPLICATION_ID=PF.PENSION_APPLICATION_ID \
JOIN DBO.ATTRIBUTE_VALUE ATTRVAL ON p.DEATH_NOTIFICATION_SOURCE = ATTRVAL.INTERNAL_VALUE \
INNER JOIN DBO.ATTRIBUTE ATTR ON ATTRVAL.ATTRIBUTE_ID = ATTR.ATTRIBUTE_ID \
JOIN DBO.MEMBER MEM ON P.PERSON_ID = MEM.MEMBER_ID \
   JOIN DBO.MEMBER_CONTRACT MC ON MEM.MEMBER_ID = MC.MEMBER_ID \
   JOIN DBO.PLAN PL ON MC.PLAN_ID = PL.PLAN_ID \
   JOIN DBO.PENSION_PLAN PPL ON PL.PLAN_CODE = PPL.PENSION_PLAN_CODE \
   JOIN DBO.ANNUITY_TYPE AT ON PPL.PENSION_PLAN_ID = AT.PENSION_PLAN_ID \
WHERE \
   ATTR.ATTRIBUTE_NAME = 'DEATH_NOTIFICATION_SOURCE' \
   and  PF.PAYMENT_FORM_TYPE IN ('JS','JL') \
   and PF.BASIC_AMOUNT > 0 and p.ssn <> P_REL.ssn \
   and p.death_date is not null and p.status = 'D' \
   and be.billing_entity_code = ?1 \
   and ps.status_name='Initial' \
   and ( \
   ROUND(PF.JOINT_AMOUNT_DEATH / PF.BASIC_AMOUNT *100,4) like ?2 \
   or ROUND(PF.JOINT_AMOUNT_DEATH / PF.BASIC_AMOUNT *100,4) like ?3 \
   ) \
   and ATTRVAL.DESCRIPTION like ?4 \
   and AT.ANNUITY_TYPE_NAME IN ('N1 - Normal Variant 1') \
   and ROWNUM <=1 \
   order by p.ssn \
  
ace.querySql.resurrectSingleApplicationAnnuitant =  SELECT unique PER.ALT_IDENTIFIER as ALT_IDENTIFIER,per.ssn SSN, \
per.first_name,PER.LAST_NAME,PBT.INTERNAL_NAME PRODUCT_NAME,BIL.BILLING_ENTITY_CODE GROUP_NUMBER, \
BIL.BILLING_ENTITY_NAME GROUP_NAME,PS.STATUS_NAME PENSION_STATUS,pay.payment_form_name FOA, \
pay.joint_percent_death Joint_Percentage,PER.PRIMARY_IDENTIFIER_ID, \
(case DISC.sched_status \
when 'A' then 'In Pay'  \
when 'DR' then 'Draft' \
when 'D' then 'Denied' \
when 'V' then 'Void' \
when 'P' then 'Pending' \
when 'S' then 'On Hold' \
when 'C' then 'Complete' \
when 'QP' then 'Queued' \
when 'AP' then 'Approval Pending' \
when 'OF' then 'OFAC On Hold' \
Else 'Deferred' end)as STATUS, \
PER.birth_date DOB FROM DBO.PERSON PER \
JOIN DBO.MEMBER MEM ON MEM.PERSON_ID=PER.PERSON_ID \
JOIN DBO.MEMBER_CONTRACT MC ON MC.MEMBER_ID=MEM.MEMBER_ID \
join DBO.BILLING_ENTITY BIL ON MC.BILLING_ID= BIL.BILLING_ID \
left JOIN DBO.PENSION_APPLICATION PA ON MC.member_contract_id = PA.member_contract_id \
LEFT join DBO.PENSION_STATUS PS ON PA.STATUS_ID = PS.STATUS_ID \
left join dbo.payment_form pay ON pa.application_id = pay.pension_application_id \
left join dbo.disburse_schedule DISC on PA.application_id = DISC.source_key \
JOIN DBO.PRODUCT_BENEFIT_TYPE PBT on PBT.PRODUCT_BENEFIT_TYPE_ID = BIL.PRODUCT_BENEFIT_TYPE_ID \
WHERE \
BIL.BILLING_ENTITY_CODE = ?1 \
and mc.member_contract_status NOT in ('IP') \
and PER.DEATH_DATE IS NOT NULL \
and pay.payment_form_name like ('Life Annuity') \
and PS.STATUS_NAME like 'Annuitant Deceased'  \
and PER.PRIMARY_IDENTIFIER_ID in('10') \
and ROWNUM <=1 \



ace.querySql.BeneconfirmIIAUS= SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
                     inner join dbo.person p on v.person_id=p.person_id \
              inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
              inner join dbo.entity_relationship er on ber.entity_relationship_id=er.entity_relationship_id \
              and er.entity_relationship_name = 'Beneficiary' \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
              AND ps.pension_status_code NOT IN ('IIA_CANCELLED','IIA_NOT_TAKEN','IIA_UNLOCKED') \
            inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country = 'US' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'IIA' \
               and bek.search_text_02 is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' \
              and p.primary_identifier_id !=40 \
              and p.citizenship_country_id is not null \
              and a.address_3 is null \
              and v.status='L' \   
and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \			

ace.querySql.BeneconfirmIIANONUS= SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
                   inner join dbo.person p on v.person_id=p.person_id \
              inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
              inner join dbo.entity_relationship er on ber.entity_relationship_id=er.entity_relationship_id \
              and er.entity_relationship_name = 'Beneficiary' \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
              AND ps.pension_status_code NOT IN ('IIA_CANCELLED','IIA_NOT_TAKEN','IIA_UNLOCKED') \
            inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country != 'US' \
                    and a.country != 'CA' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'IIA' \
               and bek.search_text_02 is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' \
              and a.address_attention is null \
                            and a.address_3 is null \
                            and p.primary_identifier_id !=40 \
                            and a.address_2 is null \
                            and p.citizenship_country_id is not null \
              and v.status='L' \
			  and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \						

ace.querySql.BeneconfirmSSAUS=        SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
                                  inner join dbo.person p on v.person_id=p.person_id \
                     inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
					 inner join dbo.entity_relationship er on ber.entity_relationship_id=er.entity_relationship_id \
              and er.entity_relationship_name = 'Beneficiary' \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
              AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
            inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country = 'US' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'STRUCTURED' \
               and bek.search_text_02 is null \
              and ds.sched_status<> 'C' \
              and ds.schedule_type = 'R' \
                            and p.primary_identifier_id !=40 \
                            and a.address_3 is null \
                            and p.citizenship_country_id is not null \
              and v.status='L' \
			  and v.PREFIX is null \
              and v.SUFFIX is null \
              and v.SORT_NAME NOT LIKE '%-%' \
              and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \

ace.querySql.BeneconfirmSSANONUS=  SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
                                  inner join dbo.person p on v.person_id=p.person_id \
                     inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
					 inner join dbo.entity_relationship er on ber.entity_relationship_id=er.entity_relationship_id \
              and er.entity_relationship_name = 'Beneficiary' \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
              AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
            inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country != 'US' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'STRUCTURED' \
               and bek.search_text_02 is null \
              and ds.sched_status<>'C' \
              and ds.schedule_type = 'R' \
                            and p.primary_identifier_id !=40 \
                            and v.alt_identifier= '2272659650' \
              and v.status='L' \
              
ace.querySql.BeneconfirmCOUS= SELECT v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek \
                    on v.person_id = bek.KEY_VALUE \
                                  inner join dbo.person p on v.person_id=p.person_id \
                    and v.alt_identifier = bek.alt_key_code \
                     inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
					  inner join dbo.entity_relationship er on ber.entity_relationship_id=er.entity_relationship_id \
              and er.entity_relationship_name = 'Beneficiary' \
              inner join dbo.MEMBER_CONTRACT mc \
                    on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa \
                    on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
              inner join dbo.disburse_schedule ds \
                    on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be \
                    on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt \
                    on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps \
                    on ps.status_id = pa.status_id \
              inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country = 'US' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'CLOSEOUTS' \
                and mc.member_contract_code_04 in ('II', 'AF') \
              and pa.parent_application_id is null \
              and ds.sched_status <>'C' \
              and ds.schedule_type = 'R' \
                and bek.search_text_02 is null  \
                and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED') \
                              and p.primary_identifier_id !=40 \
                              and a.address_3 is null \
                and v.status='L' \
				and v.PREFIX is null \
				and v.SUFFIX is null \
				and v.SORT_NAME NOT LIKE '%-%' \
				and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \		

ace.querySql.BeneconfirmCONONUS=  SELECT v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek \
                    on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
                                  inner join dbo.person p on v.person_id=p.person_id \
                     inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
					  inner join dbo.entity_relationship er on ber.entity_relationship_id=er.entity_relationship_id \
              and er.entity_relationship_name = 'Beneficiary' \
              inner join dbo.MEMBER_CONTRACT mc \
                    on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa \
                    on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
              inner join dbo.disburse_schedule ds \
                    on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be \
                    on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt \
                    on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps \
                    on ps.status_id = pa.status_id \
              inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country != 'US' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'CLOSEOUTS' \
                and mc.member_contract_code_04 in ('II', 'AF') \
              and pa.parent_application_id is null \
              and ds.sched_status <>'C' \
              and ds.schedule_type = 'R' \
                and bek.search_text_02 is null \
                and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED') \
                              and p.primary_identifier_id !=40 \
                              and a.address_3 is null \
                and v.status='L' \
                and v.alt_identifier= '4670415760' \

ace.querySql.BenCononus=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='4670415760' \

ace.querySql.PayeeDetailsHandSReissue=SELECT P.ALT_IDENTIFIER as "Alternate Id", \
BE.BILLING_ENTITY_CODE as "groupID",\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID and d.disbursement_status='R'    \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.BILLING_ENTITY BE \
ON sti.group_number=BE.BILLING_entity_code \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON MC.Billing_ID = be.billing_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.V_ANNUITANT P \
ON mc.member_ID = P.member_id and p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='CLOSEOUTS' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?1 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
and (dsh.old_status='H' and dsh.new_status='S') \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?2 \
fetch first 1 row only


#Tax withhold letter confirmation:
ace.querySql.TaxwithholdletterconfirmationSSACAUSLiving= SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
  from  dbo.V_ANNUITANT v \
  inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
  and v.alt_identifier = bek.alt_key_code \
  inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
  inner join dbo.eft_authorization eft on eft.recipient_key_value=v.person_id \
  inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
  inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
  AND pa.estimate_flag = 'N' \
  AND pa.parent_application_id IS NULL \
  AND PA.APPROVED_FLAG = 'Y' \
  AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
  inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
  and pa.application_id = ds.source_key \
  inner join dbo.deduction_template ded \
  on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
  inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
  inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
  inner join dbo.pension_status ps on ps.status_id = pa.status_id \
  AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
  inner join dbo.addresses a on v.person_id=a.key_value \
  and a.country = 'US' \
  and a.stop_date is null \
  and a.address_type='R' \
  where pbt.internal_name = 'STRUCTURED' \
  and bek.search_text_02 is null \
  and ds.sched_status<> 'C' \
  and ds.schedule_type = 'R' \
  and p.citizenship_country_id is not null \
  and v.status='L' \

ace.querySql.TaxwithholdletterconfirmationCOCAUSLiving= SELECT v.alt_identifier,v.first_name,v.last_name \
from   dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek \
on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.eft_authorization eft on eft.recipient_key_value=v.person_id \
inner join dbo.MEMBER_CONTRACT mc \
on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa \
on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
inner join dbo.disburse_schedule ds \
on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be \
on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt \
on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps \
on ps.status_id = pa.status_id \
inner join dbo.addresses a on v.person_id=a.key_value \
and a.country = 'US' \
and a.stop_date is null \
and a.address_type='R' \
where pbt.internal_name = 'CLOSEOUTS' \
and mc.member_contract_code_04 in ('II', 'AF') \
and pa.parent_application_id is null \
and ds.sched_status <>'C' \
and ds.schedule_type = 'R' \
and bek.search_text_02 is null \
and p.citizenship_country_id is not null \
and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED') \
and v.status='L' \
and rownum=1 \

ace.querySql.BankChangeConfirmationCOCANonUSLiving=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
  from dbo.V_ANNUITANT v   \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE   \
and v.alt_identifier = bek.alt_key_code   \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code  \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id   \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID   \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \ \
  JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id   \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key  \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id   \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id   \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id   \
inner join dbo.pension_status ps on ps.status_id = pa.status_id   \
and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED')   \
inner join dbo.addresses a on v.person_id=a.key_value and a.country != 'US' and a.stop_date is null  \
and a.address_type='R'   \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id   \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code  \
where pbt.internal_name = 'CLOSEOUTS'   \
and ds.sched_status<> 'C'   \
and ds.schedule_type = 'R'   \
and p.primary_identifier_id !=40  \
and ds.next_disb_type= 'E'   \
and  a.country != 'US'   \
and p.citizenship_country_id is not null \
and bek.search_text_02 is null \
and v.PREFIX is null \
and v.SUFFIX is null \
and v.SORT_NAME NOT LIKE '%-%' \
and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \
and a.address_2 is null \
and a.address_3 is null \
and v.status='L'

ace.querySql.BankingChangeConfirmationLetterSSACANonUSLiving= SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
from   dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.person p on v.person_id=p.person_id \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.eft_authorization eft on eft.recipient_key_value=v.person_id \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL \
AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value \
and a.country != 'US' \
and a.stop_date is null \
and a.address_type='R' \
and a.address_type!='M' \
where pbt.internal_name = 'STRUCTURED' \
and bek.search_text_02 is null \
and ds.sched_status<> 'C' \
and ds.schedule_type = 'R' \
and a.address_3 is null \
and a.address_2 is null \
and p.primary_identifier_id !=40 \
and v.status='L' \
and v.PREFIX is null \
and v.SUFFIX is null \
and v.SORT_NAME NOT LIKE '%-%' \
and v.SORT_NAME NOT LIKE '%'||chr(39)||'%'


ace.querySql.BankingChangeConfirmationLetterSSACAUSLiving=SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
from   dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.person p on v.person_id=p.person_id \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.eft_authorization eft on eft.recipient_key_value=v.person_id \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL \
AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value \
and a.country = 'US' \
and a.stop_date is null \
and a.address_type='R' \
and a.address_type!='M' \
where pbt.internal_name = 'STRUCTURED' \
and bek.search_text_02 is null \
and ds.sched_status<> 'C' \
and ds.schedule_type = 'R' \
and a.address_3 is null \
and p.primary_identifier_id !=40 \
and v.status='L' \
and v.PREFIX is null \
and v.SUFFIX is null \
and v.SORT_NAME NOT LIKE '%-%' \
and v.SORT_NAME NOT LIKE '%'||chr(39)||'%'

ace.querySql.BankingChangeConfirmationLetterIIACAUSLiving= SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
from   dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.person p on v.person_id=p.person_id \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.eft_authorization eft on eft.recipient_key_value=v.person_id \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL \
AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value \
and a.country = 'US' \
and a.stop_date is null \
and a.address_type='R' \
and a.address_type!='M' \
where pbt.internal_name = 'IIA' \
and bek.search_text_02 is null \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and a.address_3 is null \
and p.primary_identifier_id !=40 \
and v.status='L' \
and v.PREFIX is null \
and v.SUFFIX is null \
and v.SORT_NAME NOT LIKE '%-%' \
and v.SORT_NAME NOT LIKE '%'||chr(39)||'%'

ace.querySql.BankingChangeConfirmationLetterCOCAUSLiving= SELECT v.alt_identifier,v.first_name,v.last_name \
from   dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek \
on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.person p on v.person_id=p.person_id \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.eft_authorization eft on eft.recipient_key_value=v.person_id \
inner join dbo.MEMBER_CONTRACT mc \
on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa \
on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
inner join dbo.disburse_schedule ds \
on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.billing_entity be \
on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt \
on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps \
on ps.status_id = pa.status_id \
inner join dbo.addresses a on v.person_id=a.key_value \
and a.country = 'US' \
and a.stop_date is null \
and a.address_type='R' \
and a.address_type!='M' \
where pbt.internal_name = 'CLOSEOUTS' \
and mc.member_contract_code_04 in ('II', 'AF') \
and pa.parent_application_id is null \
and ds.sched_status <>'C' \
and ds.schedule_type = 'R' \
and bek.search_text_02 is null \
and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED') \
and a.address_attention is null \
and a.address_3 is null \
and p.primary_identifier_id !=40 \
and v.status='L' \
and v.PREFIX is null \
and v.SUFFIX is null \
and v.SORT_NAME NOT LIKE '%-%' \
and v.SORT_NAME NOT LIKE '%'||chr(39)||'%'

ace.querySql.BankingChangeConfirmationLetterIIACANonUSLiving=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='2875022854'

ace.querySql.beneDetailsVoidReissue=SELECT PE.ALT_IDENTIFIER as "Alternate Id", \
BE.BILLING_ENTITY_CODE as "groupID",\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?4 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID and D.DISBURSEMENT_STATUS= 'R'   \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME= ?1 \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON BER.SOURCE_KEY_VALUE=MC.MEMBER_CONTRACT_ID \
AND BER.SOURCE_ENTITY_ID = 798 \
and mc.benefit_payment_type='D' \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='CLOSEOUTS' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?2 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
and (dsh.old_status='V' and dsh.new_status='RV') \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME like ?3 \
fetch first 1 row only

ace.querySql.beneDetails=SELECT PE.ALT_IDENTIFIER as "Alternate Id", \
BE.BILLING_ENTITY_CODE, \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"  \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?4  \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID   \
AND STI.EXPORT_FLAG     = 'Y'   \
INNER JOIN DBO.DISBURSEMENT D   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR  \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID  AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE    \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER   \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER   \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME=?1   \
INNER JOIN DBO.MEMBER_CONTRACT MC   \
ON BER.SOURCE_KEY_VALUE=MC.MEMBER_CONTRACT_ID   \
AND BER.SOURCE_ENTITY_ID = 798  \
and mc.benefit_payment_type='D' \
INNER JOIN DBO.PENSION_APPLICATION PA   \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id    \
INNER JOIN DBO.BILLING_ENTITY BE    \
ON MC.BILLING_ID=BE.BILLING_ID  \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   \
and PBT.INTERNAL_NAME='CLOSEOUTS'   \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350   \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID   \
AND DS.SCHEDULE_TYPE            = ?2   \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
INNER JOIN BENEFIT_ACCOUNT BA   \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID    \
AND BA.INTERNAL_NAME like ?3    \
fetch first  row only

ace.querySql.beneDetailsOverpayment=SELECT PE.ALT_IDENTIFIER as "Alternate Id", \
BE.BILLING_ENTITY_CODE, \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"  \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?4 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID	\
AND STI.EXPORT_FLAG     = 'Y'   \
INNER JOIN DBO.DISBURSEMENT D   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND D.OVERPAYMENT_FLAG='Y' and sti.business_event = 'PYT' and sti.sti_trans_type = 'OPM' \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE    \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER   \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER   \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME=    ?1  \
INNER JOIN DBO.MEMBER_CONTRACT MC   \
ON BER.SOURCE_KEY_VALUE=MC.MEMBER_CONTRACT_ID   \
AND BER.SOURCE_ENTITY_ID = 798  \
and mc.benefit_payment_type='D' \
INNER JOIN DBO.PENSION_APPLICATION PA   \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID    \
INNER JOIN DBO.BILLING_ENTITY BE    \
ON MC.BILLING_ID=BE.BILLING_ID  \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   \
and PBT.INTERNAL_NAME='CLOSEOUTS'   \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350   \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            =   ?2   \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA   \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID    \
AND BA.INTERNAL_NAME like ?3    \
fetch first  row only

ace.querySql.acceleratedPayment=SELECT P.ALT_IDENTIFIER as "Alternate Id",  \
BE.BILLING_ENTITY_CODE, \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"  \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3  \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID	AND STI.EXPORT_FLAG= 'Y' and sti.business_event = 'PYT' and sti.Transaction_code = 'AP' \
INNER JOIN DBO.DISBURSEMENT D   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
INNER JOIN DBO.V_ANNUITANT P    \
ON STI.ANNUITANT_ID = P.ALT_IDENTIFIER  \
INNER JOIN DBO.MEMBER_CONTRACT MC   \
ON MC.MEMBER_ID = P.MEMBER_ID   \
INNER JOIN DBO.PENSION_APPLICATION PA   \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID    \
INNER JOIN DBO.BILLING_ENTITY BE    \
ON MC.BILLING_ID=BE.BILLING_ID  \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   \
and PBT.INTERNAL_NAME='CLOSEOUTS'   \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350   \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?1   \
INNER JOIN BENEFIT_ACCOUNT BA   \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID    \
AND BA.INTERNAL_NAME LIKE ?2    \
fetch first 1 row only

ace.querySql.onetimeBeneOverpyt=SELECT PE.ALT_IDENTIFIER as "Alternate Id", \
BE.BILLING_ENTITY_CODE, \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"  \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?4 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND D.OVERPAYMENT_FLAG='Y' and sti.business_event = 'DFP' and sti.sti_trans_type = 'OPM' \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME= ?1 \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON BER.SOURCE_KEY_VALUE=MC.MEMBER_CONTRACT_ID \
AND BER.SOURCE_ENTITY_ID = 798 \
and mc.benefit_payment_type='D' \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='CLOSEOUTS' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?2 \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME like ?3 \
fetch first 1 row only

ace.querySql.stopReissueCBW=SELECT P.ALT_IDENTIFIER as "Alternate Id",  \
BE.BILLING_ENTITY_CODE, \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"  \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3  \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID   \
AND STI.EXPORT_FLAG     = 'Y'   \
INNER JOIN DBO.DISBURSEMENT D   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)  \
INNER JOIN DBO.V_ANNUITANT P    \
ON STI.ANNUITANT_ID = P.ALT_IDENTIFIER  \
INNER JOIN DBO.MEMBER_CONTRACT MC   \
ON MC.MEMBER_ID = P.MEMBER_ID and mc.benefit_payment_type='D'   \
INNER JOIN DBO.PENSION_APPLICATION PA   \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID    \
INNER JOIN DBO.BILLING_ENTITY BE    \
ON MC.BILLING_ID=BE.BILLING_ID  \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   \
and PBT.INTERNAL_NAME='CLOSEOUTS'   \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350   \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?1    \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
and (dsh.old_status='SR' and dsh.new_status='R')    \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA   \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID    \
AND BA.INTERNAL_NAME LIKE ?2	\
fetch first 1 row only

ace.querySql.BeneconfirmCOUSst= SELECT v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek \
                    on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
                     inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
					  inner join dbo.entity_relationship er on ber.entity_relationship_id=er.entity_relationship_id \
              and er.entity_relationship_name = 'Beneficiary' \
              inner join dbo.MEMBER_CONTRACT mc \
                    on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa \
                    on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
              inner join dbo.disburse_schedule ds \
                    on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be \
                    on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt \
                    on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps \
                    on ps.status_id = pa.status_id \
              inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country = 'US' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'CLOSEOUTS' \
                and mc.member_contract_code_04 in ('II', 'AF') \
              and pa.parent_application_id is null \
              and ds.sched_status <>'C' \
              and ds.schedule_type = 'R' \
                and bek.search_text_02 is null  \
                and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED') \
                and v.status='L' \
                and v.alt_identifier= '9420186070' \
  


ace.querySql.resurrectionMultipleApplication = SELECT P.ALT_IDENTIFIER as ALT_IDENTIFIER, \
count(pa.application_id) as number_of_application, \
be.BILLING_ENTITY_NAME \
FROM dbo.pension_application pa \
join DBO.PENSION_STATUS PS ON PA.STATUS_ID = PS.STATUS_ID \
join dbo.payment_form pay ON pa.application_id = pay.pension_application_id, \
dbo.member_contract     mc, \
dbo.billing_entity      be, \
dbo.business_entity_key bek, \
dbo.person p \
where pa.member_contract_id = mc.member_contract_id \
and mc.billing_id = be.billing_id \
and nvl(be.client_approval_for_death, 'N') = 'N' \
and pa.owner_business_entity_key_id = bek.business_entity_key_id \
and bek.key_value = p.person_id \
and be.BILLING_ENTITY_NAME = ?1 \
and P.DEATH_DATE IS NOT NULL \
having count(pa.application_id) = 3 \
group by p.ALT_IDENTIFIER , be.BILLING_ENTITY_NAME  \
fetch first 1 row only

ace.querySql.PayeeDetailsBulkCheckbene=SELECT sti.annuitant_id as "Alternate Id", \
sti.group_number as "BILLING_ENTITY_CODE", \
D.Disbursement_id as "bulk_disb", \
d.disbursement_amt as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
and sti.transaction_code = 'DFTC' \
and sti.data_string like '%CLOSEOUT%' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
INNER JOIN DBO.BILLING_ENTITY BE \
ON sti.group_number=BE.Billing_entity_code \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON mc.billing_id=be.billing_id \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?1 \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME =?2 \
fetch first 1 row only

ace.querySql.PaymentPreviewReportLT=SELECT \
   distinct be.billing_entity_code                  gac, \
    pbt.internal_name, \
    be.billing_entity_name, \
    'Annuitant'                             role, \
    p.alt_identifier, \
    mc.member_contract_id,plan_identifier, pl.plan_name, \
    p.first_name                            first_name, \
    p.middle_name                           middle_name, \
    p.last_name                             last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                        life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
          'Immediate Pay', \
           'R', \
           'Retired', \
           'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)       employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
           mc.member_contract_code_01)      pay_status, \
    pa.pension_effective_date               annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                 status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', \
           'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)     status_reason, \
    pr.short_name, \
    p.death_date                            death_date, \
    p.death_notification_date               death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', \
           'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)     death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)         payment_type, \
    pa.application_id, \
   pf.payment_form_name \
FROM \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
JOIN dbo.deduction_template dt on ds.disbursement_schedule_id = dt.disbursement_schedule_id                           \
     JOIN dbo.deduction_template_detail dtd on dt.deduction_template_id = dtd.deduction_template_id   \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'D' \
    AND mc.member_contract_code_01 = 'IP' \
   AND p.status= 'L' \
    AND ds.sched_status= 'A' \
    AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' \
    AND dtd.deduction_type='LT' \
    AND  pf.payment_form_name IN( 'Term Certain and Life Annuity','60 Months Term Certain and Life Annuity', \
    '180 Months Term Certain and Life Annuity',  \
    '3 Months Term Certain Only Annuity', '120 Months Term Certain Only Annuity', 'Term Certain Only Annuity')   fetch first  row only 

ace.querySql.PaymentPreviewReportOR=SELECT \
   distinct be.billing_entity_code                  gac, \
    pbt.internal_name, \
    be.billing_entity_name, \
    'Annuitant'                             role, \
    p.alt_identifier, \
    mc.member_contract_id,plan_identifier, pl.plan_name, \
    p.first_name                            first_name, \
    p.middle_name                           middle_name, \
    p.last_name                             last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                        life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
          'Immediate Pay', \
           'R', \
           'Retired', \
           'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)       employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
           mc.member_contract_code_01)      pay_status, \
    pa.pension_effective_date               annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                 status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', \
           'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)     status_reason, \
    pr.short_name, \
    p.death_date                            death_date, \
    p.death_notification_date               death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', \
           'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)     death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)         payment_type, \
    pa.application_id, \
   pf.payment_form_name \
FROM \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
JOIN dbo.deduction_template dt on ds.disbursement_schedule_id = dt.disbursement_schedule_id                           \
     JOIN dbo.deduction_template_detail dtd on dt.deduction_template_id = dtd.deduction_template_id   \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'D' \
    AND mc.member_contract_code_01 = 'IP' \
   AND p.status= 'L' \
    AND ds.sched_status= 'A' \
    AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' \
    AND dtd.deduction_type='OR' \
    AND  pf.payment_form_name IN( 'Term Certain and Life Annuity','60 Months Term Certain and Life Annuity', \
    '180 Months Term Certain and Life Annuity',  \
    '3 Months Term Certain Only Annuity', '120 Months Term Certain Only Annuity', 'Term Certain Only Annuity')   fetch first  row only 

ace.querySql.CaseActivation = SELECT \
    distinct be.billing_entity_code                                                              gac, \
    pbt.internal_name, \
    be.billing_entity_name, \
    'Annuitant'                                                                         role, \
    p.alt_identifier, \
    mc.member_contract_id, \
    p.first_name                                                                        first_name, \
    p.middle_name                                                                       middle_name, \
    p.last_name                                                                         last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                                                                    life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
           'Immediate Pay', \
           'R', \
           'Retired', \
           'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)                                                   employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
           mc.member_contract_code_01)                                                  pay_status, \
    pa.pension_effective_date                                                           annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                                                             status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', 'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)                                                 status_reason, \
    pr.short_name, \
    p.death_date                                                                        death_date, \
    p.death_notification_date                                                           death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', 'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)                                                 death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)                                                     payment_type, \
    pa.application_id, \
   pf.payment_form_name, plan_identifier, pl.plan_name \
FROM \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) and mc.member_contract_code_01='IP' and mc.benefit_payment_type='D' and ds.sched_status='A' and p.status='L' \
    AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' FETCH FIRST 1 ROWS only

ace.querySql.ssaPayee=SELECT P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1 \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?4 \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?5 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6 \
fetch first 1 rows only

ace.querySql.ssaNonTax=SELECT P.ALT_IDENTIFIER as "Alternate Id",    \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1 \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)  \
Inner JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME like 'STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?4 \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?5 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') ='Y' \
fetch first 1 rows only

ace.querySql.ssaJoint=SELECT PE.ALT_IDENTIFIER as "Alternate Id",    \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?8 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1 \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME like ?2 \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?3 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?4 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON \
DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND \
DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
AND DS.SCHEDULE_TYPE            = ?5 \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?6 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <> ?7 \
fetch first 1 rows only

ace.querySql.ssaOverpayment=SELECT P.ALT_IDENTIFIER as "Alternate Id",    \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1 \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
AND D.OVERPAYMENT_FLAG='Y' \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?4 \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?5 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6 \
fetch first 1 rows only

ace.querySql.ssaVoidReissue=SELECT P.ALT_IDENTIFIER as "Alternate Id",    \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1 \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?4 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='R' \
and (dsh.old_status='VR' and dsh.new_status='R2') \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?5 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6 \
fetch first 1 rows only

ace.querySql.ssaScheduledAdjustment=SELECT P.ALT_IDENTIFIER as "Alternate Id",    \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1 \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='I' \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS ON \
DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
AND DS.SCHEDULE_TYPE            = ?4 \
inner join dbo.disb_schedule_increase dsi on dsi.DISBURSEMENT_SCHEDULE_ID=ds.DISBURSEMENT_SCHEDULE_ID and dsi.INCREASE_FREQUENCY_TYPE in ('R') \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?5 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <> ?6 \
fetch first 1 rows only

ace.querySql.ssaHandSPayment=SELECT P.ALT_IDENTIFIER as "Alternate Id",    \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1 \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?4 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
and (dsh.old_status='I' and dsh.new_status='H') \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?5 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6 \
fetch first 1 rows only

ace.querySql.ssarollover=SELECT P.ALT_IDENTIFIER as "Alternate Id",    \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1 \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID AND PF.ROLLOVER_AMOUNT IS NOT NULL \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON \
DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND \
DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5 \
fetch first 1 rows only

ace.querySql.ssaQdro=SELECT PE.ALT_IDENTIFIER as "Alternate Id",    \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?8 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1   \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR  AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID \
INNER JOIN DBO.PERSON PE \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME like ?2 \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE= ?3 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?4 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON \
DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND \
DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
AND DS.SCHEDULE_TYPE            = ?5 \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?6 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <> ?7 \
fetch first 1 rows only

ace.querySql.ssSplitPayment=SELECT P.ALT_IDENTIFIER as "Alternate Id",    \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.data_string like ?1 \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='I' \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name like ?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='STRUCTURED' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON \
DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
AND DS.SCHEDULE_TYPE            = ?4 \
inner JOIN DBO.eft_authorization e on \
e.recipient_entity_id=254 and e.recipient_key_value=p.person_id and e.percent not in (1,0) \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?5 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <> ?6 \
fetch first 1 rows only

ace.querySql.IIACaseActivatedAnnuitantLivingNonUSv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country <>'US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'IIA' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
and  BA.NON_TAXABLE_FLAG is null \
AND mc.member_contract_status!='IP'\
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='N' \
AND p.citizenship_country_id is not null

ace.querySql.IIACaseActivatedAnnuitantDeceasedUSv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'IIA' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='D' \
and  BA.NON_TAXABLE_FLAG is null \
and p.primary_identifier_id !=40 \
AND mc.member_contract_status!='IP'\
and dedt.zero_deduction_flag='N' \
AND p.citizenship_country_id is not null

ace.querySql.IIACaseActivatedAnnuitantNonUSDeceasedv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country <>'US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'IIA' \
and v.status='D' \
and  BA.NON_TAXABLE_FLAG is null \
AND mc.member_contract_status!='IP'\
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='N' \
AND p.citizenship_country_id is not null

ace.querySql.PaymentPreviewReportGAC=select be.billing_entity_code as LC_GAC, \
count(ds.disbursement_schedule_id) as LifeCount \
from  dbo.deduction_template_detail dtd  \
inner join dbo.deduction_type dedtyp \
    on dedtyp.deduction_type = dtd.deduction_type \
      inner join dbo.deduction_template dt on dtd.deduction_template_id = dt.deduction_template_id \
      inner join dbo.disburse_schedule ds on dt.disbursement_schedule_id = ds.disbursement_schedule_id \
      inner join dbo.pension_application pa on ds.source_key = pa.application_id \
             AND ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id ('PENSION_APPLICATION') \
      inner join dbo.member_contract mc on mc.member_contract_id = pa.member_contract_id \
      inner join dbo.member m on m.member_id=mc.member_id \
      inner join dbo.billing_entity  be on mc.billing_id = be.billing_id \
      inner join dbo.person p on m.person_id=p.person_id \
      where ds.sched_status = 'A' \
         and ds.source_entity = 350 \
         and ds.payee_entity = 254 \
         and dtd.deduction_type=?1 \
         and dtd.deduction_amt>0 \
         group by be.billing_entity_code \
         having count(ds.disbursement_schedule_id)<=5000 fetch first 1 rows only 
ace.querySql.PaymentPreviewReportDueDate=select distinct \
be.billing_entity_code, \
ds.next_pay_date, \
dtd.deduction_type \
,dedtyp.description \
from  dbo.deduction_template_detail dtd  \
inner join dbo.deduction_type dedtyp    on dedtyp.deduction_type = dtd.deduction_type \
      inner join dbo.deduction_template dt on dtd.deduction_template_id = dt.deduction_template_id \
      inner join dbo.disburse_schedule ds on dt.disbursement_schedule_id = ds.disbursement_schedule_id \
      inner join dbo.pension_application pa on ds.source_key = pa.application_id \
             AND ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id ('PENSION_APPLICATION') \
      inner join dbo.member_contract mc on mc.member_contract_id = pa.member_contract_id \
      inner join dbo.billing_entity  be on mc.billing_id = be.billing_id \
where be.billing_entity_code=?1 \
and dtd.deduction_type=?2 \
and ds.next_pay_date >=TO_DATE('01-OCT-23', 'DD-MON-RR') \
order by dedtyp.description fetch first 1 rows only

ace.querySql.FetchAnnuitantDynamicDetails=SELECT v.alt_identifier,v.ssn,v.first_name,v.middle_name, v.last_name , v.suffix, v.marital_status, \
bek.search_text_02 AS PHONENUMBER,bek.search_text_03 AS EMAIL, \
a.ADDRESS_1,a.ADDRESS_2,a.ADDRESS_3,a.CITY,a.STATE, a.ZIP, a.COUNTRY, a.POSTAL_CODE, BIL.BILLING_ENTITY_CODE GROUP_NUMBER, \
BIL.BILLING_ENTITY_NAME GROUP_NAME,BIL.LEGAL_ENTITY_ID,  MC.CODE_01 AS ANUUITY_NUMBER, \
paymentForm.PAYMENT_FORM_FREQUENCY,paymentForm.COMMENCEMENT, paymentForm.CERTAIN_END_DATE, paymentForm.BASIC_AMOUNT,ds.FIRST_PAY_DATE, emp.employer_name , v.birth_date as DOB \
FROM dbo.V_ANNUITANT v \
LEFT JOIN dbo.business_entity_key bek ON v.person_id = bek.key_value AND v.alt_identifier = bek.alt_key_code \
LEFT JOIN dbo.addresses a ON v.person_id = a.key_value AND a.stop_date IS NULL AND a.address_type = 'R' \
JOIN dbo.member me on v.person_id = me.person_id \
JOIN DBO.MEMBER_CONTRACT MC ON ME.MEMBER_ID= MC.MEMBER_ID \
LEFT JOIN DBO.BILLING_ENTITY BIL ON MC.BILLING_ID= BIL.BILLING_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') OR pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.product_benefit_type pbt on BIL.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
inner join dbo.payment_form paymentForm on paymentForm.PAYMENT_FORM_ID = ds.PAYMENT_FORM_ID \
inner join dbo.employer emp on BIL.employer_id=emp.employer_id \
WHERE a.stop_date IS NULL \
AND a.address_type = 'R' \
AND v.alt_identifier=?1 \
FETCH FIRST 1 ROWS ONLY


ace.querySql.secondaryActivation = SELECT  UNIQUE P.SSN AS AN_SOC_SEC_NUM,P_REL.SSN AS JA_SOC_SEC_NUM, P.ALT_IDENTIFIER \
FROM DBO.PERSON P INNER JOIN \
DBO.MEMBER M  ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON M.MEMBER_ID=MC.MEMBER_ID \
  INNER JOIN DBO.DISBURSE_SCHEDULE DS ON DS.INSURED_ID = M.MEMBER_ID \
INNER JOIN DBO.PLAN PL ON PL.PLAN_ID = MC.PLAN_ID \
INNER JOIN DBO.BILLING_ENTITY BE ON MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON BER.ENTITY_ID = 254 \
AND BER.KEY_VALUE = P.PERSON_ID \
AND BER.SOURCE_ENTITY_ID = 798 \
AND BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PERSON P_REL ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
AND PA.OWNER_BUSINESS_ENTITY_KEY_ID = P_REL.BUSINESS_ENTITY_KEY_ID \
AND PA.ESTIMATE_FLAG ='N' \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.PAYMENT_FORM PF ON PA.APPLICATION_ID=PF.PENSION_APPLICATION_ID \
JOIN DBO.ATTRIBUTE_VALUE ATTRVAL ON p.DEATH_NOTIFICATION_SOURCE = ATTRVAL.INTERNAL_VALUE \
INNER JOIN DBO.ATTRIBUTE ATTR ON ATTRVAL.ATTRIBUTE_ID = ATTR.ATTRIBUTE_ID \
JOIN DBO.MEMBER MEM ON P.PERSON_ID = MEM.MEMBER_ID \
JOIN DBO.MEMBER_CONTRACT MC ON MEM.MEMBER_ID = MC.MEMBER_ID \
JOIN DBO.PLAN PL ON MC.PLAN_ID = PL.PLAN_ID \
JOIN DBO.PENSION_PLAN PPL ON PL.PLAN_CODE = PPL.PENSION_PLAN_CODE \
JOIN DBO.ANNUITY_TYPE AT ON PPL.PENSION_PLAN_ID = AT.PENSION_PLAN_ID \
WHERE \
PF.BASIC_AMOUNT > 0  \
and p.ssn <> P_REL.ssn \
and p.death_date is not null and p.status = 'D' \
and ps.status_name='Initial' \
and pbt.INTERNAL_NAME = ?1 \
and DS.DISBURSEMENT_TYPE is NULL \
  and P.CITIZENSHIP_COUNTRY_ID = 2 \
order by p.ssn \
fetch first 1 rows only \

ace.querySql.mgipPayee=SELECT P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID",	\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH	\
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'	\
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6	\
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI	\
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID   \
AND STI.EXPORT_FLAG     = 'Y'	\
INNER JOIN DBO.DISBURSEMENT D	\
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR    \
ON DR.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)   \
INNER JOIN DBO.V_ANNUITANT P	\
ON p.alt_identifier=sti.annuitant_id	\
INNER JOIN DBO.MEMBER_CONTRACT MC	\
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D'   \
INNER JOIN DBO.BILLING_ENTITY BE ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA	\
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID    \
INNER JOIN DBO.PAYMENT_FORM PF  \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID    \
inner join client.application_variable vv on pa.application_id =vv.application_id   \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1	\
inner join dbo.product pp on pp.product_id=be.product_id and short_name=?2	\
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT	\
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID	\
and PBT.INTERNAL_NAME='IIA'	\
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350   \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3	\
and ds.disbursement_schedule_id=dr.disbursement_schedule_id   \
INNER JOIN BENEFIT_ACCOUNT BA	\
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4	\
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5	\
fetch first 1 rows only

ace.querySql.mgipBene=SELECT PE.ALT_IDENTIFIER,   \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"  \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID   \
AND STI.EXPORT_FLAG     = 'Y'   \
INNER JOIN DBO.DISBURSEMENT D   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR  \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID   \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)  \
INNER JOIN DBO.PERSON PE    \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER   \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER   \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1    \
INNER JOIN DBO.MEMBER_CONTRACT MC   \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'  \
INNER JOIN DBO.BILLING_ENTITY BE ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA   \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id    \
INNER JOIN DBO.PAYMENT_FORM PF  \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID    \
inner join client.application_variable vv on pa.application_id =vv.application_id   \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2  \
inner join dbo.product pp on pp.product_id=be.product_id and long_name=?3   \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   \
and PBT.INTERNAL_NAME='IIA' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS ON DS.SOURCE_ENTITY=350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID   \
AND DS.SCHEDULE_TYPE            = ?4 \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA  \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID    \
AND BA.INTERNAL_NAME LIKE ?5 AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6  \
fetch first 1 rows only

ace.querySql.mgipStopReissue=SELECT \
P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR  \
ON (DR.DISBURSEMENT_ID = D.DISBURSEMENT_ID or dr.disbursement_id=d.replacement_disbursement_id) \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)  \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and pp.long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='IIA' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='R' \
and (dsh.old_status='R1' or dsh.old_status='SR')  \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5 \
fetch first 1 rows only

ace.querySql.mgipOverpaymentBene=SELECT PE.ALT_IDENTIFIER,	\
BE.BILLING_ENTITY_CODE as "groupID",	\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH	\
INNER JOIN DBO.EXPORT_DEFINITION ED	\
ON EH.EXPORT_ID= ED.EXPORT_ID	\
AND ED.INTERNAL_NAME = 'STI_EXPORT'	\
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7	\
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI	\
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID	\
AND STI.EXPORT_FLAG= 'Y'	\
INNER JOIN DBO.DISBURSEMENT D	\
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID	\
AND D.OVERPAYMENT_FLAG='Y'	\
INNER JOIN DBO.DISBURSEMENT_REQUEST DR	\
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)	\
INNER JOIN DBO.PERSON PE	\
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER	\
INNER JOIN BUSINESS_ENTITY_RELATION BER	\
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID	\
INNER JOIN ENTITY_RELATIONSHIP ER	\
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID	\
AND ER.ENTITY_RELATIONSHIP_NAME like ?1	\
INNER JOIN DBO.MEMBER_CONTRACT MC	\
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'	\
INNER JOIN DBO.BILLING_ENTITY BE	\
ON MC.BILLING_ID=BE.BILLING_ID	\
INNER JOIN DBO.PENSION_APPLICATION PA	\
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id	\
INNER JOIN DBO.PAYMENT_FORM PF	\
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID	\
inner join client.application_variable vv on pa.application_id =vv.application_id	\
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2	\
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?3	\
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT	\
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID	\
and PBT.INTERNAL_NAME='IIA' INNER JOIN DBO.DISBURSE_SCHEDULE DS	\
ON DS.SOURCE_ENTITY=350 AND DS.SOURCE_KEY= PA.APPLICATION_ID	\
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID	\
AND DS.SCHEDULE_TYPE=?4 INNER JOIN BENEFIT_ACCOUNT BA	\
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID	\
AND BA.INTERNAL_NAME LIKE ?5	\
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6	\
fetch first 1 rows only



ace.querySql.mgipJoint=SELECT PE.ALT_IDENTIFIER,\
BE.BILLING_ENTITY_CODE as "groupID",                                                                              \
D.Disbursement_id as "Disbursement Id",                                                                           \
d.DISBURSEMENT_AMT as "Net Amount"                                                                                \
FROM DBO.EXPORT_HEADER EH                                                                                         \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                               \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                                        \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                                        \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6                                                                   \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                                          \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                                     \
AND STI.EXPORT_FLAG     = 'Y'                                                                                     \
INNER JOIN DBO.DISBURSEMENT D                                                                                     \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID                                                                        \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                                            \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID  AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)  \
INNER JOIN DBO.PERSON PE                                                                                          \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER                                                                             \
INNER JOIN BUSINESS_ENTITY_RELATION BER                                                                           \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID                                                           \
INNER JOIN ENTITY_RELATIONSHIP ER                                                                                 \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID                                                           \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1                                                                    \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                                 \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'        \
INNER JOIN DBO.BILLING_ENTITY BE                                                                                  \
ON MC.BILLING_ID=BE.BILLING_ID                                                                                    \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                             \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id  \
INNER JOIN DBO.PAYMENT_FORM PF                                                                                    \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                                  \
inner join client.application_variable vv on pa.application_id =vv.application_id                                 \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2                                       \
inner join dbo.product pp on pp.product_id=be.product_id                                                          \
and pp.long_name=?3                                                                     \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                           \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                                         \
and PBT.INTERNAL_NAME='IIA'                                                                                       \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                               \
ON DS.SOURCE_ENTITY             = 350                                                                             \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                               \
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID                                                     \
AND DS.SCHEDULE_TYPE            =?4                                                                             \
INNER JOIN BENEFIT_ACCOUNT BA                                                                                     \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                                  \
AND BA.INTERNAL_NAME LIKE ?5                                                                     \
AND NVL(BA.NON_TAXABLE_FLAG,'N') ='Y'                                                                           \
fetch first 1 rows only

ace.querySql.mgipScheduledAdjustment=SELECT P.ALT_IDENTIFIER,																			\
BE.BILLING_ENTITY_CODE as "groupID",                                                                \
D.Disbursement_id,                                                                                  \
d.DISBURSEMENT_AMT as "Net Amount"                                                                  \
FROM DBO.EXPORT_HEADER EH                                                                           \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                 \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                          \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                          \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6                                                     \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                            \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                       \
AND STI.EXPORT_FLAG     = 'Y'                                                                       \
INNER JOIN DBO.DISBURSEMENT D                                                                       \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID                                                          \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P                                                                        \
ON p.alt_identifier=sti.annuitant_id                                                                \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                   \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D'                                       \
INNER JOIN DBO.BILLING_ENTITY BE                                                                    \
ON MC.BILLING_ID=BE.BILLING_ID                                                                      \
INNER JOIN DBO.PENSION_APPLICATION PA                                                               \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID                                                    \
INNER JOIN DBO.PAYMENT_FORM PF                                                                      \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                    \
inner join client.application_variable vv on pa.application_id =vv.application_id                   \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1                         \
inner join dbo.product pp on pp.product_id=be.product_id                                            \
and pp.long_name=?2                                                       \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                             \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                           \
and PBT.INTERNAL_NAME='IIA'                                                                         \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                 \
ON DS.SOURCE_ENTITY             = 350                                                               \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                 \
AND DS.SCHEDULE_TYPE            =?3                                                               \
inner join dbo.disb_schedule_increase dsi on dsi.DISBURSEMENT_SCHEDULE_ID=ds.DISBURSEMENT_SCHEDULE_ID   \
and dsi.INCREASE_FREQUENCY_TYPE in ('R')                                                            \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA                                                                       \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                     \
AND BA.INTERNAL_NAME LIKE ?4                                                           \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5                                                              \
fetch first 1 rows only


ace.querySql.mgipSplit=SELECT P.ALT_IDENTIFIER,																				\
BE.BILLING_ENTITY_CODE as "groupID",                                                                   \
D.Disbursement_id,                                                                                     \
d.DISBURSEMENT_AMT as "Net Amount"                                                                     \
FROM DBO.EXPORT_HEADER EH                                                                              \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                    \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                             \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                             \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6                                                       \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                               \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                          \
AND STI.EXPORT_FLAG     = 'Y'                                                                          \
INNER JOIN DBO.DISBURSEMENT D                                                                          \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='I'                               \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                                 \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID  AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)                                                           \
INNER JOIN DBO.V_ANNUITANT P                                                                           \
ON p.alt_identifier=sti.annuitant_id                                                                   \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                      \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D'                                          \
INNER JOIN DBO.BILLING_ENTITY BE                                                                       \
ON MC.BILLING_ID=BE.BILLING_ID                                                                         \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                  \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID                                                       \
INNER JOIN DBO.PAYMENT_FORM PF                                                                         \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                       \
inner join client.application_variable vv on pa.application_id =vv.application_id                      \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1                            \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                              \
and PBT.INTERNAL_NAME='IIA'                                                                            \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                    \
ON DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID                                           \
AND DS.SCHEDULE_TYPE            = ?3                                                                  \
inner JOIN DBO.eft_authorization e on                                                                  \
e.recipient_entity_id=254 and e.recipient_key_value=p.person_id and (e.percent not in (1,0) or e.eft_amount<>0)             \
INNER JOIN BENEFIT_ACCOUNT BA                                                                          \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                        \
AND BA.INTERNAL_NAME LIKE ?4                                                              \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5                                                                 \
fetch first 1 rows only

ace.querySql.mgipQdro=SELECT PE.ALT_IDENTIFIER,																				\
BE.BILLING_ENTITY_CODE as "groupID",                                                                   \
D.Disbursement_id,                                                                                     \
d.DISBURSEMENT_AMT as "Net Amount"                                                                                         \
FROM DBO.EXPORT_HEADER EH                                                                                        \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                              \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                                       \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                                       \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7                                                                \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                                         \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                                    \
AND STI.EXPORT_FLAG     = 'Y'                                                                                    \
INNER JOIN DBO.DISBURSEMENT D                                                                                    \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID                                                                       \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                                           \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID  AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)                                                                    \
INNER JOIN DBO.PERSON PE                                                                                         \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER                                                                            \
INNER JOIN BUSINESS_ENTITY_RELATION BER                                                                          \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID                                                          \
INNER JOIN ENTITY_RELATIONSHIP ER                                                                                \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID                                                          \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1                                                                    \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                                \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'       \
INNER JOIN DBO.BILLING_ENTITY BE                                                                                 \
ON MC.BILLING_ID=BE.BILLING_ID                                                                                   \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                            \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id \
inner join client.application_variable vv on pa.application_id =vv.application_id                                \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2                                    \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?3           \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                          \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                                        \
and PBT.INTERNAL_NAME='IIA'                                                                                      \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                              \
ON                                                                                                               \
DS.SOURCE_ENTITY             = 350                                                                               \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                              \
AND                                                                                                              \
DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID                                                        \
AND DS.SCHEDULE_TYPE            =?4                                                                            \
INNER JOIN BENEFIT_ACCOUNT BA                                                                                    \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                                 \
AND BA.INTERNAL_NAME LIKE ?5                                                                        \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6                                                                          \
fetch first 1 rows only

ace.querySql.IIAOverpaymentPayee=SELECT P.ALT_IDENTIFIER,											    \
BE.BILLING_ENTITY_CODE as "groupID",                                                                   \
D.Disbursement_id,                                                                                     \
d.DISBURSEMENT_AMT as "Net Amount"                                                                     \
FROM DBO.EXPORT_HEADER EH                                                                              \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                    \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                             \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                             \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6                                                         \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                               \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                          \
AND STI.EXPORT_FLAG     = 'Y'                                                                          \
INNER JOIN DBO.DISBURSEMENT D                                                                          \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID                                                             \
AND D.OVERPAYMENT_FLAG='Y'                                                                             \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                                  \
ON DR.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)    \
INNER JOIN DBO.V_ANNUITANT P                                                                           \
ON p.alt_identifier=sti.annuitant_id                                                                   \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                      \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D'                                          \
INNER JOIN DBO.BILLING_ENTITY BE                                                                       \
ON MC.BILLING_ID=BE.BILLING_ID                                                                         \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                  \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID                                                       \
INNER JOIN DBO.PAYMENT_FORM PF                                                                         \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                       \
inner join client.application_variable vv on pa.application_id =vv.application_id                      \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1                            \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                              \
and PBT.INTERNAL_NAME='IIA'                                                                            \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                    \
ON DS.SOURCE_ENTITY             = 350                                                                  \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                    \
AND DS.SCHEDULE_TYPE            = ?3                                                                  \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id                                           \
INNER JOIN BENEFIT_ACCOUNT BA                                                                          \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                        \
AND BA.INTERNAL_NAME LIKE ?4                                                              \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5                                                                 \
fetch first 1 rows only

ace.querySql.secondaryActivation = SELECT  UNIQUE P.SSN AS AN_SOC_SEC_NUM,P_REL.ALT_IDENTIFIER AS JA_SOC_SEC_NUM, P.ALT_IDENTIFIER \
FROM DBO.PERSON P INNER JOIN \
DBO.MEMBER M  ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON M.MEMBER_ID=MC.MEMBER_ID \
  INNER JOIN DBO.DISBURSE_SCHEDULE DS ON DS.INSURED_ID = M.MEMBER_ID \
INNER JOIN DBO.PLAN PL ON PL.PLAN_ID = MC.PLAN_ID \
INNER JOIN DBO.BILLING_ENTITY BE ON MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON BER.ENTITY_ID = 254 \
AND BER.KEY_VALUE = P.PERSON_ID \
AND BER.SOURCE_ENTITY_ID = 798 \
AND BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PERSON P_REL ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
AND PA.OWNER_BUSINESS_ENTITY_KEY_ID = P_REL.BUSINESS_ENTITY_KEY_ID \
AND PA.ESTIMATE_FLAG ='N' \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.PAYMENT_FORM PF ON PA.APPLICATION_ID=PF.PENSION_APPLICATION_ID \
JOIN DBO.ATTRIBUTE_VALUE ATTRVAL ON p.DEATH_NOTIFICATION_SOURCE = ATTRVAL.INTERNAL_VALUE \
INNER JOIN DBO.ATTRIBUTE ATTR ON ATTRVAL.ATTRIBUTE_ID = ATTR.ATTRIBUTE_ID \
JOIN DBO.MEMBER MEM ON P.PERSON_ID = MEM.MEMBER_ID \
JOIN DBO.MEMBER_CONTRACT MC ON MEM.MEMBER_ID = MC.MEMBER_ID \
JOIN DBO.PLAN PL ON MC.PLAN_ID = PL.PLAN_ID \
JOIN DBO.PENSION_PLAN PPL ON PL.PLAN_CODE = PPL.PENSION_PLAN_CODE \
JOIN DBO.ANNUITY_TYPE AT ON PPL.PENSION_PLAN_ID = AT.PENSION_PLAN_ID \
WHERE \
PF.BASIC_AMOUNT > 0  \
and p.ssn <> P_REL.ssn \
and p.death_date is not null and p.status = 'D' \
and ps.status_name='Initial' \
and pbt.INTERNAL_NAME = ?1 \
and DS.DISBURSEMENT_TYPE is NULL \
  and P.CITIZENSHIP_COUNTRY_ID = 2 \
order by p.ssn \
fetch first 1 rows only \
  
ace.querySql.fetchProdBene = SELECT  UNIQUE P.SSN AS AN_SOC_SEC_NUM,P_REL.ALT_IDENTIFIER AS JA_SOC_SEC_NUM, P.ALT_IDENTIFIER , DS.DISBURSEMENT_TYPE, P.CITIZENSHIP_COUNTRY_ID, PF.payment_form_name \
FROM DBO.PERSON P INNER JOIN \
DBO.MEMBER M  ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.DISBURSE_SCHEDULE DS ON DS.INSURED_ID = M.MEMBER_ID \
INNER JOIN DBO.PLAN PL ON PL.PLAN_ID = MC.PLAN_ID \
INNER JOIN DBO.BILLING_ENTITY BE ON MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON BER.ENTITY_ID = 254 \
AND BER.KEY_VALUE = P.PERSON_ID \
AND BER.SOURCE_ENTITY_ID = 798 \
AND BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.PERSON P_REL ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
AND PA.OWNER_BUSINESS_ENTITY_KEY_ID = P_REL.BUSINESS_ENTITY_KEY_ID \
AND PA.ESTIMATE_FLAG ='N' \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.PAYMENT_FORM PF ON PA.APPLICATION_ID=PF.PENSION_APPLICATION_ID \
JOIN DBO.ATTRIBUTE_VALUE ATTRVAL ON p.DEATH_NOTIFICATION_SOURCE = ATTRVAL.INTERNAL_VALUE \
INNER JOIN DBO.ATTRIBUTE ATTR ON ATTRVAL.ATTRIBUTE_ID = ATTR.ATTRIBUTE_ID \
JOIN DBO.MEMBER MEM ON P.PERSON_ID = MEM.MEMBER_ID \
JOIN DBO.MEMBER_CONTRACT MC ON MEM.MEMBER_ID = MC.MEMBER_ID \
JOIN DBO.PLAN PL ON MC.PLAN_ID = PL.PLAN_ID \
JOIN DBO.PENSION_PLAN PPL ON PL.PLAN_CODE = PPL.PENSION_PLAN_CODE \
JOIN DBO.ANNUITY_TYPE AT ON PPL.PENSION_PLAN_ID = AT.PENSION_PLAN_ID \
WHERE \
ATTR.ATTRIBUTE_NAME = 'DEATH_NOTIFICATION_SOURCE' \
and PF.BASIC_AMOUNT > 0 \
and p.ssn <> P_REL.ssn \
and p.death_date is not null and p.status = 'D' \
and ps.status_name IN ('Death Benefit in Process') \
and pbt.INTERNAL_NAME  = ?1 \
and ER.INTERNAL_NAME like '%BENEFICIARY%' \
and P.CITIZENSHIP_COUNTRY_ID = 2 \
AND PF.PAYMENT_FORM_NAME IN ('Term Certain and Life Annuity', 'Joint and Survivor Life Annuity') \
order by p.ssn \
fetch first 1 rows only \

ace.querySql.mgipCreditCorrection=SELECT pe.alt_identifier,																						\
BE.BILLING_ENTITY_CODE as "groupID",                                                                            \
D.Disbursement_id as "Disbursement Id",                                                                         \
d.DISBURSEMENT_AMT as "Net Amount"                                                                              \
FROM DBO.EXPORT_HEADER EH                                                                                       \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                             \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                                      \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                                      \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6                                                                 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                                        \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                                   \
AND STI.EXPORT_FLAG     = 'Y'                                                                                   \
INNER JOIN DBO.DISBURSEMENT D                                                                                   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID and d.disbursement_type='A'                                          \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                                          \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID  AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE                                                                                        \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER                                                                           \
INNER JOIN BUSINESS_ENTITY_RELATION BER                                                                         \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID                                                         \
INNER JOIN ENTITY_RELATIONSHIP ER                                                                               \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID                                                         \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1                                                                 \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                               \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'      \
INNER JOIN DBO.BILLING_ENTITY BE                                                                                \
ON MC.BILLING_ID=BE.BILLING_ID                                                                                  \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                           \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id	\
INNER JOIN DBO.PAYMENT_FORM PF                                                                                  \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                                \
inner join client.application_variable vv on pa.application_id =vv.application_id                               \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2                                     \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?3                          \
INNER JOIN DBO.PLAN PL ON PL.PRODUCT_ID=PP.PRODUCT_ID                                                           \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                         \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                                       \
and PBT.INTERNAL_NAME='IIA'                                                                                     \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                             \
ON                                                                                                              \
DS.SOURCE_ENTITY             = 350                                                                              \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                             \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA                                                                                   \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                                \
AND BA.INTERNAL_NAME LIKE ?4                                                                  \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5                                                                          \
fetch first 1 rows only

ace.querySql.mgipbulkpayment=SELECT P.ALT_IDENTIFIER,																			\
BE.BILLING_ENTITY_CODE as "groupID",                                                              \
D.Disbursement_id,                                                                                \
d.DISBURSEMENT_AMT as "Net Amount"                                                                \
FROM DBO.EXPORT_HEADER EH                                                                         \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                               \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                        \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                        \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?5                                                   \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                          \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                     \
AND STI.EXPORT_FLAG     = 'Y'                                                                     \
INNER JOIN DBO.DISBURSEMENT D                                                                     \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID                                                        \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                            \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)                                                        \
inner join dbo.transaction tr on  dr.source_key_value = tr.trans_id                               \
and dr.source_entity_id = dbo.pkg_benefit_s.f_get_entity_id('TRANSACTION')                        \
inner join dbo.trans_detail td on tr.trans_id = td.trans_id                                       \
inner join dbo.bulk_disb_request bdr on td.ref_trans_id = bdr.trans_id                            \
inner join DBO.DISBURSEMENT_REQUEST DRq                                                           \
ON drq.DISBURSEMENT_request_ID = bdr.DISBURSEMENT_request_ID                                      \
INNER JOIN DBO.V_ANNUITANT P                                                                      \
on p.person_id=bdr.tax_recipient_key_value and bdr.tax_recipient_entity_id=254 and p.status='L'   \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                 \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='B'                                     \
INNER JOIN DBO.BILLING_ENTITY BE                                                                  \
ON MC.BILLING_ID=BE.BILLING_ID                                                                    \
INNER JOIN DBO.PENSION_APPLICATION PA                                                             \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID                                                  \
INNER JOIN DBO.PAYMENT_FORM PF                                                                    \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                  \
inner join client.application_variable vv on pa.application_id =vv.application_id                 \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1                       \
inner join dbo.product pp on pp.product_id=be.product_id                                          \
and pp.long_name=?2                                                     \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                           \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                         \
and PBT.INTERNAL_NAME='IIA'                                                                       \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                               \
ON DS.SOURCE_ENTITY             = 350                                                             \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                               \
AND DS.SCHEDULE_TYPE            = ?3                                                             \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA   \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                   \
AND BA.INTERNAL_NAME LIKE '%THIRD_PARTY_REMIT%'                                                   \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?4                                                           \
fetch first 1 rows only

ace.querySql.QuoteInitiated= SELECT  \
p.alt_identifier,  \
mc.member_contract_id,  \
COUNT(pa.application_id) count_of_pension_applications  \
FROM  \
dbo.member m  \
JOIN dbo.member_contract      mc ON mc.member_id = m.member_id  \
AND mc.member_contract_status <> 'IP'  \
AND mc.benefit_payment_type = 'D'  \
JOIN dbo.billing_entity       be ON be.billing_id = mc.billing_id  \
AND be.employer_id = mc.employer_id  \
JOIN dbo.product              pr ON pr.product_id = be.product_id  \
JOIN dbo.product_benefit_type pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
AND pbt.internal_name = 'CLOSEOUTS'  \
JOIN dbo.person               p ON p.person_id = m.person_id  \
AND p.status = 'L'  \
JOIN (  \
SELECT  \
mc.member_contract_id,  \
COUNT(pa.member_contract_id) count_of_plans  \
FROM  \
dbo.member_contract mc  \
JOIN dbo.pension_application pa ON pa.member_contract_id = mc.member_contract_id  \
GROUP BY  \
mc.member_contract_id  \
)                        xy ON xy.member_contract_id = mc.member_contract_id  \
AND xy.count_of_plans = 1  \
JOIN dbo.pension_application  pa ON pa.member_contract_id = xy.member_contract_id  \
AND pa.status_id = 133  \
JOIN dbo.annuity_option       ao ON ao.annuity_option_id = pa.annuity_option_id  \
JOIN dbo.annuity_type at ON at.annuity_type_id = ao.annuity_type_id  \
AND at.annuity_type_id<>133  \
GROUP BY  \
p.alt_identifier,  \
mc.member_contract_id  \
HAVING  \
COUNT(pa.application_id) = 1 FETCH FIRST 1 ROWS ONLY


ace.querySql.BankingDetailsCNGIIA=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN eft_authorization eft \
ON eft.recipient_key_value=a.person_id and eft.recipient_entity_id=254 \
INNER JOIN contact_info ci \
ON ci.key_value=p.person_id \
WHERE \
a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'IIA' ) \
AND eft.disbursement_type is not null \
AND ci.CVAL_01 is not null \
ORDER BY dbms_random.random \
fetch first 1 row only  \

ace.querySql.stiCOPremium=select trans_id,business_event,group_number,\
transaction_code,amount,memo_code,amount_code,data_string   \
from client.sti_export_history where TRANS_ID=?1 order by \
sti_export_history_id desc  \
FETCH FIRST 1 ROWS ONLY

ace.querySql.stiCOPremiumFlowthrough=select trans_id,business_event,group_number,    \
transaction_code,amount,memo_code,amount_code,data_string   \
from client.sti_export_history where TRANS_ID=?1 and transaction_code=?2 order by sti_export_history_id desc    \
FETCH FIRST 1 ROWS ONLY

ace.querySql.COPremium=SELECT be.billing_entity_code GroupNumber,   \
sti.trans_id as TransID \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?2   \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID and   \
sti.sti_trans_type='PRP' and sti.transaction_code=?1    \
AND STI.EXPORT_FLAG     = 'Y'   \
INNER JOIN DBO.BILLING_ENTITY BE    \
ON BE.BILLING_ENTITY_CODE=STI.GROUP_NUMBER  \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   \
and PBT.INTERNAL_NAME='CLOSEOUTS'   \
FETCH FIRST 1 ROWS ONLY


ace.querySql.IIABankChangeStartDirectDepositLetterUSLivingv2 = SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v  \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE  \
and v.alt_identifier = bek.alt_key_code  \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id  \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N'  \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id  \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id  \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id  \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id  \
inner join dbo.pension_status ps on ps.status_id = pa.status_id  \
AND ps.pension_status_code NOT IN ('IIA_CANCELLED','IIA_NOT_TAKEN','IIA_UNLOCKED')  \
inner join dbo.addresses a on v.person_id=a.key_value and a.country = 'US' and a.stop_date is null \
and a.address_type='R'  \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.deduction_template ded2 on ded2.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.deduction_template_detail dedt2 on dedt2.deduction_template_id=ded2.deduction_template_id \
where pbt.internal_name = 'IIA'  \
and ds.sched_status<> 'C'  \
and ds.schedule_type = 'R'  \
  and p.primary_identifier_id !=40 \
  and ds.next_disb_type= 'C'  \
and v.status='L' \ 
AND mc.member_contract_status!='IP' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
    and dedt2.deduction_type !='ST' \
and dedt2.zero_deduction_flag='N' \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1  


ace.querySql.IIABankChangeStartDirectDepositLetternonUSLivingv2 = SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v  \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE  \
and v.alt_identifier = bek.alt_key_code  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id  \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N'  \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id  \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id  \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id  \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id  \
inner join dbo.pension_status ps on ps.status_id = pa.status_id  \
AND ps.pension_status_code NOT IN ('IIA_CANCELLED','IIA_NOT_TAKEN','IIA_UNLOCKED')  \
inner join dbo.addresses a on v.person_id=a.key_value and a.country != 'US' and a.stop_date is null \
and a.address_type='R'  \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'IIA'  \
and ds.sched_status<> 'C'  \
and ds.schedule_type = 'R'  \
and ds.next_disb_type= 'C'  \
  and p.primary_identifier_id !=40 \
AND p.citizenship_country_id is not null \
  AND mc.member_contract_status!='IP' \
and v.status='L' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
inner join dbo.deduction_template ded2 on ded2.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.deduction_template_detail dedt2 on dedt2.deduction_template_id=ded2.deduction_template_id \
WHERE v2.alt_identifier=v.alt_identifier \
and dedt2.deduction_type !='ST' \
and dedt2.zero_deduction_flag='N' \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1  


ace.querySql.SSABankChangeStartDirectDepositLetternonUSLivingv2 = SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v  \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE  \
and v.alt_identifier = bek.alt_key_code  \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id  \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N'  \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id  \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id  \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id  \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id  \
inner join dbo.pension_status ps on ps.status_id = pa.status_id  \
and ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED')  \
inner join dbo.addresses a on v.person_id=a.key_value and a.country != 'US' and a.stop_date is null \
and a.address_type='R'  \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'STRUCTURED'  \
and ds.sched_status<> 'C'  \
and ds.schedule_type = 'R'  \
  and p.primary_identifier_id !=40 \
  and ds.next_disb_type= 'C'  \
AND mc.member_contract_status!='IP' \
and v.status='L' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
inner join dbo.deduction_template ded2 on ded2.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.deduction_template_detail dedt2 on dedt2.deduction_template_id=ded2.deduction_template_id \
WHERE v2.alt_identifier=v.alt_identifier \
and dedt2.deduction_type !='ST' \
and dedt2.zero_deduction_flag='N' \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1 

ace.querySql.SSABankChangeStartDirectDepositLetterUSLivingv2 = SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v  \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE  \
and v.alt_identifier = bek.alt_key_code  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id  \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N'  \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id  \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id  \
inner join  dbo.BENEFIT_ACCOUNT BA on DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
  inner join dbo.billing_entity be on be.billing_id = mc.billing_id  \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id  \
inner join dbo.pension_status ps on ps.status_id = pa.status_id  \
and ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED')  \
inner join dbo.addresses a on v.person_id=a.key_value and a.country = 'US' and a.stop_date is null \
and a.address_type='R'  \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'STRUCTURED'  \
and ds.sched_status<> 'C'  \
and ds.schedule_type = 'R'  \
and p.primary_identifier_id !=40 \
  and ba.non_taxable_flag='Y' \
  and ds.next_disb_type= 'C' \
  AND mc.member_contract_status!='IP' \
  and v.status='L'

ace.querySql.COFedModify = SELECT distinct \
a.alt_identifier AS annuitant_alt_id, \
pdt.long_name    AS product_name, \
pbt.display_name AS product_benefit_type, \
mc.member_contract_code_01, \
DED_TYPE.description, \
DTD.DEDUCTION_AMT \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
p.status = 'L' \
AND a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
AND Upper(DED_TYPE.description)  IN ( \
'FEDERAL TAX' ) \
AND DTD.DEDUCTION_AMT>0; \
  
ace.querySql.SSAFedModify = SELECT distinct \
a.alt_identifier AS annuitant_alt_id, \
pdt.long_name    AS product_name, \
pbt.display_name AS product_benefit_type, \
mc.member_contract_code_01, \
DED_TYPE.description, \
DTD.DEDUCTION_AMT \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
p.status = 'L' \
AND a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'STRUCTURED') \
AND Upper(DED_TYPE.description)  IN ( \
'FEDERAL TAX' ) \
AND DTD.DEDUCTION_AMT>0; \

ace.querySql.lotteryPayee=SELECT P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id, \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)  \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='LOTTERIES' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3    \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
inner JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5   \
fetch first 1 rows only

ace.querySql.lotteryOverpayment=SELECT P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id, \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND D.OVERPAYMENT_FLAG='Y' and sti.business_event = 'PYT' and sti.sti_trans_type = 'OPM' \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and pp.long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='LOTTERIES' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3 \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5   \
fetch first 1 rows only

ace.querySql.lotteryBene=SELECT PE.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1 \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id \
and pp.long_name=?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='LOTTERIES' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON \
DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND \
DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
AND DS.SCHEDULE_TYPE            =?4 \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?5    \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6 \
fetch first 1 rows only

ace.querySql.stopReissueLA=SELECT \
P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)    \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='LOTTERIES' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='R' \
and (dsh.old_status='R1' and dsh.new_status='R') \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
inner JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5 \
fetch first 1 rows only

ace.querySql.voidReissueLA=SELECT \
P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
inner JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='LOTTERIES' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='R' \
and (dsh.old_status='VR' and dsh.new_status='R2')   \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5 \
fetch first 1 rows only



ace.querySql.TaxwithholdletterconfirmationCONONUSLivingv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country <>'US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'CLOSEOUTS' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
and  BA.NON_TAXABLE_FLAG is null \
AND mc.member_contract_status!='IP'\
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='N' \
AND p.citizenship_country_id is not null

ace.querySql.TaxwithholdletterconfirmationSSANONUSLivingv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country <>'US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
and  BA.NON_TAXABLE_FLAG is null \
AND mc.member_contract_status!='IP'\
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='N' \
AND p.citizenship_country_id is not null

ace.querySql.AnnuitantDynamicDetailsMailingAddress=select v.alt_identifier,v.ssn,v.first_name,v.middle_name, v.last_name, \
a.ADDRESS_1,a.ADDRESS_2,a.ADDRESS_3,a.CITY,a.STATE, a.ZIP, a.COUNTRY, a.POSTAL_CODE \
FROM dbo.V_ANNUITANT v \
LEFT JOIN dbo.business_entity_key bek ON v.person_id = bek.key_value AND v.alt_identifier = bek.alt_key_code \
LEFT JOIN dbo.addresses a ON v.person_id = a.key_value AND a.stop_date IS NULL AND a.address_type = 'M' \
JOIN dbo.member me on v.person_id = me.person_id \
JOIN DBO.MEMBER_CONTRACT MC ON ME.MEMBER_ID= MC.MEMBER_ID \
LEFT JOIN DBO.BILLING_ENTITY BIL ON MC.BILLING_ID= BIL.BILLING_ID \
WHERE a.stop_date IS NULL \
AND a.address_type = 'M' \
AND v.alt_identifier=?1



ace.querySql.thirdpartyCOAnnuitant = SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
p.status = 'L' \
AND a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name =?1 \
AND Upper(DED_TYPE.description) NOT IN ('LIEN', 'CHILD SUPPORT', 'BANKRUPTCY' )  \
ORDER BY dbms_random.random \
fetch first 1 row only \


ace.querySql.heldandsuspendCGA=SELECT \
P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and pp.long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='CGA' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
and (dsh.old_status='I' and dsh.new_status='H') \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5 \
fetch first 1 rows only

ace.querySql.voidReissueCGA=SELECT \
P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='CGA' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='R' \
and (dsh.old_status='VR' and dsh.new_status='R2') and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5 \
fetch first 1 rows only

ace.querySql.acceleratedPaymentCGA=SELECT PE.ALT_IDENTIFIER,\
BE.BILLING_ENTITY_CODE as "groupID",                                                                              \
D.Disbursement_id as "Disbursement Id",                                                                           \
d.DISBURSEMENT_AMT as "Net Amount"                                                                                \
FROM DBO.EXPORT_HEADER EH                                                                                         \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                               \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                                        \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                                        \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7                                                                  \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                                          \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                                     \
AND STI.EXPORT_FLAG     = 'Y' and sti.business_event = 'PYT' and sti.Transaction_code = 'AP'                                                                                   \
INNER JOIN DBO.DISBURSEMENT D                                                                                     \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID                                                                        \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                                            \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID                                                                         \
INNER JOIN DBO.PERSON PE                                                                                          \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER                                                                             \
INNER JOIN BUSINESS_ENTITY_RELATION BER                                                                           \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID                                                           \
INNER JOIN ENTITY_RELATIONSHIP ER                                                                                 \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID                                                           \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1                                                                    \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                                 \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'        \
INNER JOIN DBO.BILLING_ENTITY BE                                                                                  \
ON MC.BILLING_ID=BE.BILLING_ID                                                                                    \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                             \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id  \
INNER JOIN DBO.PAYMENT_FORM PF                                                                                    \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                                  \
inner join client.application_variable vv on pa.application_id =vv.application_id                                 \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2                                       \
inner join dbo.product pp on pp.product_id=be.product_id                                                          \
and pp.long_name=?3                                                                     \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                           \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                                         \
and PBT.INTERNAL_NAME='CGA'                                                                                       \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                               \
ON DS.SOURCE_ENTITY             = 350                                                                             \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                               \
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID                                                     \
AND DS.SCHEDULE_TYPE            =?4                                                                             \
INNER JOIN BENEFIT_ACCOUNT BA                                                                                     \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                                  \
AND BA.INTERNAL_NAME LIKE ?5                                                                     \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6                                                                           \
fetch first 1 rows only

ace.querySql.creditCorrectionCGA=SELECT pe.alt_identifier,																						\
BE.BILLING_ENTITY_CODE as "groupID",                                                                            \
D.Disbursement_id as "Disbursement Id",                                                                         \
d.DISBURSEMENT_AMT as "Net Amount"                                                                              \
FROM DBO.EXPORT_HEADER EH                                                                                       \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                             \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                                      \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                                      \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6                                                                \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                                        \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                                   \
AND STI.EXPORT_FLAG     = 'Y'                                                                                   \
INNER JOIN DBO.DISBURSEMENT D                                                                                   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID and d.disbursement_type='A'                                          \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                                          \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID   \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE                                                                                        \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER                                                                           \
INNER JOIN BUSINESS_ENTITY_RELATION BER                                                                         \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID                                                         \
INNER JOIN ENTITY_RELATIONSHIP ER                                                                               \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID                                                         \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1                                                                 \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                               \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'      \
INNER JOIN DBO.BILLING_ENTITY BE                                                                                \
ON MC.BILLING_ID=BE.BILLING_ID                                                                                  \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                           \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id	\
INNER JOIN DBO.PAYMENT_FORM PF                                                                                  \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                                \
inner join client.application_variable vv on pa.application_id =vv.application_id                               \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2                                     \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?3                          \
INNER JOIN DBO.PLAN PL ON PL.PRODUCT_ID=PP.PRODUCT_ID                                                           \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                         \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                                       \
and PBT.INTERNAL_NAME='CGA'                                                                                     \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                             \
ON                                                                                                              \
DS.SOURCE_ENTITY             = 350                                                                              \
AND DS.SOURCE_KEY             = PA.APPLICATION_ID  and ds.disbursement_schedule_id=dr.disbursement_schedule_id  \
INNER JOIN BENEFIT_ACCOUNT BA                                                                                   \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                                \
AND BA.INTERNAL_NAME LIKE ?4                                                                  \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5                                                                          \
fetch first 1 rows only

ace.querySql.nontaxPayeeCGA=SELECT P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID",	\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH	\
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'	\
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?5	\
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI	\
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID   \
AND STI.EXPORT_FLAG     = 'Y'	\
INNER JOIN DBO.DISBURSEMENT D	\
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON DR.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
and dr.disbursement_type<>'E' \
INNER JOIN DBO.V_ANNUITANT P	\
ON p.alt_identifier=sti.annuitant_id	\
INNER JOIN DBO.MEMBER_CONTRACT MC	\
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D'   \
INNER JOIN DBO.BILLING_ENTITY BE ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA	\
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID    \
INNER JOIN DBO.PAYMENT_FORM PF  \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID    \
inner join client.application_variable vv on pa.application_id =vv.application_id   \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1	\
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?2	\
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT	\
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID	\
and PBT.INTERNAL_NAME='CGA'	\
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350   \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3	\
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA	\
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4	\
AND NVL(BA.NON_TAXABLE_FLAG,'N')='Y'	\
fetch first 1 rows only

ace.querySql.STIDetailsH_S=select distinct annuitant_id,\
business_event,GROUP_NUMBER,transaction_code,disbursement_id, \
memo_code,amount_code,disbursement_status,export_flag,amount,data_string \
from client.sti_export_history \
where disbursement_id=?1 order by sti_export_history_id desc    \
fetch first 1 rows only


ace.querySql.STIAcceleratedPayment=select distinct annuitant_id,\
business_event,GROUP_NUMBER,transaction_code,disbursement_id, \
memo_code,amount_code,disbursement_status,export_flag,amount,data_string \
from client.sti_export_history \
where disbursement_id=?1 and transaction_code='AP'  \
fetch first 1 rows only

ace.querySql.COBankChangeStopDirectDepositLetterUSLivingv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \ \
  from dbo.V_ANNUITANT v   \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE   \
and v.alt_identifier = bek.alt_key_code   \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code  \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id   \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID   \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \ \
  JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id   \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key  \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id   \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id   \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id   \
inner join dbo.pension_status ps on ps.status_id = pa.status_id   \
and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED')   \
inner join dbo.addresses a on v.person_id=a.key_value and a.country = 'US' and a.stop_date is null  \
and a.address_type='R'   \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id   \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code  \
where pbt.internal_name = 'CLOSEOUTS'   \
and ds.sched_status<> 'C'   \
and ds.schedule_type = 'R'   \
and p.primary_identifier_id !=40  \
and ds.next_disb_type= 'E'   \
and  a.country = 'US'   \
and p.citizenship_country_id is not null \
AND mc.member_contract_status!='IP' \
and v.status='L' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
inner join dbo.deduction_template ded2 on ded2.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.deduction_template_detail dedt2 on dedt2.deduction_template_id=ded2.deduction_template_id \
WHERE v2.alt_identifier=v.alt_identifier \
and dedt2.deduction_type !='ST' \
and dedt2.zero_deduction_flag='N' \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1

ace.querySql.COBankChangeStopDirectDepositLetterNonUSLivingv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \ \
  from dbo.V_ANNUITANT v   \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE   \
and v.alt_identifier = bek.alt_key_code   \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code  \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id   \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID   \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \ \
  JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id   \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key  \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id   \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id   \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id   \
inner join dbo.pension_status ps on ps.status_id = pa.status_id   \
and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED')   \
inner join dbo.addresses a on v.person_id=a.key_value and a.country <> 'US' and a.stop_date is null  \
and a.address_type='R'   \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id   \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code  \
where pbt.internal_name = 'CLOSEOUTS'   \
and ds.sched_status<> 'C'   \
and ds.schedule_type = 'R'   \
  and p.primary_identifier_id !=40  \
  and ds.next_disb_type= 'E'   \
  and  a.country <> 'US'   \
and p.citizenship_country_id is not null \
AND mc.member_contract_status!='IP' \
and v.status='L' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
inner join dbo.deduction_template ded2 on ded2.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.deduction_template_detail dedt2 on dedt2.deduction_template_id=ded2.deduction_template_id \
WHERE v2.alt_identifier=v.alt_identifier \
and dedt2.deduction_type !='ST' \
and dedt2.zero_deduction_flag='N' \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1

ace.querySql.secAnnuitantheldandsuspendLA=SELECT PE.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)  \
inner JOIN DBO.PERSON PE \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1 \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2 \
inner join dbo.product pp on pp.product_id=be.product_id \
and pp.long_name=?3 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='LOTTERIES' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON \
DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND \
DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
AND DS.SCHEDULE_TYPE            = ?4 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
and (dsh.old_status='I' and dsh.new_status='H') \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?5 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6 \
fetch first 1 rows only

ace.querySql.creditCorrectionLA=SELECT pe.alt_identifier,																						\
BE.BILLING_ENTITY_CODE as "groupID",                                                                            \
D.Disbursement_id as "Disbursement Id",                                                                         \
d.DISBURSEMENT_AMT as "Net Amount"                                                                              \
FROM DBO.EXPORT_HEADER EH                                                                                       \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                             \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                                      \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                                      \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6                                                                \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                                        \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                                   \
AND STI.EXPORT_FLAG     = 'Y'                                                                                   \
INNER JOIN DBO.DISBURSEMENT D                                                                                   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID and d.disbursement_type='A'                                          \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                                          \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID  AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)                                                                    \
INNER JOIN DBO.PERSON PE                                                                                        \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER                                                                           \
INNER JOIN BUSINESS_ENTITY_RELATION BER                                                                         \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID                                                         \
INNER JOIN ENTITY_RELATIONSHIP ER                                                                               \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID                                                         \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1                                                                 \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                               \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'      \
INNER JOIN DBO.BILLING_ENTITY BE                                                                                \
ON MC.BILLING_ID=BE.BILLING_ID                                                                                  \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                           \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id	\
INNER JOIN DBO.PAYMENT_FORM PF                                                                                  \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                                \
inner join client.application_variable vv on pa.application_id =vv.application_id                               \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2                                     \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?3                          \
INNER JOIN DBO.PLAN PL ON PL.PRODUCT_ID=PP.PRODUCT_ID                                                           \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                         \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                                       \
and PBT.INTERNAL_NAME='LOTTERIES'                                                                                     \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                             \
ON                                                                                                              \
DS.SOURCE_ENTITY             = 350                                                                              \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                             \
INNER JOIN BENEFIT_ACCOUNT BA                                                                                   \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                                \
AND BA.INTERNAL_NAME LIKE ?4                                                                  \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5                                                                          \
fetch first 1 rows only

ace.querySql.acceleratedPaymentLA=SELECT P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id, \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.business_event = 'PYT' and sti.Transaction_code = 'AP' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and pp.long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='LOTTERIES' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3 \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5 \
fetch first 1 rows only

ace.querySql.SecAnnuitanCGA=SELECT PE.ALT_IDENTIFIER,   \
BE.BILLING_ENTITY_CODE as "groupID",    \
D.Disbursement_id,  \
d.DISBURSEMENT_AMT as "Net Amount"  \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7  \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID   \
AND STI.EXPORT_FLAG     = 'Y'   \
INNER JOIN DBO.DISBURSEMENT D   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID  \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR  \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)  \
INNER JOIN DBO.PERSON PE    \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER   \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER   \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1    \
INNER JOIN DBO.MEMBER_CONTRACT MC   \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'  \
INNER JOIN DBO.BILLING_ENTITY BE ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA   \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id    \
INNER JOIN DBO.PAYMENT_FORM PF  \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID    \
inner join client.application_variable vv on pa.application_id =vv.application_id   \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2  \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?3   \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   \
and PBT.INTERNAL_NAME='CGA' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS ON DS.SOURCE_ENTITY=350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID   \
AND DS.SCHEDULE_TYPE            = ?4 \
INNER JOIN BENEFIT_ACCOUNT BA  \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID    \
AND BA.INTERNAL_NAME LIKE ?5 AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6  \
fetch first 1 rows only

ace.querySql.secApplicationStopReissueCGA=SELECT PE.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID",                                                                               \
D.Disbursement_id,                                                                                                 \
d.DISBURSEMENT_AMT as "Net Amount"                                                                                 \
FROM DBO.EXPORT_HEADER EH                                                                                          \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                                \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                                         \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                                         \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7                                                         \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                                           \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                                      \
AND STI.EXPORT_FLAG     = 'Y'                                                                                      \
INNER JOIN DBO.DISBURSEMENT D                                                                                      \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID                                                                         \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE                                                                                           \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER                                                                              \
INNER JOIN BUSINESS_ENTITY_RELATION BER                                                                            \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID                                                            \
INNER JOIN ENTITY_RELATIONSHIP ER                                                                                  \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID                                                            \
AND ER.ENTITY_RELATIONSHIP_NAME like ?1                                                                    \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                                  \
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'         \
INNER JOIN DBO.BILLING_ENTITY BE ON MC.BILLING_ID=BE.BILLING_ID                                                    \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                              \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id   \
INNER JOIN DBO.PAYMENT_FORM PF                                                                                     \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                                                   \
inner join client.application_variable vv on pa.application_id =vv.application_id                                  \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2                                       \
inner join dbo.product pp on pp.product_id=be.product_id                                                           \
and pp.long_name=?3                                                      \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                            \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                                          \
and PBT.INTERNAL_NAME='CGA'                                                                                        \
INNER JOIN DBO.DISBURSE_SCHEDULE DS ON DS.SOURCE_ENTITY=350                                                        \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                                \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                                \
AND DS.SCHEDULE_TYPE            = ?4                                                                             \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID AND D.DISBURSEMENT_STATUS='R'      \
and (dsh.old_status='R1' and dsh.new_status='R')                                                                   \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA                                                                                      \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                                   \
AND BA.INTERNAL_NAME LIKE ?5                                                                         \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6                                                                           \
fetch first 1 rows only

ace.querySql.secapplicationOverpaymentCGA=SELECT PE.ALT_IDENTIFIER,	\
BE.BILLING_ENTITY_CODE as "groupID",	\
D.Disbursement_id,	\
d.DISBURSEMENT_AMT as "Net Amount"	\
FROM DBO.EXPORT_HEADER EH	\
INNER JOIN DBO.EXPORT_DEFINITION ED	\
ON EH.EXPORT_ID= ED.EXPORT_ID	\
AND ED.INTERNAL_NAME = 'STI_EXPORT'	\
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?7	\
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI	\
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID	\
AND STI.EXPORT_FLAG= 'Y'	\
INNER JOIN DBO.DISBURSEMENT D	\
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID	\
AND D.OVERPAYMENT_FLAG='Y'	\
INNER JOIN DBO.DISBURSEMENT_REQUEST DR	\
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)	\
INNER JOIN DBO.PERSON PE	\
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER	\
INNER JOIN BUSINESS_ENTITY_RELATION BER	\
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID	\
INNER JOIN ENTITY_RELATIONSHIP ER	\
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID	\
AND ER.ENTITY_RELATIONSHIP_NAME like ?1	\
INNER JOIN DBO.MEMBER_CONTRACT MC	\
ON ber.source_key_value=mc.member_contract_id and ber.source_entity_id=798 and mc.benefit_payment_type='D'	\
INNER JOIN DBO.BILLING_ENTITY BE	\
ON MC.BILLING_ID=BE.BILLING_ID	\
INNER JOIN DBO.PENSION_APPLICATION PA	\
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID and PA.BUSINESS_ENTITY_RELATION=ber.business_entity_relation_id	\
INNER JOIN DBO.PAYMENT_FORM PF	\
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID	\
inner join client.application_variable vv on pa.application_id =vv.application_id	\
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?2	\
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?3	\
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT	\
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID	\
and PBT.INTERNAL_NAME='CGA' INNER JOIN DBO.DISBURSE_SCHEDULE DS	\
ON DS.SOURCE_ENTITY=350 AND DS.SOURCE_KEY= PA.APPLICATION_ID	\
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID	\
AND DS.SCHEDULE_TYPE=?4 INNER JOIN BENEFIT_ACCOUNT BA	\
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID	\
AND BA.INTERNAL_NAME LIKE ?5	\
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?6	\
fetch first 1 rows only

ace.querySql.LifeAnnuity =  SELECT distinct  be.billing_entity_code gac,pbt.internal_name,be.billing_entity_name,'Annuitant'   \
role,p.alt_identifier,mc.member_contract_id,p.first_name first_name,p.middle_name middle_name,p.last_name last_name,  \
decode(p.status, 'L', 'Living', 'D', 'Deceased','PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
 p.status) life_status,  \
decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee','D', 'Disability', 'IP',  \
'Immediate Pay','R','Retired', 'S','Survivor','T','Terminated', 'TV','Term Vested',mc.member_contract_status)employment_status,  \
decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed','D', 'Deferred', 'H', 'Hold', 'P','Pending',mc.member_contract_code_01)  \
pay_status,pa.pension_effective_date annuity_commencement_date,decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay','S', 'On Hold',   \
 'C', 'Complete', 'QP','Queued','OF','OFAC On Hold','AP','Approval Pending','P','Pending','DR','Draft','D','Denied',ds.sched_status) status,  \
decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',mc.benefit_payment_type)payment_type,pa.application_id,pf.payment_form_name, plan_identifier, pl.plan_name, mc.member_contract_code_04 \
FROM dbo.member m  \
INNER JOIN dbo.member_contract mc ON mc.member_id = m.member_id JOIN dbo.person p ON p.person_id = m.person_id JOIN dbo.pension_application pa ON pa.member_contract_id = mc.member_contract_id JOIN dbo.billing_entity be ON be.billing_id = mc.billing_id  \
AND be.employer_id = mc.employer_id JOIN dbo.product pr ON pr.product_id = be.product_id JOIN dbo.product_benefit_type pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id JOIN dbo.plan pl ON pl.plan_id = mc.plan_id JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id AND pf.selected_flag = 'Y' AND pf.master_payment_form_id IS NULL LEFT JOIN dbo.disburse_schedule ds ON ds.source_key = pa.application_id  \
WHERE  \
pbt.internal_name IN ( 'CLOSEOUTS' ) AND mc.member_contract_status NOT IN ('TV' ,'A' ) AND mc.benefit_payment_type = 'D' AND mc.member_contract_code_01 = 'IP' AND p.status='L' AND ds.sched_status= 'A' and plan_identifier= '01' AND mc.member_contract_status! = 'IP'  \
And mc.member_contract_payment_status != 'IM' AND pf.payment_form_name= 'Life Annuity' AND mc.member_contract_code_04='AF' ORDER BY DBMS_RANDOM.value FETCH FIRST 1 ROWS only

ace.querySql.BankStopSSAUS= SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
and ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country = 'US' and a.stop_date is null \
and a.address_type='R' \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status<> 'C' \
and ds.schedule_type = 'R' \
and p.primary_identifier_id !=40 \
and ds.next_disb_type= 'E' \
and  a.country = 'US' \
and p.citizenship_country_id is not null \
and v.status='L' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1

ace.querySql.BankingDetailsCNGCO=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN eft_authorization eft \
ON eft.recipient_key_value=a.person_id and eft.recipient_entity_id=254 \
INNER JOIN contact_info ci \
ON ci.key_value=p.person_id \
WHERE \
a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'CLOSEOUTS' ) \
AND eft.disbursement_type is not null \
AND ci.CVAL_01 is not null \
ORDER BY dbms_random.random \
fetch first 1 row only \
  
ace.querySql.BankingDetailsCNGSSA=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN eft_authorization eft \
ON eft.recipient_key_value=a.person_id and eft.recipient_entity_id=254 \
WHERE \
a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'STRUCTURED' ) \
AND eft.disbursement_type is not null \
ORDER BY dbms_random.random \
fetch first 1 row only \


ace.querySql.BankStopIIAAUS=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
  from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
  JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
and ps.pension_status_code NOT IN ('IIA_CANCELLED',  'IIA_NOT_TAKEN',  'IIA_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country = 'US' and a.stop_date is null \
and a.address_type='R' \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'IIA' \
and ds.sched_status<> 'C' \
and ds.schedule_type = 'R' \
and p.primary_identifier_id !=40 \
and bek.search_text_02 is null  \
and ds.next_disb_type= 'E' \
and  a.country = 'US' \
and a.address_type != 'M' \
and a.address_3 is null \
and p.citizenship_country_id is not null \
and v.status='L'\
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1

ace.querySql.BankStopIIANONUS=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
  from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
  JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
and ps.pension_status_code NOT IN ('IIA_CANCELLED',  'IIA_NOT_TAKEN',  'IIA_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country != 'US' and a.stop_date is null \
and a.address_type='R' \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'IIA' \
and ds.sched_status<> 'C' \
and ds.schedule_type = 'R' \
and p.primary_identifier_id !=40 \
and ds.next_disb_type= 'E' \
and  a.country != 'US' \
and  a.country != 'CA' \
and a.address_type != 'M' \
and a.address_3 is null \
and a.address_2 is null \
and p.citizenship_country_id is not null \
and v.status='L'\
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1

ace.querySql.BankStopSSANONUS= SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
from   dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
inner join dbo.person p on v.person_id=p.person_id \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.eft_authorization eft on eft.recipient_key_value=v.person_id \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL \
AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
and pa.application_id = ds.source_key \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value \
and a.country != 'US' \
and a.stop_date is null \
and a.address_type='R' \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status<> 'C' \
and ds.schedule_type = 'R' \
and ds.next_disb_type= 'E' \
and  a.country != 'CA' \
and a.address_type != 'M' \
and a.address_3 is null \
and a.address_2 is null \
and p.citizenship_country_id is not null \
and p.primary_identifier_id !=40 \
and v.status='L' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1

ace.querySql.BankStartCOUS=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
  from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join  dbo.BENEFIT_ACCOUNT BA on DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id  \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country = 'US' and a.stop_date is null  \
and a.address_type='R' \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'CLOSEOUTS' \
and ds.sched_status<> 'C' \
and ds.schedule_type = 'R' \
and p.primary_identifier_id !=40 \
and ds.next_disb_type= 'C' \
and  a.country = 'US' \
and p.citizenship_country_id is not null \
and v.status='L' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1

ace.querySql.SSINCOMEVERNOCERT=SELECT v.alt_identifier,v.first_name,v.last_name, v.ssn,ds.payee_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.payment_form paymentForm on paymentForm.PAYMENT_FORM_ID = ds.PAYMENT_FORM_ID \
inner join dbo.benefit_account beneAcc on beneAcc.benefit_account_id = ds.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C'\
and ds.schedule_type = 'R'\
and v.status='L' \
AND mc.member_contract_status!='IP' \
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='Y' \
and paymentForm.PAYMENT_FORM_CODE= ?1 \
and v.suffix is null \
AND p.citizenship_country_id is not null \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1 \
AND ds.SCHED_STATUS='A' \
AND beneAcc.description NOT LIKE '%Non Taxable%' \
GROUP BY v.alt_identifier,v.first_name,v.last_name,v.ssn,ds.payee_name \
HAVING COUNT(v.alt_identifier)=1 AND COUNT(v.ssn)=1 AND COUNT(ds.payee_name)=1


ace.querySql.AnnuitantTaxDetails=SELECT v.alt_identifier, \
(case dtd.deduction_type when 'ST' then 'State Tax' \
when 'F' then 'Federal Tax' \
when 'LT' then 'LOCAL Tax' end) StateWithHoldings_Deduction_type, \
dtd.start_date StateWithHoldings_Start_date, \
dtd.stop_date StateWithHoldings_Stop_date, \
coalesce(dtd.deduction_amt,0) StateWithHoldings_Additional_withholding_amount, \
dtd.deduction_pct*100 StateWithHoldings_Percentage, \
(case dtd.zero_deduction_flag when 'Y' then 'Yes' \
when 'N' then 'No' end) StateWithHoldings_Zero_StateWithHoldings, \
(case dtd1.deduction_type when 'ST' then 'Fed Tax' \
when 'F' then 'Federal Tax' \
when 'LT' then 'LOCAL Tax' end) FedWithHoldings_Deduction_type, \
dtd1.start_date FedWithHoldings_Start_date, \
dtd1.stop_date FedWithHoldings_Stop_date, \
coalesce(dtd1.deduction_amt,0) FedWithHoldings_Additional_withholding_amount, \
dtd1.deduction_pct*100 FedWithHoldings_Percentage, \
(case dtd1.zero_deduction_flag when 'Y' then 'Yes' \
when 'N' then 'No' end) FedWithHoldings_Zero_FedWithHoldings, \
disc.start_date as Benefit_Start_Date, \
disc.pay_cycle_type as Payment_Frequency , \
disc.gross_amount as BENEFIT_AMOUNT \
FROM dbo.V_ANNUITANT v  \
LEFT JOIN dbo.business_entity_key bek ON v.person_id = bek.key_value AND v.alt_identifier = bek.alt_key_code \
LEFT JOIN dbo.addresses a ON v.person_id = a.key_value AND a.stop_date IS NULL AND a.address_type = 'R'  \
JOIN dbo.member me on v.person_id = me.person_id  \
JOIN DBO.MEMBER_CONTRACT MC ON ME.MEMBER_ID= MC.MEMBER_ID \
LEFT JOIN DBO.BILLING_ENTITY BIL ON MC.BILLING_ID= BIL.BILLING_ID  \
left JOIN DBO.PENSION_APPLICATION PA ON mc.member_contract_id = PA.member_contract_id \
left join dbo.payment_form pay on pa.application_id = pay.pension_application_id \
left join dbo.disburse_schedule disc on pay.pension_application_id = disc.source_key \
and pay.payment_form_id=disc.payment_form_id \
and disc.payee_key=v.person_id \
and disc.source_entity=350 \
left join DBO.deduction_template DT on disc.disbursement_schedule_id=dt.disbursement_schedule_id  \
left JOIN DBO.DEDUCTION_TEMPLATE_DETAIL dtd ON  dt.deduction_template_id=DTD.DEDUCTION_TEMPLATE_ID and  dtd.deduction_type='ST' \
JOIN DBO.DEDUCTION_TEMPLATE_DETAIL dtd1 ON  dt.deduction_template_id=DTD1.DEDUCTION_TEMPLATE_ID and  dtd1.deduction_type='F' \
left join dbo.state S on dtd.state_id=s.state_id \
left join dbo.county c on dtd.COUNTY_ID=c.COUNTY_ID \
WHERE v.alt_identifier=?1


ace.querySql.fetchBulkCheckGroupid= WITH main_query \
     AS (SELECT be.billing_entity_code, \
                ogc.display_name, \
                og.option_group_id, \
                og.option_group_name, \
                og.option_group_code, \
                ann_op.annuity_option_name \
           FROM dbo.billing_Entity be \
                JOIN dbo.product p ON be.product_id = p.product_id \
                JOIN dbo.business_entity_key bek \
                   ON bek.key_code = be.billing_entity_code \
                JOIN dbo.plan pl \
                   ON pl.business_entity_key_id = bek.business_entity_key_id \
                JOIN dbo.pension_plan pp \
                   ON pl.plan_code = pp.pension_plan_code \
                JOIN dbo.option_group og \
                   ON og.pension_plan_id = pp.pension_plan_id \
                JOIN dbo.option_group_category ogc \
                   ON ogc.option_group_category_id = \
                         og.option_group_category_id \
                JOIN dbo.annuity_option ann_op \
                   ON ann_op.option_group_id = og.option_group_id \
          WHERE     be.product_benefit_type_id = 1 \
                AND pl.ip_indicator_flag = 'N' \
                AND NVL (BENEFIT_ADMIN_TYPE, 'D') <> 'D' ) \
SELECT * \
  FROM (SELECT billing_entity_code \
          FROM main_query \
         WHERE     option_group_name LIKE 'Purchased Form Package 2' \
               AND annuity_option_name LIKE 'Life Annuity' \
        INTERSECT \
        SELECT billing_entity_code \
          FROM main_query \
         WHERE     option_group_name LIKE 'Married Normal Form Package 1' \
               AND annuity_option_name LIKE \
                      '100 % Joint and Survivor Life Annuity' \
        INTERSECT \
        SELECT billing_entity_code \
          FROM main_query \
         WHERE     option_group_name LIKE \
                      'Optional Forms Package 1 - Participant' \
               AND annuity_option_name LIKE \
                      '120 Months Term Certain and Life Annuity') \
 WHERE ROWNUM <= 1

ace.querySql.BankStartCONONUS=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
  from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
and v.alt_identifier = bek.alt_key_code \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join  dbo.BENEFIT_ACCOUNT BA on DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id  \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id \
and ps.pension_status_code not in ('APPL_DENIED','CANCELLED','J_CANCELLED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country != 'US' and a.stop_date is null  \
and a.address_type='R' \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'CLOSEOUTS' \
and ds.sched_status<> 'C' \
and ds.schedule_type = 'R' \
and p.primary_identifier_id !=40 \
and ds.next_disb_type= 'C' \
and  a.country != 'US' \
and  a.country != 'CA' \
and a.address_type != 'M' \
and a.address_3 is null \
and a.address_2 is null \
and p.citizenship_country_id is not null \
and v.status='L' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1

ace.querySql.InPayJointAnnuitant= SELECT  \
  distinct  be.billing_entity_code                  gac, \
pbt.internal_name, \
    be.billing_entity_name, \
    'Annuitant'                             role, \
    p.alt_identifier, \
    mc.member_contract_id, \
    p.first_name                            first_name, \
    p.middle_name                           middle_name, \
    p.last_name                             last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                        life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
           'Immediate Pay', \
'R', \
           'Retired', \
'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)       employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
mc.member_contract_code_01)      pay_status, \
    pa.pension_effective_date               annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                 status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', \
           'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)     status_reason, \
    pr.short_name, \
    p.death_date                            death_date, \
    p.death_notification_date               death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', \
           'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)     death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)         payment_type, \
    pa.application_id, \
    pf.payment_form_name, plan_identifier, pl.plan_name \
FROM \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'D' \
    AND mc.member_contract_code_01 = 'IP' \
    AND p.status='D' \
    AND ds.sched_status= 'A' \
      AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' \
    AND  pf.payment_form_name ='100 % Joint and Survivor Life Annuity' \
    AND  p.death_notification_source IS NOT NULL \
    AND  p.death_notification_date IS NOT NULL \
UNION ALL \
SELECT \
distinct  be.billing_entity_code                  gac, \
    pbt.internal_name, \
    be.billing_entity_name, \
    er.entity_relationship_name             role, \
    p.alt_identifier, \
    mc.member_contract_id, \
    p.first_name                            first_name, \
    p.middle_name                           middle_name, \
    p.last_name                             last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                        life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
           'Immediate Pay', \
           'R', \
           'Retired', \
           'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)       employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
           mc.member_contract_code_01)      pay_status, \
    pa.pension_effective_date               annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                 status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', \
           'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)     status_reason, \
    pr.short_name, \
    p.death_date                            death_date, \
    p.death_notification_date               death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', \
           'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)     death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)         payment_type, \
    pa.application_id, \
  pf.payment_form_name, plan_identifier, pl.plan_name \
FROM \
         dbo.member_contract mc \
    JOIN dbo.business_entity_relation    ber ON mc.member_contract_id = ber.source_key_value \
    JOIN dbo.entity_relationship         er ON ber.entity_relationship_id = er.entity_relationship_id \
    JOIN dbo.business_entity_key         bek ON ber.business_entity_key_id = bek.business_entity_key_id \
    JOIN dbo.person                      p ON bek.key_value = p.person_id \
    JOIN dbo.pension_application         pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity              be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                     pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type        pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                        pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form                pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule           ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status  IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'D' \
    AND mc.member_contract_code_01 = 'D' \
     AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' \
    AND er.entity_relationship_name ='Joint Annuitant' FETCH FIRST 1 ROWS only

ace.querySql.InPayAnnuitantBulkCheck = SELECT \
distinct  be.billing_entity_code                  gac, \
pbt.internal_name, \
be.billing_entity_name, \
'Annuitant'                             role, \
p.alt_identifier, \
mc.member_contract_id, \
p.first_name                            first_name, \
p.middle_name                           middle_name, \
p.last_name                             last_name, \
decode(p.status, 'L', 'Living', 'D', 'Deceased', \
'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
p.status)                        life_status, \
decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
'D', 'Disability', 'IP', \
'Immediate Pay', \
'R', \
'Retired', \
'S', \
'Survivor', \
'T', \
'Terminated', \
'TV', \
'Term Vested', \
mc.member_contract_status)       employment_status, \
decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
'D', 'Deferred', 'H', 'Hold', 'P', \
'Pending', \
mc.member_contract_code_01)      pay_status, \
pa.pension_effective_date               annuity_commencement_date, \
decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
'S', 'On Hold', 'C', 'Complete', 'QP', \
'Queued', \
'OF', \
'OFAC On Hold', \
'AP', \
'Approval Pending', \
'P', \
'Pending', \
'DR', \
'Draft', \
'D', \
'Denied', \
ds.sched_status)                 status, \
decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
'RE', 'Rejected EFTs', \
'PD', \
'Presumed Dead', \
'D', \
'Death', \
'DO', \
'Death-Overpaid', \
'R', \
'Reported for Escheatment', \
'LH', \
'Legal Hold', \
'BH', \
'Broker Hold', \
'O', \
'Other', \
'W', \
'Write Off', \
'EX', \
'Expired', \
'IP', \
'Immediate Pay', \
'AC', \
'Application Cancelled', \
'PI', \
'Paid in IP', \
'AR', \
'Approval Reversed', \
'IB', \
'Ineligible for Benefit', \
'IR', \
'IP - Revision', \
'UL', \
'Unable to Locate', \
'MR', \
'Missing Required Info', \
'EL', \
'Elimination of Liability Clause', \
'RC', \
'Remarriage Clause', \
'FC', \
'Full Commutation', \
'PC', \
'Partial Commutation', \ \
'CS', \
'Child Support Lien Network', \
'PQ', \
'Pending IPAQS Exclusion Ratio Calc', \
'EU', \
'Escheating - Uncashed checks', \
'ER', \
'Escheating - Rejected EFT',\
'TE', \
'Escheated - Terminal Age', \
'ED', \
'Escheating - Benefit Deferred', \
'EB', \
'Escheating - Benefit Refused', \
'EI', \
'Escheating - Insufficient Data', \
'EN', \
'Escheating - No Contact', \
'EP', \
'Escheating - No Response', \
'ES', \
'Escheating - Death Process', \
'EG', \
'Escheating - Ret Pkg NIGO', \
'ET', \
'Escheating - Ret Pkg Not Returned', \
'EK', \
'Escheating - Client Directed', \
'EC', \
'Escheating - Client Directed', \
'FL', \
'Failure to Provide Proof of Life', \
ds.sched_status_reason_code)     status_reason, \
pr.short_name, \
p.death_date                            death_date, \
p.death_notification_date               death_reporting_date, \
decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
'RM', \
'Returned Mail', \
'EO', \
'EDM Other', \
'OT', \
'Other', \
'ES', \
'EDM SSA/LN', \
'DE', \
'Data Enrichment', \
p.death_notification_source)     death_posted_by, \
decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
mc.benefit_payment_type)         payment_type, \
pa.application_id, \
pf.payment_form_name, plan_identifier, pl.plan_name \
FROM \
dbo.member m \
JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
JOIN dbo.person                  p ON p.person_id = m.person_id \
JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
AND be.employer_id = mc.employer_id \
JOIN dbo.product                 pr ON pr.product_id = be.product_id \
JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
AND pf.selected_flag = 'Y' \
AND pf.master_payment_form_id IS NULL \
LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
pbt.internal_name IN ( 'CLOSEOUTS' ) \
AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
AND mc.benefit_payment_type = 'B' \
AND mc.member_contract_code_04='AF' \
AND mc.member_contract_code_04!='IP' \
and plan_identifier= '01' \
AND p.status='L' \
AND ds.sched_status= 'A' FETCH FIRST 1 ROWS only

ace.querySql.deceasedLAAnnuitant=SELECT \
    pbt.internal_name, \
    be.billing_entity_code                                                              gac, \
    be.billing_entity_name, \
    'Annuitant'                                                                         role, \
    p.alt_identifier, \
    mc.member_contract_id, \
    p.first_name                                                                        first_name, \
    p.middle_name                                                                       middle_name, \
    p.last_name                                                                         last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                                                                    life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
           'Immediate Pay', \
           'R', \
           'Retired', \
           'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)                                                   employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
           mc.member_contract_code_01)                                                  pay_status, \
    pa.pension_effective_date                                                           annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                                                             status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', 'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)                                                 status_reason, \
    pr.short_name, \
    p.death_date                                                                        death_date, \
    p.death_notification_date                                                           death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', 'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)                                                 death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)                                                     payment_type, \
    pa.application_id \
FROM \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'LOTTERIES' )  and mc.member_contract_code_01='IP' and mc.benefit_payment_type='D' and ds.sched_status='A' and p.status='D' 

ace.querySql.JointBenefit= SELECT distinct \
p.alt_identifier AS joint_alt_id, \
pdt.long_name    AS product_name, \
pbt.display_name AS product_benefit_type, \
DTD.DEDUCTION_AMT as deduction_amount \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name = 'JOINT_ANNUITANT' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ( 'IIA' )\
AND Upper(DED_TYPE.description)  IN ( \
'FEDERAL TAX' ) \
AND DTD.DEDUCTION_AMT>0

ace.querySql.JointBenefitCO= SELECT distinct \
p.alt_identifier AS joint_alt_id, \
pdt.long_name    AS product_name, \
pbt.display_name AS product_benefit_type, \
DTD.DEDUCTION_AMT as deduction_amount \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name = 'JOINT_ANNUITANT' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ( 'CLOSEOUTS' )\
AND Upper(DED_TYPE.description)  IN ( \
'FEDERAL TAX' ) \
AND DTD.DEDUCTION_AMT>0

ace.querySql.JointBenefitSSA= SELECT distinct \
p.alt_identifier AS joint_alt_id, \
pdt.long_name    AS product_name, \
pbt.display_name AS product_benefit_type, \
DTD.DEDUCTION_AMT as deduction_amount \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name = 'JOINT_ANNUITANT' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ( 'STRUCTURED' )\
AND Upper(DED_TYPE.description)  IN ( \
'FEDERAL TAX' ) \
AND DTD.DEDUCTION_AMT>0


ace.querySql.JointBenefitCGA= SELECT distinct \
p.alt_identifier AS joint_alt_id, \
pdt.long_name    AS product_name, \
pbt.display_name AS product_benefit_type, \
DTD.DEDUCTION_AMT as deduction_amount \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name = 'JOINT_ANNUITANT' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ( 'CGA' )\
AND Upper(DED_TYPE.description)  IN ( \
'FEDERAL TAX' ) \
AND DTD.DEDUCTION_AMT>0

ace.querySql.CGAFedModify = SELECT distinct \
a.alt_identifier AS annuitant_alt_id, \
pdt.long_name    AS product_name, \
pbt.display_name AS product_benefit_type, \
mc.member_contract_code_01, \
DED_TYPE.description, \
DTD.DEDUCTION_AMT \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
p.status = 'L' \
AND a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'CGA') \
AND Upper(DED_TYPE.description)  IN ( \
'FEDERAL TAX' ) \
AND DTD.DEDUCTION_AMT>0;


ace.querySql.IIAFedBeneModify = SELECT distinct        p.alt_identifier AS bene_alt_id,        er.internal_name AS person_type,        pdt.long_name    AS product_name,        a.alt_identifier AS annuitant_alt_id,        pbt.display_name AS product_benefit_type, 	   DED_TYPE.description as tax_type,        DTD.DEDUCTION_AMT AS deduction_amount FROM   dbo.person p        INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id        INNER JOIN entity_relationship ER                ON ER.entity_relationship_id = BER.entity_relationship_id        INNER JOIN member_contract mc                ON mc.member_contract_id = ber.source_key_value                   AND BER.source_entity_id = 798        INNER JOIN person a                ON a.person_id = ber.key_value                   AND ber.entity_id = 254        INNER JOIN billing_entity be                ON mc.billing_id = be.billing_id        INNER JOIN product pdt                ON pdt.product_id = be.product_id        INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id        INNER JOIN disburse_schedule ds                ON ds.person_id=p.person_id        INNER JOIN dbo.deduction_template DT                ON DT.disbursement_schedule_id = ds.disbursement_schedule_id        INNER JOIN dbo.deduction_template_detail DTD                ON DT.deduction_template_id = DTD.deduction_template_id        LEFT JOIN dbo.deduction_type DED_TYPE               ON DED_TYPE.deduction_type = DTD.deduction_type WHERE  er.internal_name = 'BENEFICIARY'        AND a.status='D' \
AND p.status = 'L'        AND ds.sched_status='A'        AND ds.next_pay_end_date is not null        AND pbt.internal_name IN ( 'IIA'  )        AND Upper(DED_TYPE.description) IN (                      'FEDERAL TAX' )        AND DTD.DEDUCTION_AMT>0

ace.querySql.COFedBeneModify = SELECT distinct        p.alt_identifier AS bene_alt_id,        er.internal_name AS person_type,        pdt.long_name    AS product_name,        a.alt_identifier AS annuitant_alt_id,        pbt.display_name AS product_benefit_type, 	   DED_TYPE.description as tax_type,        DTD.DEDUCTION_AMT AS deduction_amount FROM   dbo.person p        INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id        INNER JOIN entity_relationship ER                ON ER.entity_relationship_id = BER.entity_relationship_id        INNER JOIN member_contract mc                ON mc.member_contract_id = ber.source_key_value                   AND BER.source_entity_id = 798        INNER JOIN person a                ON a.person_id = ber.key_value                   AND ber.entity_id = 254        INNER JOIN billing_entity be                ON mc.billing_id = be.billing_id        INNER JOIN product pdt                ON pdt.product_id = be.product_id        INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id        INNER JOIN disburse_schedule ds                ON ds.person_id=p.person_id        INNER JOIN dbo.deduction_template DT                ON DT.disbursement_schedule_id = ds.disbursement_schedule_id        INNER JOIN dbo.deduction_template_detail DTD                ON DT.deduction_template_id = DTD.deduction_template_id        LEFT JOIN dbo.deduction_type DED_TYPE               ON DED_TYPE.deduction_type = DTD.deduction_type WHERE  er.internal_name = 'BENEFICIARY'        AND a.status='D' \
AND p.status = 'L'        AND ds.sched_status='A'        AND ds.next_pay_end_date is not null        AND pbt.internal_name IN ( 'CLOSEOUTS'  )        AND Upper(DED_TYPE.description) IN (                      'FEDERAL TAX' )        AND DTD.DEDUCTION_AMT>0


ace.querySql.CGAFedBeneModify = SELECT distinct        p.alt_identifier AS bene_alt_id,        er.internal_name AS person_type,        pdt.long_name    AS product_name,        a.alt_identifier AS annuitant_alt_id,        pbt.display_name AS product_benefit_type, 	   DED_TYPE.description as tax_type,        DTD.DEDUCTION_AMT AS deduction_amount FROM   dbo.person p        INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id        INNER JOIN entity_relationship ER                ON ER.entity_relationship_id = BER.entity_relationship_id        INNER JOIN member_contract mc                ON mc.member_contract_id = ber.source_key_value                   AND BER.source_entity_id = 798        INNER JOIN person a                ON a.person_id = ber.key_value                   AND ber.entity_id = 254        INNER JOIN billing_entity be                ON mc.billing_id = be.billing_id        INNER JOIN product pdt                ON pdt.product_id = be.product_id        INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id        INNER JOIN disburse_schedule ds                ON ds.person_id=p.person_id        INNER JOIN dbo.deduction_template DT                ON DT.disbursement_schedule_id = ds.disbursement_schedule_id        INNER JOIN dbo.deduction_template_detail DTD                ON DT.deduction_template_id = DTD.deduction_template_id        LEFT JOIN dbo.deduction_type DED_TYPE               ON DED_TYPE.deduction_type = DTD.deduction_type WHERE  er.internal_name = 'BENEFICIARY'        AND a.status='D' \
AND p.status = 'L'        AND ds.sched_status='A'        AND ds.next_pay_end_date is not null        AND pbt.internal_name IN ( 'cga'  )        AND Upper(DED_TYPE.description) IN (                      'FEDERAL TAX' )        AND DTD.DEDUCTION_AMT>0


ace.querySql.BankingDetailsJointCNGIIA=SELECT distinct \
p.alt_identifier AS joint_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN eft_authorization eft \
ON eft.recipient_key_value=p.person_id and eft.recipient_entity_id=254 \
WHERE  er.internal_name = 'JOINT_ANNUITANT' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ( 'IIA' ) \
AND eft.disbursement_type is not null \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AnnuitantDynamicDetails=SELECT v.alt_identifier,v.ssn,v.first_name,v.middle_name, v.last_name, v.suffix, v.marital_status, \
bek.search_text_02 AS PHONENUMBER,bek.search_text_03 AS EMAIL, \
a.ADDRESS_1,a.ADDRESS_2,a.ADDRESS_3,a.CITY,a.STATE, a.ZIP, a.COUNTRY, a.POSTAL_CODE, BIL.BILLING_ENTITY_CODE GROUP_NUMBER, \
BIL.BILLING_ENTITY_NAME GROUP_NAME,BIL.LEGAL_ENTITY_ID,  MC.CODE_01 AS ANUUITY_NUMBER \
FROM dbo.V_ANNUITANT v \
LEFT JOIN dbo.business_entity_key bek ON v.person_id = bek.key_value AND v.alt_identifier = bek.alt_key_code \
LEFT JOIN dbo.addresses a ON v.person_id = a.key_value AND a.stop_date IS NULL AND a.address_type = 'R' \
JOIN dbo.member me on v.person_id = me.person_id \
JOIN DBO.MEMBER_CONTRACT MC ON ME.MEMBER_ID= MC.MEMBER_ID \
LEFT JOIN DBO.BILLING_ENTITY BIL ON MC.BILLING_ID= BIL.BILLING_ID \
WHERE a.stop_date IS NULL \
AND a.address_type = 'R' \
AND v.alt_identifier=?1

ace.querySql.PayeeDetailsOverpaymentRecoupment=SELECT \
P.ALT_IDENTIFIER as "Alternate Id", \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id, \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID	AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID AND D.OVERPAYMENT_FLAG='Y' and sti.business_event = 'RMT' and sti.sti_trans_type = 'OPM' \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID \
INNER JOIN DBO.V_ANNUITANT P \
ON STI.ANNUITANT_ID = P.ALT_IDENTIFIER \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON MC.MEMBER_ID = P.MEMBER_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='CLOSEOUTS' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
AND DS.SCHEDULE_TYPE            = ?1 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?2 \
fetch first 1 row only

ace.querySql.PayeeDetailsOverpaymentRecoupmentQDRO=SELECT PE.ALT_IDENTIFIER as "Alternate Id", \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' and sti.business_event = 'RMT' and sti.sti_trans_type = 'OPM' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.PERSON PE \
ON STI.ANNUITANT_ID=PE.ALT_IDENTIFIER \
INNER JOIN BUSINESS_ENTITY_RELATION BER \
ON BER.BUSINESS_ENTITY_KEY_ID=PE.BUSINESS_ENTITY_KEY_ID \
INNER JOIN ENTITY_RELATIONSHIP ER \
ON ER.ENTITY_RELATIONSHIP_ID=BER.ENTITY_RELATIONSHIP_ID \
AND ER.ENTITY_RELATIONSHIP_NAME like 'QDRO%' \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON BER.SOURCE_KEY_VALUE=MC.MEMBER_CONTRACT_ID \
AND BER.SOURCE_ENTITY_ID = 798 \
and mc.benefit_payment_type='D' \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
inner join dbo.product pp on pp.product_id=be.product_id \
and long_name='Non-Par - MLIC' \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='CLOSEOUTS' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
AND DS.SCHEDULE_TYPE            = ?1 \
INNER JOIN BENEFIT_ACCOUNT BA \
ON DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME like ?2 \
fetch first 1 row only

ace.querySql.RolloverIIA=SELECT P.ALT_IDENTIFIER,														\
BE.BILLING_ENTITY_CODE as "groupID",                                                                     \
D.Disbursement_id,                                                                                       \
d.DISBURSEMENT_AMT as "Net Amount"                                                                       \
FROM DBO.EXPORT_HEADER EH                                                                                \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                                      \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                                               \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                                               \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?5	                                                        \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                                                 \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                                            \
AND STI.EXPORT_FLAG     = 'Y'                                                                            \
INNER JOIN DBO.DISBURSEMENT D                                                                            \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID                                                               \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR                                                                   \
ON D.DISBURSEMENT_ID = DR.DISBURSEMENT_ID                                                                \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)                                   \
INNER JOIN DBO.V_ANNUITANT P                                                                             \
ON p.alt_identifier=sti.annuitant_id                                                                     \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                                        \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D'                                            \
INNER JOIN DBO.BILLING_ENTITY BE                                                                         \
ON MC.BILLING_ID=BE.BILLING_ID                                                                           \
INNER JOIN DBO.PENSION_APPLICATION PA                                                                    \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID                                                         \
INNER JOIN DBO.PAYMENT_FORM PF                                                                           \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID AND PF.ROLLOVER_AMOUNT IS NOT NULL                      \
inner join client.application_variable vv on pa.application_id =vv.application_id                        \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1                              \
inner join dbo.product pp on pp.product_id=be.product_id and pp.long_name=?2   \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                                                  \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                                                \
and PBT.INTERNAL_NAME='IIA'                                                                              \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                                      \
ON DS.SOURCE_ENTITY             = 350                                                                    \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                                      \
AND DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID                                            \
AND DS.SCHEDULE_TYPE            = ?3                                                                    \
INNER JOIN BENEFIT_ACCOUNT BA                                                                            \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                                          \
AND BA.INTERNAL_NAME LIKE ?4                                                                   \
AND NVL(BA.NON_TAXABLE_FLAG,'N') ='Y'                                                                    \
fetch first 1 rows only

ace.querySql.FICAReimbursementIIA=SELECT  P.ALT_IDENTIFIER,	\
BE.BILLING_ENTITY_CODE as "groupID",                                                \
D.Disbursement_id as "Disbursement Id",                                             \
d.DISBURSEMENT_AMT as "Net Amount"                                                  \
FROM DBO.EXPORT_HEADER EH                                                           \
INNER JOIN DBO.EXPORT_DEFINITION ED                                                 \
ON EH.EXPORT_ID             = ED.EXPORT_ID                                          \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'                                          \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?5                                    \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI                                            \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID                                       \
AND STI.EXPORT_FLAG     = 'Y'                                                       \
INNER JOIN DBO.DISBURSEMENT D                                                       \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID                                          \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id      \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)             \
INNER JOIN DBO.V_ANNUITANT P                                                        \
ON p.alt_identifier=sti.annuitant_id                                                \
INNER JOIN DBO.MEMBER_CONTRACT MC                                                   \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D'                       \
INNER JOIN DBO.BILLING_ENTITY BE                                                    \
ON MC.BILLING_ID=BE.BILLING_ID                                                      \
inner join plan pl on pl.plan_id=mc.plan_id and pl.fica_exemption is not null       \
INNER JOIN DBO.PENSION_APPLICATION PA                                               \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID                                    \
INNER JOIN DBO.PAYMENT_FORM PF                                                      \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID                                    \
inner join client.application_variable vv on pa.application_id =vv.application_id   \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1          \
inner join dbo.product pp on pp.product_id=be.product_id                            \
and pp.long_name=?2                                                                 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT                                             \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID                           \
and PBT.INTERNAL_NAME='IIA'                                                         \
INNER JOIN DBO.DISBURSE_SCHEDULE DS                                                 \
ON DS.SOURCE_ENTITY             = 350                                               \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID                                 \
AND DS.SCHEDULE_TYPE            = ?3                                                \
and DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID                       \
and ds.disbursement_schedule_id=dr.disbursement_schedule_id                         \
INNER JOIN BENEFIT_ACCOUNT BA                                                       \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID                                     \
AND BA.INTERNAL_NAME LIKE ?4                                                        \
AND NVL(BA.NON_TAXABLE_FLAG,'N') ='N'                                               \
fetch first 1 rows only

ace.querySql.IIApayeenontax=SELECT P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?5 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id \
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7) \
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and pp.long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='IIA' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3 \
and DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID \
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') ='Y' \
fetch first 1 rows only

ace.querySql.heldandsuspend=SELECT \
P.ALT_IDENTIFIER, \
BE.BILLING_ENTITY_CODE as "groupID", \
D.Disbursement_id as "Disbursement Id", \
d.DISBURSEMENT_AMT as "Net Amount" \
FROM DBO.EXPORT_HEADER EH \
INNER JOIN DBO.EXPORT_DEFINITION ED \
ON EH.EXPORT_ID             = ED.EXPORT_ID \
AND ED.INTERNAL_NAME        = 'STI_EXPORT' \
AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?6 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID \
AND STI.EXPORT_FLAG     = 'Y' \
INNER JOIN DBO.DISBURSEMENT D \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID \
inner join dbo.disbursement_request dr on dr.disbursement_id=d.disbursement_id	\
AND to_char(to_date(DR.pay_cycle_date,'dd-MM-yy'), 'd') NOT IN (1,7)	\
INNER JOIN DBO.V_ANNUITANT P \
ON p.alt_identifier=sti.annuitant_id \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON P.MEMBER_ID = MC.MEMBER_ID and mc.benefit_payment_type='D' \
INNER JOIN DBO.BILLING_ENTITY BE \
ON MC.BILLING_ID=BE.BILLING_ID \
INNER JOIN DBO.PENSION_APPLICATION PA \
ON MC.MEMBER_CONTRACT_ID = PA.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PAYMENT_FORM PF \
ON PF.PENSION_APPLICATION_ID = PA.APPLICATION_ID \
inner join client.application_variable vv on pa.application_id =vv.application_id \
and vv.internal_name in ('LIFE_CONTGNT','LIFE_CONTINGENT') AND VV.VALUE=?1 \
inner join dbo.product pp on pp.product_id=be.product_id \
and pp.long_name=?2 \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID \
and PBT.INTERNAL_NAME='IIA' \
INNER JOIN DBO.DISBURSE_SCHEDULE DS \
ON DS.SOURCE_ENTITY             = 350 \
AND DS.SOURCE_KEY               = PA.APPLICATION_ID \
AND DS.SCHEDULE_TYPE            = ?3 \
INNER JOIN DBO.DISB_STATUS_HISTORY DSH ON DSH.DISBURSEMENT_ID=D.DISBURSEMENT_ID \
and (dsh.old_status='I' and dsh.new_status='H') \
and DR.DISBURSEMENT_SCHEDULE_ID = DS.DISBURSEMENT_SCHEDULE_ID	\
INNER JOIN BENEFIT_ACCOUNT BA \
ON D.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
AND BA.INTERNAL_NAME LIKE ?4 \
AND NVL(BA.NON_TAXABLE_FLAG,'N') <>?5 \
fetch first 1 rows only

ace.querySql.AddEFTWireIIA=SELECT distinct a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
WHERE a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'IIA' ) \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
fetch first 1 row only \
  
ace.querySql.AddEFTWireCO=SELECT distinct a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
WHERE a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'CLOSEOUTS' ) \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
fetch first 1 row only \
  
ace.querySql.thirdpartyJointAnnuitant = SELECT distinct \
p.alt_identifier AS joint_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name = 'JOINT_ANNUITANT' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name =?1 \
AND Upper(DED_TYPE.description) NOT IN ('LIEN', 'CHILD SUPPORT', 'BANKRUPTCY' ) \
ORDER BY dbms_random.random \
fetch first 1 row only \
  
ace.querySql.AddEFTWireFAEPC=SELECT distinct a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
WHERE a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'FAEPC' ) \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
fetch first 1 row only \
  
ace.querySql.ModifyStateTaxIIA=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
p.status = 'L' \
AND a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'IIA') \
AND Upper(DED_TYPE.description)  IN ( \
'STATE TAX' ) \
AND DTD.DEDUCTION_AMT>0 \
ORDER BY dbms_random.random \
fetch first 1 row only \
 
ace.querySql.ModifyStateTaxCO=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
p.status = 'L' \
AND a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
AND Upper(DED_TYPE.description)  IN ( \
'STATE TAX' ) \
AND DTD.DEDUCTION_AMT>0 \
ORDER BY dbms_random.random \
fetch first 1 row only \

ace.querySql.AddFederalTaxIIA=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
p.status = 'L' \
AND a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'IIA') \
AND Upper(DED_TYPE.description) != ( 'FEDERAL TAX' ) \
AND DTD.DEDUCTION_AMT>0 \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AddFederalTaxCO=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = P.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=a.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
p.status = 'L' \
AND a.status = 'L' \
AND mc.member_contract_code_01 = 'IP' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
AND Upper(DED_TYPE.description) != ( 'FEDERAL TAX' ) \
AND DTD.DEDUCTION_AMT>0 \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.ModifyStateTaxJointCO=SELECT distinct \
p.alt_identifier AS joint_annuitant_id \
FROM   dbo.person p -- p is for joint \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
INNER JOIN person a -- a is for annuintant \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id WHERE \
er.internal_name = 'JOINT_ANNUITANT' AND \
mc.member_contract_code_01 = 'IP' \
AND p.status='L' AND \
ps.status_name ='Approved' AND \
Upper(DED_TYPE.description) IN ( 'STATE TAX' ) AND \
pbt.internal_name IN ( 'CLOSEOUTS' ) \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.ModifyStateTaxJointIIA=SELECT distinct \
p.alt_identifier AS joint_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
INNER JOIN person a -- a is for annuintant \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
WHERE er.internal_name = 'JOINT_ANNUITANT' AND \
mc.member_contract_code_01 = 'IP' AND \
p.status='L' AND \
ps.status_name like '%Case Activated%' AND \
Upper(DED_TYPE.description)  IN ( \
'STATE TAX' ) AND \
pbt.internal_name IN ( 'IIA' ) \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AddFederalTaxJointCO=SELECT P_REL.ALT_IDENTIFIER,pbt.internal_name,ps.status_name FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
AND BER.ENTITY_ID = 254 \
AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
AND BER.KEY_VALUE = P.PERSON_ID \
WHERE BE.BILLING_ENTITY_CODE='000039055' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Approved%' \
AND ER.INTERNAL_NAME like '%JOINT_ANNUITANT%' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
and pf.annuity_option_id=518 \
AND DTD.deduction_type in ('F') \
AND ad.current_address_flag='Y' \
--AND bek.phone is not null \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN( 'DI', 'M0', 'D0', 'D1', \
'ST', 'NR', 'FI', 'LF', \
'M6', 'D3', 'FL', 'CT', \
'L3', 'D4', 'UD', 'FC', \
'L0', 'M2', 'SS', 'MI', \
'L9', 'MJ', 'U0', 'U1', \
'D7', 'L1', 'IL', 'M1', \
'IT', 'L8', 'SL', '1M', \
'OR', 'LT', 'BK', 'L2', \
'D2', 'U2', 'CS' )) \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AddFederalTaxJointIIA=SELECT distinct \
p.alt_identifier AS joint_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
INNER JOIN person a -- a is for annuintant \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
WHERE er.internal_name = 'JOINT_ANNUITANT' AND \
mc.member_contract_code_01 = 'IP' AND \
p.status='L' AND \
ps.status_name like '%Case Activated%' AND \
Upper(DED_TYPE.description)  IN ( \
'FEDERAL TAX' ) AND \
pbt.internal_name IN ( 'IIA' ) \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.thirdpartyBeneficiary = SELECT distinct \
p.alt_identifier AS bene_alt_id\
FROM   dbo.person p\
INNER JOIN business_entity_relation BER\
ON BER.business_entity_key_id = p.business_entity_key_id\
INNER JOIN entity_relationship ER\
ON ER.entity_relationship_id = BER.entity_relationship_id\
INNER JOIN member_contract mc\
ON mc.member_contract_id = ber.source_key_value\
AND BER.source_entity_id = 798\
INNER JOIN person a\
ON a.person_id = ber.key_value\
AND ber.entity_id = 254\
INNER JOIN billing_entity be\
ON mc.billing_id = be.billing_id\
INNER JOIN product pdt\
ON pdt.product_id = be.product_id\
INNER JOIN product_benefit_type pbt\
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id\
INNER JOIN disburse_schedule ds\
ON ds.person_id=p.person_id\
INNER JOIN dbo.deduction_template DT\
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id\
INNER JOIN dbo.deduction_template_detail DTD\
ON DT.deduction_template_id = DTD.deduction_template_id\
LEFT JOIN dbo.deduction_type DED_TYPE\
ON DED_TYPE.deduction_type = DTD.deduction_type\
WHERE  er.internal_name = 'BENEFICIARY'\
AND a.status='D'\
AND p.status = 'L'\
AND ds.sched_status='A'\
AND ds.next_pay_end_date is not null\
AND pbt.internal_name= ?1\
AND Upper(DED_TYPE.description) NOT IN ('LIEN', 'CHILD SUPPORT', 'BANKRUPTCY' ) \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.QDROsplit=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN pension_application paj \
ON a.person_id=paj.person_id \
INNER JOIN DBO.COURT_ORDER CO \
ON CO.PAYOR_BUSINESS_ENTITY_KEY_ID=A.BUSINESS_ENTITY_KEY_ID \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
on DS.SOURCE_ENTITY   = 350 \
AND DS.SOURCE_KEy = PA.APPLICATION_ID \
INNER JOIN disburse_schedule dsa \
on DSa.SOURCE_ENTITY   = 350 \
AND DSa.SOURCE_KEy = PAj.APPLICATION_ID \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
and ds.sched_status='A' \
and dsa.sched_status='A' \
AND pbt.internal_name IN ?1 \
AND CO.GENERIC_CODE_1=?2 \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY

ace.querySql.AgeOfMajority = SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
             from   dbo.V_ANNUITANT v  \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
              and v.alt_identifier = bek.alt_key_code  \
			   inner join dbo.person p on v.person_id=p.person_id \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID  \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
                    inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
                    inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
                    inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
                    AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED')	\
              where pbt.internal_name = 'STRUCTURED' \
              and bek.search_text_02 is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' \
			  and p.primary_identifier_id !=40 \
              and v.status='L' \
              and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \
              and v.birth_date < '05-JAN-04'


ace.querySql.90DAYOUTSTANDINGCHECKLetterTC1=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='8503390600' \
  
ace.querySql.90DAYOUTSTANDINGCHECKLetterTC2=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='5261154032' \
  
ace.querySql.fetchCoAnnuitantAltId=SELECT DISTINCT P.ALT_IDENTIFIER  FROM \
DBO.PERSON P INNER JOIN \
DBO.MEMBER M  ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN disburse_schedule ds ON ds.person_id=P.person_id \
WHERE PBT.INTERNAL_NAME='CLOSEOUTS' \
AND ds.sched_status='A' \
AND PS.STATUS_ID=199 \
AND BE.BILLING_ENTITY_CODE=?1 \
AND NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('D0', \
'D1', \
'D2', \
'D3', \
'D7', \
'DI', \
'L0', \
'L1', \
'L2', \
'L3', \
'L8', \
'L9', \
'LF', \
'M0', \
'M1', \
'M2', \
'M6', \
'MI', \
'MJ', \
'U0', \
'U2', \
'UD') \
) \
FETCH FIRST 1 ROWS only

ace.querySql.COJointAnnuitantAltId=SELECT P_REL.ALT_IDENTIFIER FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
AND BER.ENTITY_ID = 254 \
AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
AND BER.KEY_VALUE = P.PERSON_ID \
WHERE BE.BILLING_ENTITY_CODE=?1 \
AND ds.sched_status='A' \
AND PS.STATUS_ID=199 \
AND ER.INTERNAL_NAME like '%JOINT_ANNUITANT%' \
and pf.annuity_option_id=518 \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('D0', \
'D1', \
'D2', \
'D3', \
'D7', \
'DI', \
'L0', \
'L1', \
'L2', \
'L3', \
'L8', \
'L9', \
'LF', \
'M0', \
'M1', \
'M2', \
'M6', \
'MI', \
'MJ', \
'U0', \
'U2', \
'UD') \
)\
FETCH FIRST 1 ROWS only

ace.querySql.COBeneficiaryAltId=SELECT DISTINCT P_REL.ALT_IDENTIFIER FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.PERSON_ID=P_REL.PERSON_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR ON DR.DISBURSEMENT_SCHEDULE_ID=DS.DISBURSEMENT_SCHEDULE_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
AND BER.KEY_VALUE = P.PERSON_ID \
AND BE.BILLING_ENTITY_CODE=?1 \
WHERE ds.sched_status='A' \
AND PS.STATUS_ID=199 \
AND ER.INTERNAL_NAME like '%BENEFICIARY%' \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('D0', \
'D1', \
'D2', \
'D3', \
'D7', \
'DI', \
'L0', \
'L1', \
'L2', \
'L3', \
'L8', \
'L9', \
'LF', \
'M0', \
'M1', \
'M2', \
'M6', \
'MI', \
'MJ', \
'U0', \
'U2', \
'UD') \
) \
FETCH FIRST 1 ROWS only

ace.querySql.livingLAAnnuitant=SELECT \
    pbt.internal_name, \
    be.billing_entity_code                                                              gac, \
    be.billing_entity_name, \
    'Annuitant'                                                                         role, \
    p.alt_identifier, \
    mc.member_contract_id, \
    p.first_name                                                                        first_name, \
    p.middle_name                                                                       middle_name, \
    p.last_name                                                                         last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                                                                    life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
           'Immediate Pay', \
           'R', \
           'Retired', \
           'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)                                                   employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
           mc.member_contract_code_01)                                                  pay_status, \
    pa.pension_effective_date                                                           annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                                                             status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', 'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)                                                 status_reason, \
    pr.short_name, \
    p.death_date                                                                        death_date, \
    p.death_notification_date                                                           death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', 'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)                                                 death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)                                                     payment_type, \
    pa.application_id \
FROM \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'LOTTERIES' )  and mc.member_contract_code_01='IP' and mc.benefit_payment_type='D' and ds.sched_status='A' and p.status='L' FETCH FIRST 1 ROWS only 


ace.querySql.deceasedIIAAnnuitant=SELECT \
    pbt.internal_name, \
    be.billing_entity_code                                                              gac, \
    be.billing_entity_name, \
    'Annuitant'                                                                         role, \
    p.alt_identifier, \
    mc.member_contract_id, \
    p.first_name                                                                        first_name, \
    p.middle_name                                                                       middle_name, \
    p.last_name                                                                         last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                                                                    life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
           'Immediate Pay', \
           'R', \
           'Retired', \
           'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)                                                   employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
           mc.member_contract_code_01)                                                  pay_status, \
    pa.pension_effective_date                                                           annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                                                             status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', 'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)                                                 status_reason, \
    pr.short_name, \
    p.death_date                                                                        death_date, \
    p.death_notification_date                                                           death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', 'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)                                                 death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)                                                     payment_type, \
    pa.application_id \
FROM \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'IIA' ) and pr.long_name LIKE 'MGIP%' and mc.member_contract_code_01='IP' and mc.benefit_payment_type='D' and ds.sched_status='A' and p.status='D' \
    and p.death_date is not null and p.death_notification_date is not null \
	and p.citizenship_country_id is not null \
	and p.death_notification_source is not null FETCH FIRST 3 ROWS only


ace.querySql.AgeOfMajorityNegativeScenario = SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
             from   dbo.V_ANNUITANT v  \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
              and v.alt_identifier = bek.alt_key_code  \
			   inner join dbo.person p on v.person_id=p.person_id \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID  \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
                    inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
                    inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
                    inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
                    AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED')	\
              where pbt.internal_name = 'STRUCTURED' \
              and bek.search_text_02 is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' \
			  and p.primary_identifier_id !=40 \
              and v.status='L' \
              and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \
              and pa.age_specific < '16/00' \
              and v.birth_date > '05-JAN-09'


ace.querySql.JointAnnuitantDetails= select distinct p.first_name,p.middle_name,p.last_name \
from dbo.person p where p.alt_identifier=?1\

ace.querySql.RETIREMENTPACKAGEJandSTC02=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='7602607528' \

ace.querySql.RETIREMENTPACKAGETCLATC03=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='1439131408' \              


ace.querySql.SSINCOMEVERNOCERTLIFE=SELECT v.alt_identifier,v.first_name,v.last_name, v.ssn,ds.payee_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.payment_form paymentForm on paymentForm.PAYMENT_FORM_ID = ds.PAYMENT_FORM_ID \
inner join dbo.benefit_account beneAcc on beneAcc.benefit_account_id = ds.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C'\
and ds.schedule_type = 'R'\
and v.status='L' \
AND mc.member_contract_status!='IP' \
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='Y' \
and paymentForm.PAYMENT_FORM_CODE= ?1 \
and v.suffix is null \
AND p.citizenship_country_id is not null \
AND v.alt_identifier='7345776745' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1 \
AND ds.SCHED_STATUS='A' \
AND beneAcc.description NOT LIKE '%Non Taxable%' \
GROUP BY v.alt_identifier,v.first_name,v.last_name,v.ssn,ds.payee_name \
HAVING COUNT(v.alt_identifier)=1 AND COUNT(v.ssn)=1 AND COUNT(ds.payee_name)=1

ace.querySql.SSINCOMEVERNOCERTTC=SELECT v.alt_identifier,v.first_name,v.last_name, v.ssn,ds.payee_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.payment_form paymentForm on paymentForm.PAYMENT_FORM_ID = ds.PAYMENT_FORM_ID \
inner join dbo.benefit_account beneAcc on beneAcc.benefit_account_id = ds.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C'\
and ds.schedule_type = 'R'\
and v.status='L' \
AND mc.member_contract_status!='IP' \
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='Y' \
and paymentForm.PAYMENT_FORM_CODE= ?1 \
and v.suffix is null \
AND p.citizenship_country_id is not null \
AND v.alt_identifier='2240277490' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1 \
AND ds.SCHED_STATUS='A' \
AND beneAcc.description NOT LIKE '%Non Taxable%' \
GROUP BY v.alt_identifier,v.first_name,v.last_name,v.ssn,ds.payee_name \
HAVING COUNT(v.alt_identifier)=1 AND COUNT(v.ssn)=1 AND COUNT(ds.payee_name)=1

ace.querySql.SSINCOMEVERNOCERTTCLife=SELECT v.alt_identifier,v.first_name,v.last_name, v.ssn,ds.payee_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.payment_form paymentForm on paymentForm.PAYMENT_FORM_ID = ds.PAYMENT_FORM_ID \
inner join dbo.benefit_account beneAcc on beneAcc.benefit_account_id = ds.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C'\
and ds.schedule_type = 'R'\
and v.status='L' \
AND mc.member_contract_status!='IP' \
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='Y' \
and paymentForm.PAYMENT_FORM_CODE= ?1 \
and v.suffix is null \
AND p.citizenship_country_id is not null \
  AND v.alt_identifier='7448542426' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1 \
AND ds.SCHED_STATUS='A' \
AND beneAcc.description NOT LIKE '%Non Taxable%' \
GROUP BY v.alt_identifier,v.first_name,v.last_name,v.ssn,ds.payee_name \
HAVING COUNT(v.alt_identifier)=1 AND COUNT(v.ssn)=1 AND COUNT(ds.payee_name)=1

ace.querySql.SSINCOMEVERNOCERTJSTC=SELECT v.alt_identifier,v.first_name,v.last_name, v.ssn,ds.payee_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.payment_form paymentForm on paymentForm.PAYMENT_FORM_ID = ds.PAYMENT_FORM_ID \
inner join dbo.benefit_account beneAcc on beneAcc.benefit_account_id = ds.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C'\
and ds.schedule_type = 'R'\
and v.status='L' \
AND mc.member_contract_status!='IP' \
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='Y' \
and paymentForm.PAYMENT_FORM_CODE= ?1 \
and v.suffix is null \
AND p.citizenship_country_id is not null \
  AND v.alt_identifier='6310111149' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1 \
AND ds.SCHED_STATUS='A' \
AND beneAcc.description NOT LIKE '%Non Taxable%' \
GROUP BY v.alt_identifier,v.first_name,v.last_name,v.ssn,ds.payee_name \
HAVING COUNT(v.alt_identifier)=1 AND COUNT(v.ssn)=1 AND COUNT(ds.payee_name)=1

ace.querySql.SSINCOMEVERNOCERTJS=SELECT v.alt_identifier,v.first_name,v.last_name, v.ssn,ds.payee_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.payment_form paymentForm on paymentForm.PAYMENT_FORM_ID = ds.PAYMENT_FORM_ID \
inner join dbo.benefit_account beneAcc on beneAcc.benefit_account_id = ds.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C'\
and ds.schedule_type = 'R'\
and v.status='L' \
AND mc.member_contract_status!='IP' \
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='Y' \
and paymentForm.PAYMENT_FORM_CODE= ?1 \
and v.suffix is null \
AND p.citizenship_country_id is not null \
    AND v.alt_identifier='9796227545' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1 \
AND ds.SCHED_STATUS='A' \
AND beneAcc.description NOT LIKE '%Non Taxable%' \
GROUP BY v.alt_identifier,v.first_name,v.last_name,v.ssn,ds.payee_name \
HAVING COUNT(v.alt_identifier)=1 AND COUNT(v.ssn)=1 AND COUNT(ds.payee_name)=1

ace.querySql.SSINCOMEVERNOCERTLS=SELECT v.alt_identifier,v.first_name,v.last_name, v.ssn,ds.payee_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.payment_form paymentForm on paymentForm.PAYMENT_FORM_ID = ds.PAYMENT_FORM_ID \
inner join dbo.benefit_account beneAcc on beneAcc.benefit_account_id = ds.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C'\
and v.status='L' \
AND mc.member_contract_status!='IP' \
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='Y' \
and paymentForm.PAYMENT_FORM_CODE= ?1 \
and v.suffix is null \
AND p.citizenship_country_id is not null \
  AND v.alt_identifier='9741387224' \
AND (SELECT DISTINCT COUNT (*) \
from dbo.V_ANNUITANT v2 \
inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
WHERE v2.alt_identifier=v.alt_identifier \
GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
HAVING COUNT(v2.alt_identifier)=1) =1 \
AND ds.SCHED_STATUS='A' \
AND beneAcc.description NOT LIKE '%Non Taxable%' \
GROUP BY v.alt_identifier,v.first_name,v.last_name,v.ssn,ds.payee_name \
HAVING COUNT(v.alt_identifier)=1 AND COUNT(v.ssn)=1 AND COUNT(ds.payee_name)=1



ace.querySql.paymentMethodaddEFTWireJointCO = SELECT DISTINCT p.alt_identifier FROM   person p \
INNER JOIN business_entity_key bek \
ON bek.key_value=p.person_id \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.payee_key = p.person_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Approved%' \
AND er.internal_name = 'JOINT_ANNUITANT' \
AND pbt.internal_name IN ('CLOSEOUTS') \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY


ace.querySql.paymentMethodaddEFTWireJointIIA = SELECT DISTINCT p.alt_identifier FROM   person p \
INNER JOIN business_entity_key bek \
ON bek.key_value=p.person_id \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.payee_key = p.person_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND er.internal_name = 'JOINT_ANNUITANT' \
AND pbt.internal_name IN ('IIA') \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY

ace.querySql.ModifyStateTaxBeneCO=SELECT distinct \
p.alt_identifier AS bene_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
AND ded_type.deduction_type in ('ST') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.ModifyStateTaxQDROCO=SELECT distinct \
p.alt_identifier AS qdro_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ('CLOSEOUTS') \
AND ded_type.deduction_type in ('ST') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.ModifyStateTaxQDROMGIP=SELECT distinct \
p.alt_identifier AS qdro_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name like 'Case Activated' \
AND pbt.internal_name IN ( 'IIA') \
AND pdt.long_name like ('%MGIP%') \
AND ded_type.deduction_type in ('ST') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.ModifyStateTaxQDROQLAC=SELECT distinct \
p.alt_identifier AS qdro_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name like 'Case Activated' \
AND pbt.internal_name IN ( 'IIA') \
AND pdt.long_name like ('%QLAC%') \
AND ded_type.deduction_type in ('ST') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.ModifyStateTaxBeneQLAC=SELECT distinct \
p.alt_identifier AS bene_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name like 'Case Activated' \
AND pbt.internal_name IN ( 'IIA') \
AND pdt.long_name like ('%QLAC%') \
AND ded_type.deduction_type in ('ST') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.ModifyStateTaxBeneMGIP=SELECT distinct \
p.alt_identifier AS bene_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name like 'Case Activated' \
AND pbt.internal_name IN ( 'IIA') \
AND pdt.long_name like ('%MGIP%') \
AND ded_type.deduction_type in ('ST') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AddFedTaxBeneCO=SELECT distinct \
p.alt_identifier AS bene_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
AND ded_type.deduction_type in ('FT') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AddFedTaxQDROCO=SELECT distinct \
p.alt_identifier AS qdro_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ('CLOSEOUTS') \
AND ded_type.deduction_type in ('FT') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AddFedTaxQDROMGIP=SELECT distinct \
p.alt_identifier AS qdro_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name like 'Case Activated' \
AND pbt.internal_name IN ( 'IIA') \
AND pdt.long_name like ('%MGIP%') \
AND ded_type.deduction_type in ('FT') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AddFedTaxQDROQLAC=SELECT distinct \
p.alt_identifier AS qdro_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name like 'Case Activated' \
AND pbt.internal_name IN ( 'IIA') \
AND pdt.long_name like ('%QLAC%') \
AND ded_type.deduction_type in ('FT') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AddFedTaxBeneQLAC=SELECT DISTINCT P_REL.ALT_IDENTIFIER,pbt.internal_name,ps.status_name FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
--AND BER.ENTITY_ID = 254 \
--AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.PERSON_ID=P_REL.PERSON_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR ON DR.DISBURSEMENT_SCHEDULE_ID=DS.DISBURSEMENT_SCHEDULE_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
AND BER.KEY_VALUE = P.PERSON_ID \
AND ad.current_address_flag='Y' \
AND bek.phone is not null \
WHERE ds.sched_status='A' \
AND pbt.internal_name IN ( 'IIA') \
AND ps.status_name LIKE '%Case Activated%' \
AND ER.INTERNAL_NAME like '%BENEFICIARY%' \
AND DTD.deduction_type in ('F') \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN( 'DI', 'M0', 'D0', 'D1', \
'ST', 'NR', 'FI', 'LF', \
'M6', 'D3', 'FL', 'CT', \
'L3', 'D4', 'UD', 'FC', \
'L0', 'M2', 'SS', 'MI', \
'L9', 'MJ', 'U0', 'U1', \
'D7', 'L1', 'IL', 'M1', \
'IT', 'L8', 'SL', '1M', \
'OR', 'LT', 'BK', 'L2', \
'D2', 'U2', 'CS' )) \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.AddFedTaxBeneMGIP=SELECT DISTINCT P_REL.ALT_IDENTIFIER,pbt.internal_name,ps.status_name FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
--AND BER.ENTITY_ID = 254 \
--AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.PERSON_ID=P_REL.PERSON_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR ON DR.DISBURSEMENT_SCHEDULE_ID=DS.DISBURSEMENT_SCHEDULE_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
AND BER.KEY_VALUE = P.PERSON_ID \
AND ad.current_address_flag='Y' \
AND bek.phone is not null \
WHERE ds.sched_status='A' \
AND pbt.internal_name IN ( 'IIA') \
AND ps.status_name LIKE '%Case Activated%' \
AND ER.INTERNAL_NAME like '%BENEFICIARY%' \
AND DTD.deduction_type in ('F') \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN( 'DI', 'M0', 'D0', 'D1', \
'ST', 'NR', 'FI', 'LF', \
'M6', 'D3', 'FL', 'CT', \
'L3', 'D4', 'UD', 'FC', \
'L0', 'M2', 'SS', 'MI', \
'L9', 'MJ', 'U0', 'U1', \
'D7', 'L1', 'IL', 'M1', \
'IT', 'L8', 'SL', '1M', \
'OR', 'LT', 'BK', 'L2', \
'D2', 'U2', 'CS' )) \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.RetirementpackageLIFEANNUITY=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='9165109962' \

ace.querySql.QDROalt=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN pension_application paj \
ON a.person_id=paj.person_id \
INNER JOIN DBO.COURT_ORDER CO \
ON CO.PAYOR_BUSINESS_ENTITY_KEY_ID=A.BUSINESS_ENTITY_KEY_ID \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
on DS.SOURCE_ENTITY   = 350 \
AND DS.SOURCE_KEy = PA.APPLICATION_ID \
INNER JOIN disburse_schedule dsa \
on DSa.SOURCE_ENTITY   = 350 \
AND DSa.SOURCE_KEy = PAj.APPLICATION_ID \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
and ds.sched_status='A' \
and dsa.sched_status='A' \
AND pbt.internal_name IN ?1 \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY

ace.querySql.Premiumdetails=SELECT be.billing_entity_code GroupNumber,sti.trans_id as PRP_TransID,STI.annuitant_id,TRD.REF_TRANS_ID AS RMT_TRANS_ID	\
FROM DBO.EXPORT_HEADER EH   INNER JOIN DBO.EXPORT_DEFINITION ED ON EH.EXPORT_ID             = ED.EXPORT_ID	\
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3	\
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID and	\
sti.sti_trans_type='PRP' and sti.transaction_code=?2    AND STI.EXPORT_FLAG = 'Y'	\
inner join dbo.member_contract mc on mc.member_contract_id=sti.member_contract_id	\
INNER JOIN DBO.BILLING_ENTITY BE    ON BE.BILLING_id=mc.billing_id	\
INNER JOIN DBO.trans_detail TRD ON sti.TRANS_ID=TRd.TRANS_ID AND TRD.TRANS_TYPE='CI'	\
inner join dbo.product pp on pp.product_id=BE.product_id	\
and pp.long_name=?1	\
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT	\
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   and PBT.INTERNAL_NAME=?4	\
FETCH FIRST 1 ROWS ONLY

ace.querySql.FAPremiumdetails=SELECT be.billing_entity_code GroupNumber,sti.trans_id as PRP_TransID,STI.annuitant_id,TRD.REF_TRANS_ID AS RMT_TRANS_ID \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID and   \
sti.sti_trans_type='PRP' and sti.transaction_code=?2    AND STI.EXPORT_FLAG     = 'Y'    \
INNER JOIN DBO.BILLING_ENTITY BE    \
ON BE.BILLING_ENTITY_CODE=STI.GROUP_NUMBER  \
INNER JOIN dbo.transaction TR ON BE.EMPLOYER_ID=TR.REF_KEY_1    \
INNER JOIN DBO.trans_detail TRD ON TRD.TRANS_ID=TR.TRANS_ID AND TRD.TRANS_TYPE='CI' \
inner join dbo.product pp on pp.product_id=BE.product_id    \
and pp.long_name=?1  \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   and PBT.INTERNAL_NAME=?4 \
FETCH FIRST 1 ROWS ONLY

ace.querySql.STIPremiumdetails=select trans_id,business_event,group_number,	\
transaction_code,amount,memo_code,amount_code,data_string	\
from client.sti_export_history where TRANS_ID=?1 	\
FETCH FIRST 1 ROWS ONLY

ace.querySql.AddStateTaxMGIP= SELECT \
DISTINCT P.ALT_IDENTIFIER ,pdt.long_name, p.first_name \
FROM \
DBO.PERSON P \
INNER JOIN DBO.MEMBER M ON M.PERSON_ID = P.PERSON_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON M.MEMBER_ID = MC.MEMBER_ID \
INNER JOIN BILLING_ENTITY BE ON MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID = PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID = PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID = PS.STATUS_ID \
INNER JOIN disburse_schedule ds ON ds.person_id = P.person_id \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
INNER JOIN product pdt ON pdt.product_id = be.product_id \
WHERE \
PBT.INTERNAL_NAME = 'IIA' \
AND ds.sched_status = 'A' \
AND ps.status_name LIKE '%Case Activated%' \
AND pdt.long_name like ('%MGIP%') \
AND ad.current_address_flag='Y' \
AND bek.phone is not null \
AND NOT EXISTS ( \
SELECT \
DISTINCT PER.ALT_IDENTIFIER \
FROM \
DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
WHERE \
DTD.DEDUCTION_TYPE IN ('ST') \
)

ace.querySql.AddStateTaxCO = SELECT \
DISTINCT P.ALT_IDENTIFIER,p.last_name, p.first_name \
FROM \
DBO.PERSON P \
INNER JOIN DBO.MEMBER M ON M.PERSON_ID = P.PERSON_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON M.MEMBER_ID = MC.MEMBER_ID \
INNER JOIN BILLING_ENTITY BE ON MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID = PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID = PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID = PS.STATUS_ID \
INNER JOIN disburse_schedule ds ON ds.person_id = P.person_id \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
WHERE \
PBT.INTERNAL_NAME = 'CLOSEOUTS' \
AND ds.sched_status = 'A' \
AND ps.status_name LIKE '%Approved%' \
AND ad.current_address_flag='Y' \
AND bek.phone is not null \
AND NOT EXISTS (\
SELECT \
DISTINCT PER.ALT_IDENTIFIER \
FROM \
DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
WHERE \
DTD.DEDUCTION_TYPE IN ('ST') \
)

ace.querySql.AddStateTaxSSA = SELECT \
DISTINCT P.ALT_IDENTIFIER,p.last_name, p.first_name \
FROM \
DBO.PERSON P \
INNER JOIN DBO.MEMBER M ON M.PERSON_ID = P.PERSON_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON M.MEMBER_ID = MC.MEMBER_ID \
INNER JOIN BILLING_ENTITY BE ON MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID = PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID = PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID = PS.STATUS_ID \
INNER JOIN disburse_schedule ds ON ds.person_id = P.person_id \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
WHERE \
PBT.INTERNAL_NAME = 'STRUCTURED' \
AND ds.sched_status = 'A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ad.current_address_flag='Y' \
AND bek.phone is not null \
AND NOT EXISTS (\
SELECT \
DISTINCT PER.ALT_IDENTIFIER \
FROM \
DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
WHERE \
DTD.DEDUCTION_TYPE IN ('ST') \
)

ace.querySql.AddStateTaxJACO = SELECT P_REL.ALT_IDENTIFIER,pbt.internal_name,ps.status_name FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
AND BER.ENTITY_ID = 254 \
AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
AND BER.KEY_VALUE = P.PERSON_ID \
WHERE BE.BILLING_ENTITY_CODE='000039055' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Approved%' \
AND ER.INTERNAL_NAME like '%JOINT_ANNUITANT%' \
AND pbt.internal_name IN ( 'CLOSEOUTS' ) \
and pf.annuity_option_id=518 \
AND ad.current_address_flag='Y' \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('ST') )

ace.querySql.AddStateTaxJASSA = SELECT P_REL.ALT_IDENTIFIER,pbt.internal_name,ps.status_name FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
AND BER.ENTITY_ID = 254 \
AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
AND BER.KEY_VALUE = P.PERSON_ID \
WHERE BE.BILLING_ENTITY_CODE='000039055' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Approved%' \
AND ER.INTERNAL_NAME like '%JOINT_ANNUITANT%' \
AND pbt.internal_name IN ( 'STRUCTURED' ) \
and pf.annuity_option_id=518 \
AND ad.current_address_flag='Y' \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('ST') )

ace.querySql.AddStateTaxJAIIA = SELECT P_REL.ALT_IDENTIFIER,pbt.internal_name,ps.status_name FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
AND BER.ENTITY_ID = 254 \
AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
AND BER.KEY_VALUE = P.PERSON_ID \
WHERE BE.BILLING_ENTITY_CODE='000039055' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Approved%' \
AND ER.INTERNAL_NAME like '%JOINT_ANNUITANT%' \
AND pbt.internal_name IN ( 'IIA' ) \
and pf.annuity_option_id=518 \
AND ad.current_address_flag='Y' \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('ST') )

ace.querySql.AddStateTaxBenIIA = SELECT DISTINCT P_REL.ALT_IDENTIFIER,pbt.internal_name,ps.status_name FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
--AND BER.ENTITY_ID = 254 \
--AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.PERSON_ID=P_REL.PERSON_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR ON DR.DISBURSEMENT_SCHEDULE_ID=DS.DISBURSEMENT_SCHEDULE_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
AND BER.KEY_VALUE = P.PERSON_ID \
AND ad.current_address_flag='Y' \
AND bek.phone is not null \
WHERE ds.sched_status='A' \
AND pbt.internal_name IN ( 'IIA') \
AND ps.status_name LIKE '%Approved%' \
AND ER.INTERNAL_NAME like '%BENEFICIARY%' \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('ST') )

ace.querySql.AddStateTaxBenCO = SELECT DISTINCT P_REL.ALT_IDENTIFIER,pbt.internal_name,ps.status_name FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
--AND BER.ENTITY_ID = 254 \
--AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.PERSON_ID=P_REL.PERSON_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR ON DR.DISBURSEMENT_SCHEDULE_ID=DS.DISBURSEMENT_SCHEDULE_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
AND BER.KEY_VALUE = P.PERSON_ID \
AND ad.current_address_flag='Y' \
AND bek.phone is not null \
WHERE ds.sched_status='A' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
AND ps.status_name LIKE '%Approved%' \
AND ER.INTERNAL_NAME like '%BENEFICIARY%' \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('ST') )

ace.querySql.AddStateTaxBenSSA = SELECT DISTINCT P_REL.ALT_IDENTIFIER,pbt.internal_name,ps.status_name FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
--AND BER.ENTITY_ID = 254 \
--AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC \
ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.PERSON_ID=P_REL.PERSON_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.DISBURSEMENT_REQUEST DR ON DR.DISBURSEMENT_SCHEDULE_ID=DS.DISBURSEMENT_SCHEDULE_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN Addresses ad ON ad.key_value= p.person_id \
INNER JOIN business_entity_key bek ON bek.key_value=p.person_id \
AND BER.KEY_VALUE = P.PERSON_ID \
AND ad.current_address_flag='Y' \
AND bek.phone is not null \
WHERE ds.sched_status='A' \
AND pbt.internal_name IN ( 'STRUCTURED') \
AND ps.status_name LIKE '%Approved%' \
AND ER.INTERNAL_NAME like '%BENEFICIARY%' \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('ST') )

ace.querySql.AddStateTaxQDROIIA = SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN pension_application paj \
ON a.person_id=paj.person_id \
INNER JOIN DBO.COURT_ORDER CO \
ON CO.PAYOR_BUSINESS_ENTITY_KEY_ID=A.BUSINESS_ENTITY_KEY_ID \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
on DS.SOURCE_ENTITY   = 350 \
AND DS.SOURCE_KEy = PA.APPLICATION_ID \
INNER JOIN disburse_schedule dsa \
on DSa.SOURCE_ENTITY   = 350 \
AND DSa.SOURCE_KEy = PAj.APPLICATION_ID \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
and ds.sched_status='A' \
and dsa.sched_status='A' \
AND pbt.internal_name IN ( 'IIA') \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY


ace.querySql.AddStateTaxQDROCO = SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN pension_application paj \
ON a.person_id=paj.person_id \
INNER JOIN DBO.COURT_ORDER CO \
ON CO.PAYOR_BUSINESS_ENTITY_KEY_ID=A.BUSINESS_ENTITY_KEY_ID \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
on DS.SOURCE_ENTITY   = 350 \
AND DS.SOURCE_KEy = PA.APPLICATION_ID \
INNER JOIN disburse_schedule dsa \
on DSa.SOURCE_ENTITY   = 350 \
AND DSa.SOURCE_KEy = PAj.APPLICATION_ID \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
and ds.sched_status='A' \
and dsa.sched_status='A' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY

ace.querySql.AddStateTaxQDROSSA = SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN pension_application paj \
ON a.person_id=paj.person_id \
INNER JOIN DBO.COURT_ORDER CO \
ON CO.PAYOR_BUSINESS_ENTITY_KEY_ID=A.BUSINESS_ENTITY_KEY_ID \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
on DS.SOURCE_ENTITY   = 350 \
AND DS.SOURCE_KEy = PA.APPLICATION_ID \
INNER JOIN disburse_schedule dsa \
on DSa.SOURCE_ENTITY   = 350 \
AND DSa.SOURCE_KEy = PAj.APPLICATION_ID \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
and ds.sched_status='A' \
and dsa.sched_status='A' \
AND pbt.internal_name IN ( 'STRUCTURED') \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY

ace.querySql.FAPremiumdetails=SELECT be.billing_entity_code GroupNumber,sti.trans_id as PRP_TransID,STI.annuitant_id,TRD.REF_TRANS_ID AS RMT_TRANS_ID \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED ON EH.EXPORT_ID             = ED.EXPORT_ID  \
AND ED.INTERNAL_NAME        = 'STI_EXPORT'  AND TRUNC(EH.INSERTED_DATE)>= TRUNC(SYSDATE)-?3 \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID and   \
sti.sti_trans_type='PRP' and sti.transaction_code=?2    AND STI.EXPORT_FLAG     = 'Y'    \
INNER JOIN DBO.BILLING_ENTITY BE    \
ON BE.BILLING_ENTITY_CODE=STI.GROUP_NUMBER  \
INNER JOIN dbo.transaction TR ON BE.EMPLOYER_ID=TR.REF_KEY_1    \
INNER JOIN DBO.trans_detail TRD ON TRD.TRANS_ID=TR.TRANS_ID AND TRD.TRANS_TYPE='CI' \
inner join dbo.product pp on pp.product_id=BE.product_id    \
and pp.long_name=?1  \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT \
ON PBT.PRODUCT_BENEFIT_TYPE_ID=BE.PRODUCT_BENEFIT_TYPE_ID   and PBT.INTERNAL_NAME=?4 \
FETCH FIRST 1 ROWS ONLY

ace.querySql.SSADOCTOBROKER=SELECT v.alt_identifier,v.first_name,v.last_name, v.ssn,ds.payee_name \
  from dbo.V_ANNUITANT v \
  inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
  inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
  inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
  AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
  AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
  inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
  inner join dbo.deduction_template ded \
  inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
  inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
  inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
  inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
  inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
  inner join dbo.payment_form paymentForm on paymentForm.PAYMENT_FORM_ID = ds.PAYMENT_FORM_ID \
  inner join dbo.benefit_account beneAcc on beneAcc.benefit_account_id = ds.benefit_account_id \
  inner join DBO.EMPLOYER emp ON be.EMPLOYER_ID = emp.EMPLOYER_ID \
  where pbt.internal_name = 'STRUCTURED' \
  and ds.sched_status <> 'C' \
  and ds.schedule_type = 'R' \
  and v.status='L' \
  AND mc.member_contract_status!='IP' \
  and p.primary_identifier_id !=40 \
  and dedt.zero_deduction_flag='Y' \
  and emp.EMPLOYER_NAME= 'MetLife Tower Resources' \
  and v.suffix is null \
  AND p.citizenship_country_id is not null \
  AND (SELECT DISTINCT COUNT (*)v \
  from dbo.V_ANNUITANT v2 \
  inner join dbo.MEMBER_CONTRACT mc2 on v2.MEMBER_ID = mc2.MEMBER_ID \
  inner join dbo.pension_application pa2 on mc2.MEMBER_CONTRACT_ID = pa2.MEMBER_CONTRACT_ID AND pa2.estimate_flag = 'N' \
  AND pa2.parent_application_id IS NULL AND PA2.APPROVED_FLAG = 'Y' \
  AND NVL (PA2.CANCELLED_FLAG, 'N') = 'N' \
  INNER join dbo.disburse_schedule ds2 on ds2.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa2.application_id = ds2.source_key \
  INNER join dbo.benefit_account beneAcc2 on beneAcc2.benefit_account_id = ds2.benefit_account_id \
  WHERE v2.alt_identifier=v.alt_identifier \
  GROUP BY beneAcc2.benefit_account_id, v2.alt_identifier \
  HAVING COUNT(v2.alt_identifier)=1) =1 \
  AND ds.SCHED_STATUS='A' \
  AND beneAcc.description NOT LIKE '%Non Taxable%' \
  GROUP BY v.alt_identifier,v.first_name,v.last_name,v.ssn,ds.payee_name \
  HAVING COUNT(v.alt_identifier)=1 AND COUNT(v.ssn)=1 AND COUNT(ds.payee_name)=1

ace.querySql.RETIREMENTPACKAGEMCRLATC06=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='2189885165'



ace.querySql.paymentMethodaddEFTWireBeneCO = SELECT DISTINCT p.alt_identifier FROM   person p \
INNER JOIN business_entity_key bek \
ON bek.key_value=p.person_id \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.payee_key = p.person_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Approved%' \
AND er.internal_name = 'BENEFICIARY' \
AND pbt.internal_name IN ('CLOSEOUTS') \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY

ace.querySql.QDROaltCGA=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN pension_application paj \
ON a.person_id=paj.person_id \
INNER JOIN DBO.COURT_ORDER CO \
ON CO.PAYOR_BUSINESS_ENTITY_KEY_ID=A.BUSINESS_ENTITY_KEY_ID \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
and pdt.long_name like '%CGA%' \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
on DS.SOURCE_ENTITY   = 350 \
AND DS.SOURCE_KEy = PA.APPLICATION_ID \
INNER JOIN disburse_schedule dsa \
on DSa.SOURCE_ENTITY   = 350 \
AND DSa.SOURCE_KEy = PAj.APPLICATION_ID \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name like '%QDRO%' \
AND mc.member_contract_code_01 = 'IP' \
AND ps.status_name='Approved' \
and ds.sched_status='A' \
and dsa.sched_status='A' \
AND pbt.internal_name IN ?1 \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY

ace.querySql.VoidAndReissueMGIP=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%MGIP%') \
ORDER BY dbms_random.random \
fetch first 1 row only 

ace.querySql.VoidAndReissueQLAC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueLA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('LOTTERIES') \
ORDER BY dbms_random.random \
fetch first 1 row only 

ace.querySql.VoidAndReissueSSA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('STRUCTURED') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueFAEPC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'FAEPC') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueMGIP=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%MGIP%') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueQLAC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueLA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('LOTTERIES') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueSSA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('STRUCTURED') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueFAEPC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'FAEPC') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.fetchIIAQLACgroupid = WITH main_query \
     AS (SELECT be.billing_entity_code, \
                ogc.display_name, \
                og.option_group_id, \
                og.option_group_name, \
                og.option_group_code, \
                ann_op.annuity_option_name \
           FROM dbo.billing_Entity be \
                JOIN dbo.product p ON be.product_id = p.product_id \
                JOIN dbo.business_entity_key bek \
                   ON bek.key_code = be.billing_entity_code \
                JOIN dbo.plan pl \
                   ON pl.business_entity_key_id = bek.business_entity_key_id \
                JOIN dbo.pension_plan pp \
                   ON pl.plan_code = pp.pension_plan_code \
                JOIN dbo.option_group og \
                   ON og.pension_plan_id = pp.pension_plan_id \
                JOIN dbo.option_group_category ogc \
                   ON ogc.option_group_category_id = \
                         og.option_group_category_id \
                JOIN dbo.annuity_option ann_op \
                   ON ann_op.option_group_id = og.option_group_id \
          WHERE     be.product_benefit_type_id = 8 \
                    and  p.internal_id like '%QLAC%' \
                ) \
SELECT * \
  FROM (SELECT billing_entity_code \
          FROM main_query \
         WHERE     option_group_name LIKE 'Form of Annuity Package 1' \
        ) \
 WHERE ROWNUM <= 1

ace.querySql.fetchIIAMGIPgroupid = WITH main_query \
     AS (SELECT be.billing_entity_code, \
                ogc.display_name, \
                og.option_group_id, \
                og.option_group_name, \
                og.option_group_code, \
                ann_op.annuity_option_name \
           FROM dbo.billing_Entity be \
                JOIN dbo.product p ON be.product_id = p.product_id \
                JOIN dbo.business_entity_key bek \
                   ON bek.key_code = be.billing_entity_code \
                JOIN dbo.plan pl \
                   ON pl.business_entity_key_id = bek.business_entity_key_id \
                JOIN dbo.pension_plan pp \
                   ON pl.plan_code = pp.pension_plan_code \
                JOIN dbo.option_group og \
                   ON og.pension_plan_id = pp.pension_plan_id \
                JOIN dbo.option_group_category ogc \
                   ON ogc.option_group_category_id = \
                         og.option_group_category_id \
                JOIN dbo.annuity_option ann_op \
                   ON ann_op.option_group_id = og.option_group_id \
          WHERE     be.product_benefit_type_id = 8 \
                    and  p.internal_id like '%MGIP%' \
                ) \
SELECT * \
  FROM (SELECT billing_entity_code \
          FROM main_query \
         WHERE     option_group_name LIKE 'Form of Annuity Package 1' \
        ) \
 WHERE ROWNUM <= 1

ace.querySql.RetirementpackageMCRTC=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='3861324929'

ace.querySql.VoidAndReissueQDROQLAC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%QDRO%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueBeneCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueBeneCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueJointCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%JOINT ANNUITANT%' \
AND ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueJointQLAC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%JOINT ANNUITANT%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
ORDER BY dbms_random.random \
fetch first 1 row only 

ace.querySql.StopAndReissueQDROCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%QDRO%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueBeneCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueBeneCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueJointCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%JOINT ANNUITANT%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueJointQLAC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%JOINT ANNUITANT%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
ORDER BY dbms_random.random \
fetch first 1 row only \

ace.querySql.thirdpartyMGIPJointAnnuitant = SELECT distinct \
p.alt_identifier AS joint_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name = 'JOINT_ANNUITANT' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ('IIA') \
AND Upper(DED_TYPE.description) NOT IN ('LIEN', 'CHILD SUPPORT', 'BANKRUPTCY' ) \
AND pdt.long_name like ('%MGIP%') \
ORDER BY dbms_random.random \
fetch first 1 row only \

ace.querySql.thirdpartyMGIPBene = SELECT distinct \
p.alt_identifier AS joint_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name = 'BENEFICIARY' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ('IIA') \
AND Upper(DED_TYPE.description) NOT IN ('LIEN', 'CHILD SUPPORT', 'BANKRUPTCY' ) \
AND pdt.long_name like ('%MGIP%') \
ORDER BY dbms_random.random \
fetch first 1 row only \

ace.querySql.RetirementpackageTCOA=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='2435381295' \

ace.querySql.RETIREMENTPACKAGEMCRLA=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='2189885165' \




ace.querySql.bulkcheckSTI=SELECT sti.annuitant_id,    \
sti.business_event,sti.GROUP_NUMBER,sti.transaction_code,sti.disbursement_id,   \
sti.memo_code,amount_code,sti.disbursement_status,sti.export_flag,  \
(select sum(Amount)/2 from client.sti_export_history where Disbursement_ID=D.Disbursement_id) as sti_amount,    \
sti.data_string \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED     \
ON EH.EXPORT_ID= ED.EXPORT_ID   \
AND ED.INTERNAL_NAME= 'STI_EXPORT'  \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID and sti.transaction_code = 'PYTA' \
INNER JOIN DBO.DISBURSEMENT D   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID where sti.disbursement_id=?1 \
FETCH FIRST 1 ROWS ONLY



ace.querySql.RetirementpackageMCRTC=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='3861324929'

ace.querySql.VoidAndReissueQDROQLAC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%QDRO%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueBeneCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueBeneCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueJointCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%JOINT ANNUITANT%' \
AND ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.VoidAndReissueJointQLAC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%JOINT ANNUITANT%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
ORDER BY dbms_random.random \
fetch first 1 row only 

ace.querySql.StopAndReissueQDROCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%QDRO%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueBeneCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueBeneCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%BENEFICIARY%' \
AND ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueJointCGA=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%JOINT ANNUITANT%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('CGA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.StopAndReissueJointQLAC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%JOINT ANNUITANT%' \
AND ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
ORDER BY dbms_random.random \
fetch first 1 row only \

ace.querySql.thirdpartyMGIPJointAnnuitant = SELECT distinct \
p.alt_identifier AS joint_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name = 'JOINT_ANNUITANT' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ('IIA') \
AND Upper(DED_TYPE.description) NOT IN ('LIEN', 'CHILD SUPPORT', 'BANKRUPTCY' ) \
AND pdt.long_name like ('%MGIP%') \
ORDER BY dbms_random.random \
fetch first 1 row only \

ace.querySql.thirdpartyMGIPBene = SELECT distinct \
p.alt_identifier AS joint_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE  er.internal_name = 'BENEFICIARY' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ('IIA') \
AND Upper(DED_TYPE.description) NOT IN ('LIEN', 'CHILD SUPPORT', 'BANKRUPTCY' ) \
AND pdt.long_name like ('%MGIP%') \
ORDER BY dbms_random.random \
fetch first 1 row only \

ace.querySql.RetirementpackageTCOA=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='2435381295' \

ace.querySql.RETIREMENTPACKAGEMCRLA=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='2189885165' \

ace.querySql.CreditCorrectionSSA= SELECT distinct p.alt_identifier \
FROM dbo.member m \
JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
JOIN dbo.person                  p ON p.person_id = m.person_id \
JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
AND be.employer_id = mc.employer_id \
JOIN dbo.product                 pr ON pr.product_id = be.product_id \
JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
AND pf.selected_flag = 'Y' \
AND pf.master_payment_form_id IS NULL \
LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
pbt.internal_name IN ( 'STRUCTURED' ) \
AND p.status='L' \
AND  pf.payment_form_name  LIKE '%Joint%' \
UNION ALL \
SELECT \
p.alt_identifier \
FROM \
dbo.member_contract mc \
JOIN dbo.business_entity_relation    ber ON mc.member_contract_id = ber.source_key_value \
JOIN dbo.entity_relationship         er ON ber.entity_relationship_id = er.entity_relationship_id \
JOIN dbo.business_entity_key         bek ON ber.business_entity_key_id = bek.business_entity_key_id \
JOIN dbo.person                      p ON bek.key_value = p.person_id \
JOIN dbo.pension_application         pa ON pa.member_contract_id = mc.member_contract_id \
JOIN dbo.billing_entity              be ON be.billing_id = mc.billing_id \
AND be.employer_id = mc.employer_id \
JOIN dbo.product                     pr ON pr.product_id = be.product_id \
JOIN dbo.product_benefit_type        pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
JOIN dbo.plan                        pl ON pl.plan_id = mc.plan_id \
JOIN dbo.payment_form                pf ON pf.pension_application_id = pa.application_id \
AND pf.selected_flag = 'Y' \
AND pf.master_payment_form_id IS NULL \
LEFT JOIN dbo.disburse_schedule           ds ON ds.source_key = pa.application_id \
WHERE \
pbt.internal_name IN ( 'STRUCTURED' ) \
AND er.entity_relationship_name ='Joint Annuitant' \
AND mc.member_contract_code_04!='IP' \
AND pf.payment_form_name  = '100 % Joint and Survivor Life Annuity' \
fetch first 1 row only

ace.querySql.CreditCorrectionCO=SELECT  distinct  p.alt_identifier \
FROM \
dbo.member m \
JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
JOIN dbo.person                  p ON p.person_id = m.person_id \
JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
AND be.employer_id = mc.employer_id \
JOIN dbo.product                 pr ON pr.product_id = be.product_id \
JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
AND pf.selected_flag = 'Y' \
AND pf.master_payment_form_id IS NULL \
LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
pbt.internal_name IN ( 'CLOSEOUTS' ) \
AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
AND mc.benefit_payment_type = 'D' AND mc.member_contract_code_04='AF' \
AND mc.member_contract_code_04!='IP' \
and plan_identifier= '01' \
AND p.status='L' \
AND ds.sched_status= 'A' \
AND  pf.payment_form_name  = '100 % Joint and Survivor Life Annuity' \
UNION ALL \
SELECT \
p.alt_identifier \
FROM \
dbo.member_contract mc \
JOIN dbo.business_entity_relation    ber ON mc.member_contract_id = ber.source_key_value \
JOIN dbo.entity_relationship         er ON ber.entity_relationship_id = er.entity_relationship_id \
JOIN dbo.business_entity_key         bek ON ber.business_entity_key_id = bek.business_entity_key_id \
JOIN dbo.person                      p ON bek.key_value = p.person_id \
JOIN dbo.pension_application         pa ON pa.member_contract_id = mc.member_contract_id \
JOIN dbo.billing_entity              be ON be.billing_id = mc.billing_id \
AND be.employer_id = mc.employer_id \
JOIN dbo.product                     pr ON pr.product_id = be.product_id \
JOIN dbo.product_benefit_type        pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
JOIN dbo.plan                        pl ON pl.plan_id = mc.plan_id \
JOIN dbo.payment_form                pf ON pf.pension_application_id = pa.application_id \
AND pf.selected_flag = 'Y' \
AND pf.master_payment_form_id IS NULL \
LEFT JOIN dbo.disburse_schedule           ds ON ds.source_key = pa.application_id \
WHERE \
pbt.internal_name IN ( 'CLOSEOUTS' ) \
AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
AND mc.benefit_payment_type = 'D' \
AND mc.member_contract_code_01 = 'D' \
AND er.entity_relationship_name ='Joint Annuitant' \
AND ds.sched_status='D' \
AND mc.member_contract_code_04='AF' \
AND mc.member_contract_code_04!='IP' \
and plan_identifier= '01' \
AND pf.payment_form_name  = '100 % Joint and Survivor Life Annuity' \
fetch first 1 row only


ace.querySql.bulkcheckSTI=SELECT sti.annuitant_id,    \
sti.business_event,sti.GROUP_NUMBER,sti.transaction_code,sti.disbursement_id,   \
sti.memo_code,amount_code,sti.disbursement_status,sti.export_flag,  \
(select sum(Amount)/2 from client.sti_export_history where Disbursement_ID=D.Disbursement_id) as sti_amount,    \
sti.data_string \
FROM DBO.EXPORT_HEADER EH   \
INNER JOIN DBO.EXPORT_DEFINITION ED     \
ON EH.EXPORT_ID= ED.EXPORT_ID   \
AND ED.INTERNAL_NAME= 'STI_EXPORT'  \
INNER JOIN CLIENT.STI_EXPORT_HISTORY STI    \
ON STI.EXPORT_HEADER_ID = EH.EXPORT_HEADER_ID and sti.transaction_code = 'PYTA' \
INNER JOIN DBO.DISBURSEMENT D   \
ON STI.DISBURSEMENT_ID = D.DISBURSEMENT_ID where sti.disbursement_id=?1 \
FETCH FIRST 1 ROWS ONLY

ace.querySql.TaxwithholdletterconfirmationSSACAUSLivingv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
 inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
AND mc.member_contract_status!='IP'\
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='N' \
  AND NOT EXISTS (SELECT DISTINCT PER.ALT_IDENTIFIER \
FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN ('ST')) \
AND p.citizenship_country_id is not null

ace.querySql.TaxwithholdletterconfirmationCOCAUSLivingv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'CLOSEOUTS' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
  AND BE.billing_entity_code = '000039055' \
and v.status='L' \
and  BA.NON_TAXABLE_FLAG is null \
AND mc.member_contract_status!='IP'\
  and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='N' \
  AND NOT EXISTS (SELECT DISTINCT PER.ALT_IDENTIFIER \
FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN ('ST') \
AND DTD.deduction_type IN ( 'DI', 'M0', 'D0', 'D1', \
'ST', 'NR', 'FI', 'LF', \
'M6', 'D3', 'FL', 'CT', \
'L3', 'D4', 'UD', 'FC', \
'L0', 'M2', 'SS', 'MI', \
'L9', 'MJ', 'U0', 'U1', \
'D7', 'L1', 'IL', 'M1', \
'IT', 'L8', 'SL', '1M', \
'OR', 'LT', 'BK', 'L2', \
'D2', 'U2', 'CS' )) \
AND p.citizenship_country_id is not null

ace.querySql.IIACaseActivatedAnnuitantLivingUSv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'IIA' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
and  BA.NON_TAXABLE_FLAG is null \
and p.primary_identifier_id !=40 \
  and dedt.zero_deduction_flag='N' \
  AND NOT EXISTS (SELECT DISTINCT PER.ALT_IDENTIFIER \
  FROM DBO.PERSON PER \
  INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
  INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
  WHERE DTD.DEDUCTION_TYPE IN ('ST')) \
  AND p.citizenship_country_id is not null

ace.querySql.SSREQUESTFOLLOWUP=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='8564456423'

ace.querySql.FetchBrokerDetails=SELECT v.alt_identifier,v.ssn,v.first_name,v.middle_name, v.last_name, v.suffix, v.marital_status, \
  bek.search_text_02 AS PHONENUMBER,bek.search_text_03 AS EMAIL, \
  a.ADDRESS_1,a.ADDRESS_2,a.ADDRESS_3,a.CITY,a.STATE, a.ZIP, a.COUNTRY, a.POSTAL_CODE \
  FROM dbo.person v \
  LEFT JOIN dbo.business_entity_key bek ON v.person_id = bek.key_value AND v.alt_identifier = bek.alt_key_code  and  key_role_indicator='Broker'\
  LEFT JOIN dbo.addresses a ON v.person_id = a.key_value AND a.stop_date IS NULL AND a.address_type = 'R' \
  WHERE v.alt_identifier=?1 \
  FETCH FIRST 1 ROWS ONLY

ace.querySql.RetirementpackageTCJLLATC09=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='5673504125'

ace.querySql.HeldAndSuspendMGIP=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%MGIP%') \
AND ds.next_disb_type='E' \
ORDER BY dbms_random.random \
fetch first 1 row only


ace.querySql.HeldAndSuspendQLAC=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
AND ds.next_disb_type='E' \
ORDER BY dbms_random.random \
fetch first 1 row only


ace.querySql.HeldAndSuspendSSA=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('STRUCTURED') \
AND ds.next_disb_type='E' \
ORDER BY dbms_random.random \
fetch first 1 row only


ace.querySql.HeldAndSuspendLA=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('LOTTERIES') \
AND ds.next_disb_type='E' \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.HeldAndSuspendFAEPC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='E' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'FAEPC') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.HeldAndSuspendCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='E' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.HeldAndSuspendQDROCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%QDRO%' \
AND ds.sched_status='A' \
AND ds.next_disb_type='E' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.HeldAndSuspendQDROQLAC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  er.internal_name like '%QDRO%' \
AND ds.sched_status='A' \
AND ds.next_disb_type='E' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('IIA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.PaymentMethodCheckLA=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('LOTTERIES') \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.PaymentMethodCheckFAEPC=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'FAEPC') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.PaymentMethodCheckCO=SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND mc.member_contract_code_01 = 'IP' \
AND ds.next_disb_type='C' \
AND ps.status_name='Approved' \
AND pbt.internal_name IN ( 'CLOSEOUTS') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.PaymentMethodCheckMGIP=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%MGIP%') \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
fetch first 1 row only


ace.querySql.PaymentMethodCheckQLAC=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%QLAC%') \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
fetch first 1 row only \
  
ace.querySql.QLACBenefitCommencementDateIIAUSLiving= SELECT distinct v.alt_identifier,v.first_name,v.last_name \
  from dbo.V_ANNUITANT v \
  inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
  inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
  inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
  inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
  AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
  AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
  inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
  inner join dbo.deduction_template ded \
  inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
  inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
  inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
  inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
  inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
  inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
  JOIN dbo.product pr ON pr.product_id = be.product_id \
  where pbt.internal_name = 'IIA' \
  and ds.sched_status <> 'C' \
  and ds.schedule_type = 'R' \
  and v.status='L' \
  AND pr.long_name LIKE 'QLAC%' \
  and  BA.NON_TAXABLE_FLAG is null \
  and p.primary_identifier_id !=40 \
  and dedt.zero_deduction_flag='N' \
  and a.country ='US'\
  AND p.citizenship_country_id is not null

ace.querySql.Factoringalt=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
INNER JOIN dbo.court_order co \
ON co.pension_application_id = pa.application_id \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND co.split_type is not null \
AND pbt.internal_name IN ?1 \
FETCH FIRST 1 ROWS ONLY

ace.querySql.paymentMethodCheckBenetCloseout = SELECT DISTINCT p.alt_identifier FROM   person p \
INNER JOIN business_entity_key bek \
ON bek.key_value=p.person_id \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.payee_key = p.person_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Approved%' \
AND er.internal_name = 'BENEFICIARY' \
AND pbt.internal_name IN ('CLOSEOUTS') \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
FETCH FIRST 1 ROWS ONLY

ace.querySql.CreditCorrectionIIAMGIP=SELECT distinct \
a.alt_identifier AS annuitant_alt_id \
FROM   dbo.person p -- p is for joint \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
LEFT JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
INNER JOIN person a -- a is for annuintant \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id  \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
WHERE \
er.internal_name like '%JOINT_ANNUITANT%' AND \
--p.status='L' AND \
ps.status_name like '%Case Activated%' AND \
pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%MGIP%') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.CreditCorrectionIIA= SELECT DISTINCT p.alt_identifier \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN dbo.pension_application PA \
ON P.person_id = PA.person_id \
INNER JOIN dbo.member_contract MC \
ON M.member_id = MC.member_id \
INNER JOIN disburse_schedule ds \
ON ds.source_key = pa.application_id \
AND ds.source_entity=350 \
INNER JOIN business_entity_relation BER \
ON BER.key_value = p.person_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN dbo.pension_status PS \
ON PA.status_id = PS.status_id \
INNER JOIN dbo.billing_entity BE \
ON MC.billing_id = BE.billing_id \
INNER JOIN dbo.product PDT \
ON BE.product_id = PDT.product_id \
INNER JOIN dbo.product_benefit_type PBT \
ON PDT.product_benefit_type_id = PBT.product_benefit_type_id \
WHERE  ds.sched_status='A' \
AND ps.status_name LIKE '%Case Activated%' \
AND ds.next_disb_type='C' \
AND er.entity_relationship_name ='Joint Annuitant' \
AND pbt.internal_name IN ('IIA') \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.InPayJointAnnuitantBulk= SELECT  \
  distinct  be.billing_entity_code                  gac, \
pbt.internal_name, \
    be.billing_entity_name, \
    'Annuitant'                             role, \
    p.alt_identifier, \
    mc.member_contract_id, \
    p.first_name                            first_name, \
    p.middle_name                           middle_name, \
    p.last_name                             last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                        life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
           'Immediate Pay', \
'R', \
           'Retired', \
'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)       employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
mc.member_contract_code_01)      pay_status, \
    pa.pension_effective_date               annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                 status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', \
           'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)     status_reason, \
    pr.short_name, \
    p.death_date                            death_date, \
    p.death_notification_date               death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', \
           'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)     death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)         payment_type, \
    pa.application_id, \
    pf.payment_form_name, plan_identifier, pl.plan_name \
FROM \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'B' \
    AND mc.member_contract_code_01 = 'IP' \
    AND p.status='D' \
    AND ds.sched_status= 'A' \
      AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' \
    AND  pf.payment_form_name ='100 % Joint and Survivor Life Annuity' \
    AND  p.death_notification_source IS NOT NULL \
    AND  p.death_notification_date IS NOT NULL \
UNION ALL \
SELECT \
distinct  be.billing_entity_code                  gac, \
    pbt.internal_name, \
    be.billing_entity_name, \
    er.entity_relationship_name             role, \
    p.alt_identifier, \
    mc.member_contract_id, \
    p.first_name                            first_name, \
    p.middle_name                           middle_name, \
    p.last_name                             last_name, \
    decode(p.status, 'L', 'Living', 'D', 'Deceased', \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record', \
           p.status)                        life_status, \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee', \
           'D', 'Disability', 'IP', \
           'Immediate Pay', \
           'R', \
           'Retired', \
           'S', \
           'Survivor', \
           'T', \
           'Terminated', \
           'TV', \
           'Term Vested', \
           mc.member_contract_status)       employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed', \
           'D', 'Deferred', 'H', 'Hold', 'P', \
           'Pending', \
           mc.member_contract_code_01)      pay_status, \
    pa.pension_effective_date               annuity_commencement_date, \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay', \
           'S', 'On Hold', 'C', 'Complete', 'QP', \
           'Queued', \
           'OF', \
           'OFAC On Hold', \
           'AP', \
           'Approval Pending', \
           'P', \
           'Pending', \
           'DR', \
           'Draft', \
           'D', \
           'Denied', \
           ds.sched_status)                 status, \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks', \
           'RE', 'Rejected EFTs', \
           'PD', \
           'Presumed Dead', \
           'D', \
           'Death', \
           'DO', \
           'Death-Overpaid', \
           'R', \
           'Reported for Escheatment', \
           'LH', \
           'Legal Hold', \
           'BH', \
           'Broker Hold', \
           'O', \
           'Other', \
           'W', \
           'Write Off', \
           'EX', \
           'Expired', \
           'IP', \
           'Immediate Pay', \
           'AC', \
           'Application Cancelled', \
           'PI', \
           'Paid in IP', \
           'AR', \
           'Approval Reversed', \
           'IB', \
           'Ineligible for Benefit', \
           'IR', \
           'IP - Revision', \
           'UL', \
           'Unable to Locate', \
           'MR', \
           'Missing Required Info', \
           'EL', \
           'Elimination of Liability Clause', \
           'RC', \
           'Remarriage Clause', \
           'FC', \
           'Full Commutation', \
           'PC', \
           'Partial Commutation', \
           'CS', \
           'Child Support Lien Network', \
           'PQ', \
           'Pending IPAQS Exclusion Ratio Calc', \
           'EU', \
           'Escheating - Uncashed checks', \
           'ER', \
           'Escheating - Rejected EFT', \
           'TE', \
           'Escheated - Terminal Age', \
           'ED', \
           'Escheating - Benefit Deferred', \
           'EB', \
           'Escheating - Benefit Refused', \
           'EI', \
           'Escheating - Insufficient Data', \
           'EN', \
           'Escheating - No Contact', \
           'EP', \
           'Escheating - No Response', \
           'ES', \
           'Escheating - Death Process', \
           'EG', \
           'Escheating - Ret Pkg NIGO', \
           'ET', \
           'Escheating - Ret Pkg Not Returned', \
           'EK', \
           'Escheating - Client Directed', \
           'EC', \
           'Escheating - Client Directed', \
           'FL', \
           'Failure to Provide Proof of Life', \
           ds.sched_status_reason_code)     status_reason, \
    pr.short_name, \
    p.death_date                            death_date, \
    p.death_notification_date               death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', \
           'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN', \
           'DE', \
           'Data Enrichment', \
           p.death_notification_source)     death_posted_by, \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK', \
           mc.benefit_payment_type)         payment_type, \
    pa.application_id, \
  pf.payment_form_name, plan_identifier, pl.plan_name \
FROM \
         dbo.member_contract mc \
    JOIN dbo.business_entity_relation    ber ON mc.member_contract_id = ber.source_key_value \
    JOIN dbo.entity_relationship         er ON ber.entity_relationship_id = er.entity_relationship_id \
    JOIN dbo.business_entity_key         bek ON ber.business_entity_key_id = bek.business_entity_key_id \
    JOIN dbo.person                      p ON bek.key_value = p.person_id \
    JOIN dbo.pension_application         pa ON pa.member_contract_id = mc.member_contract_id \
    JOIN dbo.billing_entity              be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id \
    JOIN dbo.product                     pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type        pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                        pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form                pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule           ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status  IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'B' \
    AND mc.member_contract_code_01 = 'D' \
     AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' \
    AND er.entity_relationship_name ='Joint Annuitant' FETCH FIRST 1 ROWS only


ace.querySql.QLACDeceasedAnnuitant= SELECT  \
p.alt_identifier,  \
pr.long_name  \
FROM  \
dbo.member_contract mc  \
JOIN dbo.billing_entity       be ON be.billing_id = mc.billing_id  \
JOIN dbo.product              pr ON pr.product_id = be.product_id  \
JOIN dbo.product_benefit_type pb ON pr.product_benefit_type_id = pb.product_benefit_type_id  \
AND long_name LIKE ( 'QLAC%' )  \
JOIN dbo.member               m ON m.member_id = mc.member_id  \
JOIN dbo.person               p ON p.person_id = m.person_id  \
AND p.status = 'D' FETCH FIRST 1 ROWS only

ace.querySql.RETIREMENTPACKAGEMCRJSLA=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='2203393267' \

ace.querySql.RETIREMENTPACKAGETCJSLA=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='6426149490' \


ace.querySql.PaymentMethodCNGEFTtoCHECKMGIP=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%MGIP%') \
AND ds.next_disb_type='E' \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.RetirementpackageLS10=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='6284765643'

ace.querySql.RETIREMENTPACKAGEJLTC_11=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='1284709892'
=======

ace.querySql.AnnuitantBeneInPay1=SELECT  \
    distinct be.billing_entity_code                  gac,  \
    pbt.internal_name,     be.billing_entity_name,  \
    'Annuitant'                             role,  \
    p.alt_identifier,   \
    mc.member_contract_id,   \
    p.first_name                            first_name,   \
    p.middle_name                           middle_name,  \
    p.last_name                             last_name,   \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',   \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
           p.status)                        life_status,  \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',  \
           'D', 'Disability', 'IP',   \
           'Immediate Pay', 'R',   \
           'Retired',   \
           'S',    \
           'Survivor',   \
           'T',   \
           'Terminated',  \
           'TV',    \
           'Term Vested',    \
           mc.member_contract_status)       employment_status,  \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',  \
           'D', 'Deferred', 'H', 'Hold', 'P',  \
           'Pending',    \
           mc.member_contract_code_01)      pay_status,   \
    pa.pension_effective_date               annuity_commencement_date,   \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',  \
           'S', 'On Hold', 'C', 'Complete', 'QP',  \
           'Queued',  \
           'OF',  \
           'OFAC On Hold',   \
           'AP',   \
           'Approval Pending',  \
           'P',   \
           'Pending',  \
           'DR',  \
           'Draft',   \
           'D',     \
           'Denied',    \
           ds.sched_status)                 status,   \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',   \
           'RE', 'Rejected EFTs',   \
           'PD',     \
           'Presumed Dead',    \
           'D',    \
           'Death',   \
           'DO',   \
           'Death-Overpaid',  \
           'R',  \
           'Reported for Escheatment',   \
           'LH',      \
           'Legal Hold',    \
           'BH',    \
           'Broker Hold',    \
           'O',     \
           'Other',     \
           'W',    \
           'Write Off',     \
           'EX',      \
           'Expired',    \
           'IP',      \
           'Immediate Pay',   \
           'AC',      \
           'Application Cancelled',   \
           'PI',   \
           'Paid in IP',   \
           'AR',    \
           'Approval Reversed',    \
           'IB',    \
           'Ineligible for Benefit',   \
           'IR',      \
           'IP - Revision',   \
           'UL',   \
           'Unable to Locate',  \
           'MR',    \
           'Missing Required Info',   \
           'EL',     \
           'Elimination of Liability Clause',   \
           'RC',   \
           'Remarriage Clause',   \
           'FC',   \
           'Full Commutation',   \
           'PC',  \
           'Partial Commutation',  \
           'CS',  \
           'Child Support Lien Network',  \
           'PQ',  \
           'Pending IPAQS Exclusion Ratio Calc',  \
           'EU',  \
           'Escheating - Uncashed checks',  \
           'ER',  \
           'Escheating - Rejected EFT',  \
           'TE', \
           'Escheated - Terminal Age',  \
           'ED',  \
           'Escheating - Benefit Deferred',  \
           'EB',  \
           'Escheating - Benefit Refused',  \
           'EI',  \
           'Escheating - Insufficient Data',\
           'EN',\
           'Escheating - No Contact',  \
           'EP',  \
           'Escheating - No Response',  \
           'ES',  \
           'Escheating - Death Process',  \
           'EG',  \
           'Escheating - Ret Pkg NIGO',  \
           'ET',  \
           'Escheating - Ret Pkg Not Returned',  \
           'EK',  \
           'Escheating - Client Directed',\
           'EC',  \
           'Escheating - Client Directed',  \
           'FL',  \
           'Failure to Provide Proof of Life',  \
           ds.sched_status_reason_code)     status_reason, \
    pr.short_name, \
    p.death_date                            death_date, \
    p.death_notification_date               death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', \
           'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN',  \
           'DE',  \
           'Data Enrichment',  \
           p.death_notification_source)     death_posted_by,  \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',  \
           mc.benefit_payment_type)         payment_type,  \
    pa.application_id,  \
    pf.payment_form_name, plan_identifier, pl.plan_name \
FROM  \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id   \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id   \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id   \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'D' AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' \
      AND p.status='L' \
    AND ds.sched_status= 'A' \
  AND  pf.payment_form_name  = '120 Months Term Certain and Life Annuity' \
UNION ALL \
SELECT  \
    pbt.internal_name,  \
    be.billing_entity_code                  gac,    be.billing_entity_name,  \
    er.entity_relationship_name             role, \
    p.alt_identifier,  \
    mc.member_contract_id,  \
    p.first_name                            first_name,  \
    p.middle_name                           middle_name,  \
    p.last_name                             last_name,  \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',  \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
           p.status)                        life_status,  \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',  \
           'D', 'Disability', 'IP',  \
           'Immediate Pay',  \
           'R',  \
           'Retired',  \
           'S',  \
           'Survivor',  \
           'T',   \
           'Terminated',   \
           'TV',  \
           'Term Vested',   \
           mc.member_contract_status)       employment_status,  \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',  \
           'D', 'Deferred', 'H', 'Hold', 'P',   \
           'Pending',  \
           mc.member_contract_code_01)      pay_status,   \
    pa.pension_effective_date               annuity_commencement_date,  \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',   \
           'S', 'On Hold', 'C', 'Complete', 'QP',  \
           'Queued',  \
           'OF',  \
           'OFAC On Hold',  \
           'AP',  \
           'Approval Pending',  \
           'P',  \
           'Pending',  \
           'DR',  \
           'Draft',  \
           'D',  \
           'Denied',  \
           ds.sched_status)                 status,   \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',   \
           'RE', 'Rejected EFTs',   \
           'PD',   \
           'Presumed Dead',   \
           'D',   \
           'Death',  \
           'DO',  \
           'Death-Overpaid',  \
           'R',   \
           'Reported for Escheatment',  \
           'LH',  \
           'Legal Hold',   \
           'BH',   \
           'Broker Hold',   \
           'O',  \
           'Other',  \
           'W',   \
           'Write Off',  \
           'EX',  \
           'Expired',    \
           'IP',    \
           'Immediate Pay',   \
           'AC',   \
           'Application Cancelled',   \
           'PI',   \
           'Paid in   IP',  'AR',   \
           'Approval Reversed',   \
           'IB',   \
           'Ineligible for Benefit',   \
           'IR',  \
           'IP - Revision',   \
           'UL',   \
           'Unable to Locate',   \
           'MR',  \
           'Missing Required Info',   \
           'EL',   \
           'Elimination of Liability Clause',  \
           'RC',  \
           'Remarriage Clause',  \
           'FC',   \
           'Full Commutation',   \
           'PC',   \
           'Partial Commutation',   \
           'CS',  \
           'Child Support Lien Network',  \
           'PQ',   \
           'Pending IPAQS Exclusion Ratio Calc',   \
           'EU',  \
           'Escheating - Uncashed checks',   \
           'ER',   \
           'Escheating - Rejected EFT',   \
           'TE',   \
           'Escheated - Terminal Age',   \
           'ED',   \
           'Escheating - Benefit Deferred',    \
           'EB',   \
           'Escheating - Benefit Refused',    \
           'EI',   \
           'Escheating - Insufficient Data',    \
           'EN',    \
           'Escheating - No Contact',    \
           'EP',   \
           'Escheating - No Response',   \
           'ES',   \
           'Escheating - Death Process',   \
           'EG',   \
           'Escheating - Ret Pkg NIGO',  \
           'ET',  \
           'Escheating - Ret Pkg Not Returned',   \
           'EK',   \
           'Escheating - Client Directed',   \
           'EC',   \
           'Escheating - Client Directed',   \
           'FL',   \
           'Failure to Provide Proof of Life',   \
           ds.sched_status_reason_code)     status_reason,  \
    pr.short_name,   \
    p.death_date                            death_date,  \
    p.death_notification_date               death_reporting_date,  \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice',   \
           'RM',  \
           'Returned Mail',   \
           'EO',   \
           'EDM Other',  \
           'OT',    \
           'Other',   \
           'ES',   \
           'EDM SSA/LN',   \
           'DE',    \
           'Data Enrichment',   \
           p.death_notification_source)     death_posted_by,   \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',   \
           mc.benefit_payment_type)         payment_type,   \
    pa.application_id,   \
    pf.payment_form_name,plan_identifier, pl.plan_name   \
FROM   \
         dbo.member_contract mc    \
    JOIN dbo.business_entity_relation    ber ON mc.member_contract_id = ber.source_key_value  \
    JOIN dbo.entity_relationship         er ON ber.entity_relationship_id = er.entity_relationship_id   \
    JOIN dbo.business_entity_key         bek ON ber.business_entity_key_id = bek.business_entity_key_id   \
    JOIN dbo.person                      p ON bek.key_value = p.person_id   \
    JOIN dbo.pension_application         pa ON pa.member_contract_id = mc.member_contract_id   \
    JOIN dbo.billing_entity              be ON be.billing_id = mc.billing_id   \
                                  AND be.employer_id = mc.employer_id   \
    JOIN dbo.product                     pr ON pr.product_id = be.product_id   \
    JOIN dbo.product_benefit_type        pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id   \
    JOIN dbo.plan                        pl ON pl.plan_id = mc.plan_id  \
    JOIN dbo.payment_form                pf ON pf.pension_application_id = pa.application_id   \
                                AND pf.selected_flag = 'Y'   \
                                AND pf.master_payment_form_id IS NULL   \
    LEFT JOIN dbo.disburse_schedule           ds ON ds.source_key = pa.application_id   \
WHERE   \
    pbt.internal_name IN ( 'CLOSEOUTS' )   \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' )   \
    AND mc.benefit_payment_type = 'D'   \
    AND mc.member_contract_code_01 = 'D'   \
    AND er.entity_relationship_name ='Beneficiary'   \
    AND ds.sched_status='D'  \
    AND mc.member_contract_code_04='AF'  \
    AND mc.member_contract_code_04!='IP'   \
    and plan_identifier= '01'    \
    AND pf.payment_form_name  = '120 Months Term Certain and Life Annuity'  FETCH FIRST 1 ROWS only

ace.querySql.AnnuitantBeneInPay1Bulk=SELECT  \
    distinct be.billing_entity_code                  gac,  \
    pbt.internal_name,     be.billing_entity_name,  \
    'Annuitant'                             role,  \
    p.alt_identifier,   \
    mc.member_contract_id,   \
    p.first_name                            first_name,   \
    p.middle_name                           middle_name,  \
    p.last_name                             last_name,   \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',   \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
           p.status)                        life_status,  \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',  \
           'D', 'Disability', 'IP',   \
           'Immediate Pay', 'R',   \
           'Retired',   \
           'S',    \
           'Survivor',   \
           'T',   \
           'Terminated',  \
           'TV',    \
           'Term Vested',    \
           mc.member_contract_status)       employment_status,  \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',  \
           'D', 'Deferred', 'H', 'Hold', 'P',  \
           'Pending',    \
           mc.member_contract_code_01)      pay_status,   \
    pa.pension_effective_date               annuity_commencement_date,   \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',  \
           'S', 'On Hold', 'C', 'Complete', 'QP',  \
           'Queued',  \
           'OF',  \
           'OFAC On Hold',   \
           'AP',   \
           'Approval Pending',  \
           'P',   \
           'Pending',  \
           'DR',  \
           'Draft',   \
           'D',     \
           'Denied',    \
           ds.sched_status)                 status,   \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',   \
           'RE', 'Rejected EFTs',   \
           'PD',     \
           'Presumed Dead',    \
           'D',    \
           'Death',   \
           'DO',   \
           'Death-Overpaid',  \
           'R',  \
           'Reported for Escheatment',   \
           'LH',      \
           'Legal Hold',    \
           'BH',    \
           'Broker Hold',    \
           'O',     \
           'Other',     \
           'W',    \
           'Write Off',     \
           'EX',      \
           'Expired',    \
           'IP',      \
           'Immediate Pay',   \
           'AC',      \
           'Application Cancelled',   \
           'PI',   \
           'Paid in IP',   \
           'AR',    \
           'Approval Reversed',    \
           'IB',    \
           'Ineligible for Benefit',   \
           'IR',      \
           'IP - Revision',   \
           'UL',   \
           'Unable to Locate',  \
           'MR',    \
           'Missing Required Info',   \
           'EL',     \
           'Elimination of Liability Clause',   \
           'RC',   \
           'Remarriage Clause',   \
           'FC',   \
           'Full Commutation',   \
           'PC',  \
           'Partial Commutation',  \
           'CS',  \
           'Child Support Lien Network',  \
           'PQ',  \
           'Pending IPAQS Exclusion Ratio Calc',  \
           'EU',  \
           'Escheating - Uncashed checks',  \
           'ER',  \
           'Escheating - Rejected EFT',  \
           'TE', \
           'Escheated - Terminal Age',  \
           'ED',  \
           'Escheating - Benefit Deferred',  \
           'EB',  \
           'Escheating - Benefit Refused',  \
           'EI',  \
           'Escheating - Insufficient Data',\
           'EN',\
           'Escheating - No Contact',  \
           'EP',  \
           'Escheating - No Response',  \
           'ES',  \
           'Escheating - Death Process',  \
           'EG',  \
           'Escheating - Ret Pkg NIGO',  \
           'ET',  \
           'Escheating - Ret Pkg Not Returned',  \
           'EK',  \
           'Escheating - Client Directed',\
           'EC',  \
           'Escheating - Client Directed',  \
           'FL',  \
           'Failure to Provide Proof of Life',  \
           ds.sched_status_reason_code)     status_reason, \
    pr.short_name, \
    p.death_date                            death_date, \
    p.death_notification_date               death_reporting_date, \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice', \
           'RM', \
           'Returned Mail', \
           'EO', \
           'EDM Other', \
           'OT', \
           'Other', \
           'ES', \
           'EDM SSA/LN',  \
           'DE',  \
           'Data Enrichment',  \
           p.death_notification_source)     death_posted_by,  \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',  \
           mc.benefit_payment_type)         payment_type,  \
    pa.application_id,  \
    pf.payment_form_name, plan_identifier, pl.plan_name \
FROM  \
         dbo.member m \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id   \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id   \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id \
                                  AND be.employer_id = mc.employer_id   \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id \
                                AND pf.selected_flag = 'Y' \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id \
WHERE \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'B' AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    and plan_identifier= '01' \
      AND p.status='L' \
    AND ds.sched_status= 'A' \
  AND  pf.payment_form_name  = '120 Months Term Certain and Life Annuity' \
UNION ALL \
SELECT  \
    pbt.internal_name,  \
    be.billing_entity_code                  gac,    be.billing_entity_name,  \
    er.entity_relationship_name             role, \
    p.alt_identifier,  \
    mc.member_contract_id,  \
    p.first_name                            first_name,  \
    p.middle_name                           middle_name,  \
    p.last_name                             last_name,  \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',  \
           'PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
           p.status)                        life_status,  \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',  \
           'D', 'Disability', 'IP',  \
           'Immediate Pay',  \
           'R',  \
           'Retired',  \
           'S',  \
           'Survivor',  \
           'T',   \
           'Terminated',   \
           'TV',  \
           'Term Vested',   \
           mc.member_contract_status)       employment_status,  \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',  \
           'D', 'Deferred', 'H', 'Hold', 'P',   \
           'Pending',  \
           mc.member_contract_code_01)      pay_status,   \
    pa.pension_effective_date               annuity_commencement_date,  \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',   \
           'S', 'On Hold', 'C', 'Complete', 'QP',  \
           'Queued',  \
           'OF',  \
           'OFAC On Hold',  \
           'AP',  \
           'Approval Pending',  \
           'P',  \
           'Pending',  \
           'DR',  \
           'Draft',  \
           'D',  \
           'Denied',  \
           ds.sched_status)                 status,   \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',   \
           'RE', 'Rejected EFTs',   \
           'PD',   \
           'Presumed Dead',   \
           'D',   \
           'Death',  \
           'DO',  \
           'Death-Overpaid',  \
           'R',   \
           'Reported for Escheatment',  \
           'LH',  \
           'Legal Hold',   \
           'BH',   \
           'Broker Hold',   \
           'O',  \
           'Other',  \
           'W',   \
           'Write Off',  \
           'EX',  \
           'Expired',    \
           'IP',    \
           'Immediate Pay',   \
           'AC',   \
           'Application Cancelled',   \
           'PI',   \
           'Paid in   IP',  'AR',   \
           'Approval Reversed',   \
           'IB',   \
           'Ineligible for Benefit',   \
           'IR',  \
           'IP - Revision',   \
           'UL',   \
           'Unable to Locate',   \
           'MR',  \
           'Missing Required Info',   \
           'EL',   \
           'Elimination of Liability Clause',  \
           'RC',  \
           'Remarriage Clause',  \
           'FC',   \
           'Full Commutation',   \
           'PC',   \
           'Partial Commutation',   \
           'CS',  \
           'Child Support Lien Network',  \
           'PQ',   \
           'Pending IPAQS Exclusion Ratio Calc',   \
           'EU',  \
           'Escheating - Uncashed checks',   \
           'ER',   \
           'Escheating - Rejected EFT',   \
           'TE',   \
           'Escheated - Terminal Age',   \
           'ED',   \
           'Escheating - Benefit Deferred',    \
           'EB',   \
           'Escheating - Benefit Refused',    \
           'EI',   \
           'Escheating - Insufficient Data',    \
           'EN',    \
           'Escheating - No Contact',    \
           'EP',   \
           'Escheating - No Response',   \
           'ES',   \
           'Escheating - Death Process',   \
           'EG',   \
           'Escheating - Ret Pkg NIGO',  \
           'ET',  \
           'Escheating - Ret Pkg Not Returned',   \
           'EK',   \
           'Escheating - Client Directed',   \
           'EC',   \
           'Escheating - Client Directed',   \
           'FL',   \
           'Failure to Provide Proof of Life',   \
           ds.sched_status_reason_code)     status_reason,  \
    pr.short_name,   \
    p.death_date                            death_date,  \
    p.death_notification_date               death_reporting_date,  \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice',   \
           'RM',  \
           'Returned Mail',   \
           'EO',   \
           'EDM Other',  \
           'OT',    \
           'Other',   \
           'ES',   \
           'EDM SSA/LN',   \
           'DE',    \
           'Data Enrichment',   \
           p.death_notification_source)     death_posted_by,   \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',   \
           mc.benefit_payment_type)         payment_type,   \
    pa.application_id,   \
    pf.payment_form_name,plan_identifier, pl.plan_name   \
FROM   \
         dbo.member_contract mc    \
    JOIN dbo.business_entity_relation    ber ON mc.member_contract_id = ber.source_key_value  \
    JOIN dbo.entity_relationship         er ON ber.entity_relationship_id = er.entity_relationship_id   \
    JOIN dbo.business_entity_key         bek ON ber.business_entity_key_id = bek.business_entity_key_id   \
    JOIN dbo.person                      p ON bek.key_value = p.person_id   \
    JOIN dbo.pension_application         pa ON pa.member_contract_id = mc.member_contract_id   \
    JOIN dbo.billing_entity              be ON be.billing_id = mc.billing_id   \
                                  AND be.employer_id = mc.employer_id   \
    JOIN dbo.product                     pr ON pr.product_id = be.product_id   \
    JOIN dbo.product_benefit_type        pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id   \
    JOIN dbo.plan                        pl ON pl.plan_id = mc.plan_id  \
    JOIN dbo.payment_form                pf ON pf.pension_application_id = pa.application_id   \
                                AND pf.selected_flag = 'Y'   \
                                AND pf.master_payment_form_id IS NULL   \
    LEFT JOIN dbo.disburse_schedule           ds ON ds.source_key = pa.application_id   \
WHERE   \
    pbt.internal_name IN ( 'CLOSEOUTS' )   \
    AND mc.member_contract_status NOT IN ( 'TV', 'A' )   \
    AND mc.benefit_payment_type = 'B'   \
    AND mc.member_contract_code_01 = 'D'   \
    AND er.entity_relationship_name ='Beneficiary'   \
    AND ds.sched_status='D'  \
    AND mc.member_contract_code_04='AF'  \
    AND mc.member_contract_code_04!='IP'   \
    and plan_identifier= '01'    \
    AND pf.payment_form_name  = '120 Months Term Certain and Life Annuity'  FETCH FIRST 5 ROWS only


ace.querySql.DeferredBulk=SELECT  \
	distinct be.billing_entity_code                  gac,  \
    pbt.internal_name,  \
    be.billing_entity_name,  \
    'Annuitant'                             role,  \
    p.alt_identifier,  \
    mc.member_contract_id,    \
    p.first_name                            first_name,  \
    p.middle_name                           middle_name,  \
    p.last_name                             last_name,   \
    decode(p.status, 'L', 'Living', 'D', 'Deceased',  'PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
           p.status)                        life_status,  \
    decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee',  \
           'D', 'Disability', 'IP',  \
           'Immediate Pay', \
           'R',  \
           'Retired',  \
           'S',  \
           'Survivor',   \
           'T',  \
           'Terminated',  \
           'TV',  \
           'Term Vested', \
           mc.member_contract_status)       employment_status, \
    decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed',  \
           'D', 'Deferred', 'H', 'Hold', 'P',   \
           'Pending',  \
           mc.member_contract_code_01)      pay_status,  \
    pa.pension_effective_date               annuity_commencement_date,  \
    decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay',  \
           'S', 'On Hold', 'C', 'Complete', 'QP',   \
           'Queued',  \
           'OF',  \
           'OFAC On Hold',  \
           'AP',  \
           'Approval Pending',  \
           'P',  \
           'Pending',  \
           'DR',  \
           'Draft',  \
           'D', \
           'Denied',  \
           ds.sched_status)                 status,  \
    decode(ds.sched_status_reason_code, 'E', 'Escheated', 'UC', 'Uncashed Checks',   \
           'RE', 'Rejected EFTs',  \
           'PD',  \
           'Presumed Dead',  \
           'D',  \
           'Death',  \
           'DO',  \
           'Death-Overpaid',  \
           'R',  \
           'Reported for Escheatment',   \
           'LH',   \
           'Legal Hold',  \
           'BH',  \
           'Broker Hold',  \
           'O',   \
           'Other',  \
           'W',  \
           'Write Off',  \
           'EX', \
           'Expired',   \
           'IP',  \
           'Immediate Pay',  \
           'AC',  \
           'Application Cancelled',  \
           'PI',  \
           'Paid in IP',  \
           'AR',  \
           'Approval Reversed',  \
           'IB',  \
           'Ineligible for Benefit',   \
           'IR',  \
           'IP - Revision',  \
           'UL',  \
           'Unable to Locate',  \
           'MR', \
           'Missing Required Info',   \
           'EL',  \
           'Elimination of Liability Clause',   \
           'RC',   \
           'Remarriage Clause',  \
           'FC',  \
           'Full Commutation',  \
           'PC',  \
           'Partial Commutation',  \
           'CS',  \
           'Child Support Lien Network',  \
           'PQ',  \
           'Pending IPAQS Exclusion Ratio Calc',  \
           'EU',  \
           'Escheating - Uncashed checks',  \
           'ER',  \
           'Escheating - Rejected EFT',  \
           'TE',  \
           'Escheated - Terminal Age',  \
           'ED',  \
           'Escheating - Benefit Deferred',  \
           'EB',  \
           'Escheating - Benefit Refused',  \
           'EI',  \
           'Escheating - Insufficient Data',  \
           'EN',  \
           'Escheating - No Contact',  \
           'EP',  \
           'Escheating - No Response',  \
           'ES', \
           'Escheating - Death Process',   \
           'EG',  \
           'Escheating - Ret Pkg NIGO',  \
           'ET',   \
           'Escheating - Ret Pkg Not Returned', \
           'EK',  \
           'Escheating - Client Directed',  \
           'EC',  \
           'Escheating - Client Directed',   \
           'FL',  \
           'Failure to Provide Proof of Life',  \
           ds.sched_status_reason_code)     status_reason,  \
    pr.short_name,  \
    p.death_date                            death_date,  \
    p.death_notification_date               death_reporting_date,  \
    decode(p.death_notification_source, 'CT', 'Customer Notice', 'CL', 'Client Notice',  \
           'RM',   \
           'Returned Mail',  \
           'EO',  \
           'EDM Other',  \
           'OT',  \
           'Other',  \
           'ES',  \
           'EDM SSA/LN',   \
           'DE',   \
           'Data Enrichment',   \
           p.death_notification_source)     death_posted_by,  \
    decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',  \
           mc.benefit_payment_type)         payment_type,  \
    pa.application_id,  \
    pf.payment_form_name   \
FROM \
         dbo.member m  \
    JOIN dbo.member_contract         mc ON mc.member_id = m.member_id \
    JOIN dbo.person                  p ON p.person_id = m.person_id  \
    JOIN dbo.pension_application     pa ON pa.member_contract_id = mc.member_contract_id  \
    JOIN dbo.billing_entity          be ON be.billing_id = mc.billing_id  \
                                  AND be.employer_id = mc.employer_id   \
    JOIN dbo.product                 pr ON pr.product_id = be.product_id   \
    JOIN dbo.product_benefit_type    pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
    JOIN dbo.plan                    pl ON pl.plan_id = mc.plan_id   \
    JOIN dbo.payment_form            pf ON pf.pension_application_id = pa.application_id  \
                                AND pf.selected_flag = 'Y'  \
                                AND pf.master_payment_form_id IS NULL \
    LEFT JOIN dbo.disburse_schedule       ds ON ds.source_key = pa.application_id  \
WHERE  \
    pbt.internal_name IN ( 'CLOSEOUTS' ) \
    AND mc.member_contract_status  IN ( 'TV', 'A' ) \
    AND mc.benefit_payment_type = 'B' \
    AND mc.member_contract_code_01 = 'D' \
    AND p.status='L' \
    AND p.death_date IS NULL \
    AND p.death_notification_date IS NULL \
    AND p.death_notification_source IS NULL \
    AND mc.member_contract_code_04='AF' \
    AND mc.member_contract_code_04!='IP' \
    AND  pf.payment_form_name NOT IN( 'Life Annuity','120 Months Term Certain and Life Annuity','100 % Joint and Survivor Life Annuity', '50 % Joint and Survivor Life Annuity') ORDER BY DBMS_RANDOM.value FETCH FIRST 1 ROWS only 

ace.querySql.FactoringaltBene=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
INNER JOIN dbo.court_order co \
ON co.pension_application_id = pa.application_id \
inner join dbo.beneficiary b on b.person_id=p.person_id \
inner join entity_relationship er on er.ENTITY_RELATIONSHIP_ID=b.ENTITY_RELATIONSHIP_ID \
WHERE \
ds.sched_status='A' \
AND er.internal_name like ('%BENEFICIARY%') \
AND ps.status_name like '%Case Activated%' \
AND co.split_type is not null \
AND pbt.internal_name IN ?1 \
FETCH FIRST 1 ROWS ONLY

ace.querySql.MedicalUnionDentalaltannuitant=SELECT DISTINCT P.ALT_IDENTIFIER \
FROM DBO.PERSON P INNER JOIN \
DBO.MEMBER M  ON M.PERSON_ID=P.PERSON_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN disburse_schedule ds ON ds.person_id=P.person_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE PBT.INTERNAL_NAME=?1 \
AND ds.sched_status='A' \
AND PS.STATUS_ID=199 \
AND BE.BILLING_ENTITY_CODE = '000039199' \
AND P.ALT_IDENTIFIER NOT IN (SELECT DISTINCT P.ALT_IDENTIFIER FROM DBO.PERSON P \
INNER JOIN disburse_schedule ds ON ds.person_id=P.person_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
AND DTD.DEDUCTION_TYPE <> 'F') \
FETCH FIRST 1 ROWS ONLY \
  
ace.querySql.MedicalUnionDentalaltJointannuitant=SELECT P_REL.ALT_IDENTIFIER \
FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
AND BER.ENTITY_ID = 254 \
AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
AND BER.KEY_VALUE = P.PERSON_ID \
WHERE BE.BILLING_ENTITY_CODE='000039199' \
and PBT.internal_name = ?1 \
AND ds.sched_status='A' \
AND PS.STATUS_ID=199 \
AND ER.INTERNAL_NAME like '%JOINT_ANNUITANT%' \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('D0', \
'D1', \
'D2', \
'D3', \
'D7', \
'DI', \
'L0', \
'L1', \
'L2', \
'L3', \
'L8', \
'L9', \
'LF', \
'M0', \
'M1', \
'M2', \
'M6', \
'MI', \
'MJ', \
'U0', \
'U2', \
'UD') \
) \
FETCH FIRST 1 ROWS ONLY \
  
ace.querySql.MedicalUnionDentalaltBeneannuitant=SELECT P_REL.ALT_IDENTIFIER \
FROM DBO.PERSON P_REL \
INNER JOIN DBO.BUSINESS_ENTITY_RELATION BER ON P_REL.BUSINESS_ENTITY_KEY_ID = BER.BUSINESS_ENTITY_KEY_ID \
AND BER.ENTITY_ID = 254 \
AND BER.SOURCE_ENTITY_ID = 798 \
INNER JOIN DBO.ENTITY_RELATIONSHIP ER ON BER.ENTITY_RELATIONSHIP_ID = ER.ENTITY_RELATIONSHIP_ID \
INNER JOIN DBO.MEMBER_CONTRACT MC ON BER.SOURCE_KEY_VALUE = MC.MEMBER_CONTRACT_ID \
INNER JOIN BILLING_ENTITY BE ON  MC.BILLING_ID = BE.BILLING_ID \
INNER JOIN DBO.PRODUCT PT ON BE.PRODUCT_ID=PT.PRODUCT_ID \
INNER JOIN DBO.PRODUCT_BENEFIT_TYPE PBT ON PT.PRODUCT_BENEFIT_TYPE_ID=PBT.PRODUCT_BENEFIT_TYPE_ID \
INNER JOIN DBO.PENSION_APPLICATION PA ON PA.MEMBER_CONTRACT_ID = MC.MEMBER_CONTRACT_ID \
inner join dbo.payment_form pf on pf.pension_application_id=pa.application_id \
INNER JOIN DBO.PENSION_STATUS PS ON PA.STATUS_ID=PS.STATUS_ID \
INNER JOIN DBO.disburse_schedule ds ON DS.SOURCE_ENTITY = 350 \
AND DS.SOURCE_KEY = PA.APPLICATION_ID \
INNER JOIN DBO.MEMBER M ON M.MEMBER_ID=MC.MEMBER_ID \
INNER JOIN DBO.PERSON P ON M.PERSON_ID=P.PERSON_ID \
AND BER.KEY_VALUE = P.PERSON_ID \
WHERE BE.BILLING_ENTITY_CODE='000039199' \
and PBT.internal_name = ?1 \
AND ds.sched_status='A' \
AND PS.STATUS_ID=199 \
AND ER.INTERNAL_NAME like '%BENEFICIARY%' \
and NOT EXISTS ( \
SELECT DISTINCT PER.ALT_IDENTIFIER FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT \
ON ds.disbursement_schedule_id=dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD \
ON DT.DEDUCTION_TEMPLATE_ID=DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN \
('D0', \
'D1', \
'D2', \
'D3', \
'D7', \
'DI', \
'L0', \
'L1', \
'L2', \
'L3', \
'L8', \
'L9', \
'LF', \
'M0', \
'M1', \
'M2', \
'M6', \
'MI', \
'MJ', \
'U0', \
'U2', \
'UD') \
) \
FETCH FIRST 1 ROWS ONLY \

ace.querySql.RETIREMENTPACKAGEMCRTCJS_13=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='1748360416'

ace.querySql.SSADeathMatchLetterUSLivingv2 = SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v  \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE  \
and v.alt_identifier = bek.alt_key_code  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id  \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N'  \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id  \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id  \
inner join  dbo.BENEFIT_ACCOUNT BA on DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
  inner join dbo.billing_entity be on be.billing_id = mc.billing_id  \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id  \
inner join dbo.pension_status ps on ps.status_id = pa.status_id  \
and ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED')  \
inner join dbo.addresses a on v.person_id=a.key_value and a.country = 'US' and a.stop_date is null \
and a.address_type='R'  \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'STRUCTURED'  \
and p.primary_identifier_id !=40 \
  and v.status='L'


ace.querySql.IIADeathMatchLetterUSLivingv2 = SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v  \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE  \
and v.alt_identifier = bek.alt_key_code  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id  \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N'  \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id  \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id  \
inner join  dbo.BENEFIT_ACCOUNT BA on DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
  inner join dbo.billing_entity be on be.billing_id = mc.billing_id  \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id  \
inner join dbo.pension_status ps on ps.status_id = pa.status_id  \
and ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED')  \
inner join dbo.addresses a on v.person_id=a.key_value and a.country = 'US' and a.stop_date is null \
and a.address_type='R'  \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'IIA'  \
and p.primary_identifier_id !=40 \
  and v.status='L'


ace.querySql.CODeathMatchLetterUSLivingv2 = SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v  \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE  \
and v.alt_identifier = bek.alt_key_code  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id  \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID  \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' AND NVL (PA.CANCELLED_FLAG, 'N') = 'N'  \
JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id  \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded on ded.disbursement_schedule_id=ds.disbursement_schedule_id  \
inner join  dbo.BENEFIT_ACCOUNT BA on DS.BENEFIT_ACCOUNT_ID = BA.BENEFIT_ACCOUNT_ID \
  inner join dbo.billing_entity be on be.billing_id = mc.billing_id  \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id  \
inner join dbo.pension_status ps on ps.status_id = pa.status_id  \
and ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED')  \
inner join dbo.addresses a on v.person_id=a.key_value and a.country = 'US' and a.stop_date is null \
and a.address_type='R'  \
LEFT JOIN dbo.product pr ON pbt.product_benefit_type_id = pr.product_benefit_type_id  \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
where pbt.internal_name = 'CLOSEOUTS'  \
and p.primary_identifier_id !=40 \
  and v.status='L'

ace.querySql.RETIREMENTPACKAGETLA=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='7098952298' \

ace.querySql.BeneconfirmSSANONUS1=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='4565077847' \

ace.querySql.AddresschangeSSANONUS=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='2272659650' \
  
ace.querySql.OVERPAYMENTFULLFILLMENTTC01=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='2500565394' \ 

ace.querySql.OVERPAYMENTFULLFILLMENTTC02=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='7575767535' \ 

ace.querySql.OVERPAYMENTFULLFILLMENTTC03 = select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='1076622450'


ace.querySql.SSANAMECHANGELETTERTC02=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
and p.primary_identifier_id !=40 \
  and dedt.zero_deduction_flag='N' \
  AND NOT EXISTS (SELECT DISTINCT PER.ALT_IDENTIFIER \
  FROM DBO.PERSON PER \
  INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
  INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
  WHERE DTD.DEDUCTION_TYPE IN ('ST')) \
  AND p.citizenship_country_id is not null

ace.querySql.CONAMECHANGELETTERTC03=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'IIA' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
and  BA.NON_TAXABLE_FLAG is null \
and p.primary_identifier_id !=40 \
  and dedt.zero_deduction_flag='N' \
  AND NOT EXISTS (SELECT DISTINCT PER.ALT_IDENTIFIER \
  FROM DBO.PERSON PER \
  INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
  INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
  WHERE DTD.DEDUCTION_TYPE IN ('ST')) \
  AND p.citizenship_country_id is not null

ace.querySql.IAWELCOMECERTPKGCGA=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='9575161683' \

ace.querySql.IAWELCOMECERTPKGMGIP=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='6277741488' \
  
ace.querySql.CitizenshipDeclarationPackageSSACAUSLivingv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
 inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country !='US' and a.stop_date is null and a.address_type='R' \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
AND mc.member_contract_status!='IP'\
and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='N' \
  AND NOT EXISTS (SELECT DISTINCT PER.ALT_IDENTIFIER \
FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN ('ST')) \
AND p.citizenship_country_id is not null

ace.querySql.CitizenshipDeclarationPackageCOCAUSLivingv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'CLOSEOUTS' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
  AND BE.billing_entity_code = '000039055' \
and v.status='L' \
and  BA.NON_TAXABLE_FLAG is null \
AND mc.member_contract_status!='IP'\
  and p.primary_identifier_id !=40 \
and dedt.zero_deduction_flag='N' \
  AND NOT EXISTS (SELECT DISTINCT PER.ALT_IDENTIFIER \
FROM DBO.PERSON PER \
INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
WHERE DTD.DEDUCTION_TYPE IN ('ST') \
AND DTD.deduction_type IN ( 'DI', 'M0', 'D0', 'D1', \
'ST', 'NR', 'FI', 'LF', \
'M6', 'D3', 'FL', 'CT', \
'L3', 'D4', 'UD', 'FC', \
'L0', 'M2', 'SS', 'MI', \
'L9', 'MJ', 'U0', 'U1', \
'D7', 'L1', 'IL', 'M1', \
'IT', 'L8', 'SL', '1M', \
'OR', 'LT', 'BK', 'L2', \
'D2', 'U2', 'CS' )) \
AND p.citizenship_country_id is not null


ace.querySql.CitizenshipDeclarationPackageLivingIIANONUSv2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country !='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'IIA' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
and  BA.NON_TAXABLE_FLAG is null \
and p.primary_identifier_id !=40 \
  and dedt.zero_deduction_flag='N' \
  AND NOT EXISTS (SELECT DISTINCT PER.ALT_IDENTIFIER \
  FROM DBO.PERSON PER \
  INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
  INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
  WHERE DTD.DEDUCTION_TYPE IN ('ST')) \
  AND p.citizenship_country_id is not null

ace.querySql.ValidationofPaymentFollowupLetterssa2=SELECT distinct v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v \
inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
inner join dbo.person p on v.person_id=p.person_id and v.alt_identifier = bek.alt_key_code \
inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID AND pa.estimate_flag = 'N' \
AND pa.parent_application_id IS NULL AND PA.APPROVED_FLAG = 'Y' \
AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') and pa.application_id = ds.source_key \
inner join dbo.deduction_template ded \
inner join dbo.deduction_template_detail dedt on ded.deduction_template_id=dedt.deduction_template_id                on ded.disbursement_schedule_id=ds.disbursement_schedule_id \
inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
inner join dbo.pension_status ps on ps.status_id = pa.status_id AND ps.pension_status_code NOT IN ('SS_CANCELLED',  'SS_NOT_TAKEN',  'SS_UNLOCKED') \
inner join dbo.addresses a on v.person_id=a.key_value and a.country ='US' and a.stop_date is null and a.address_type='R' \
inner join dbo.benefit_account ba on ba.benefit_account_id=ded.benefit_account_id \
where pbt.internal_name = 'STRUCTURED' \
and ds.sched_status <> 'C' \
and ds.schedule_type = 'R' \
and v.status='L' \
and p.primary_identifier_id !=40 \
  and dedt.zero_deduction_flag='N' \
  AND NOT EXISTS (SELECT DISTINCT PER.ALT_IDENTIFIER \
  FROM DBO.PERSON PER \
  INNER JOIN DBO.DEDUCTION_TEMPLATE DT ON ds.disbursement_schedule_id = dt.disbursement_schedule_id \
  INNER JOIN DBO.DEDUCTION_TEMPLATE_DETAIL DTD ON DT.DEDUCTION_TEMPLATE_ID = DTD.DEDUCTION_TEMPLATE_ID \
  WHERE DTD.DEDUCTION_TYPE IN ('ST')) \
  AND p.citizenship_country_id is not null \
  
ace.querySql.PaymentMethodCNGWIREtoEFTMGIP=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%MGIP%') \
AND ds.next_disb_type='W' \
ORDER BY dbms_random.random \
fetch first 1 row only \
  
ace.querySql.PaymentMethodCNGWIREtoEFTMGIPJoint=SELECT distinct \
p.alt_identifier AS joint_alt_id \
FROM   dbo.person p \
INNER JOIN business_entity_relation BER \
ON BER.business_entity_key_id = p.business_entity_key_id \
INNER JOIN entity_relationship ER \
ON ER.entity_relationship_id = BER.entity_relationship_id \
INNER JOIN member_contract mc \
ON mc.member_contract_id = ber.source_key_value \
AND BER.source_entity_id = 798 \
INNER JOIN person a \
ON a.person_id = ber.key_value \
AND ber.entity_id = 254 \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN disburse_schedule ds \
ON ds.person_id=p.person_id \
INNER JOIN eft_authorization eft \
ON eft.recipient_key_value=p.person_id and eft.recipient_entity_id=254 \
WHERE  er.internal_name = 'JOINT_ANNUITANT' \
AND a.status='D' \
AND p.status = 'L' \
AND ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND ds.next_pay_end_date is not null \
AND pbt.internal_name IN ( 'IIA' ) \
AND pdt.long_name like ('%MGIP%') \
AND ds.next_disb_type='W' \
ORDER BY dbms_random.random \
fetch first 1 row only \
  
ace.querySql.ChecktoEFTMGIP=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name like '%Case Activated%' \
AND pbt.internal_name IN ('IIA') \
AND pdt.long_name like ('%MGIP%') \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
fetch first 1 row only \
  
ace.querySql.ChecktoEFTCO=SELECT distinct p.alt_identifier           AS Alt_Id \
FROM   person p \
INNER JOIN member m \
ON m.person_id = p.person_id \
INNER JOIN pension_application pa \
ON p.person_id=pa.person_id \
INNER JOIN pension_status ps \
ON ps.status_id = pa.status_id \
INNER JOIN disburse_schedule ds \
ON DS.SOURCE_KEY = PA.APPLICATION_ID \
AND DS.SOURCE_ENTITY = 350 \
INNER JOIN payment_form pf \
ON pf.payment_form_id=ds.payment_form_id \
INNER JOIN member_contract mc \
ON mc.member_id = m.member_id \
INNER JOIN billing_entity be \
ON mc.billing_id = be.billing_id \
INNER JOIN product pdt \
ON pdt.product_id = be.product_id \
INNER JOIN product_benefit_type pbt \
ON pbt.product_benefit_type_id = pdt.product_benefit_type_id \
INNER JOIN dbo.deduction_template DT \
ON DT.disbursement_schedule_id = ds.disbursement_schedule_id \
INNER JOIN dbo.deduction_template_detail DTD \
ON DT.deduction_template_id = DTD.deduction_template_id \
INNER JOIN dbo.deduction_type DED_TYPE \
ON DED_TYPE.deduction_type = DTD.deduction_type \
WHERE \
ds.sched_status='A' \
AND ps.status_name LIKE '%Approved%' \
AND pbt.internal_name IN ('CLOSEOUTS') \
AND ds.next_disb_type='C' \
ORDER BY dbms_random.random \
fetch first 1 row only

ace.querySql.OVERPAYMENTFULLFILLMENTTC04 = select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='3856058852'

 ace.querySql.IAWELCOMECERTPKGLA=select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='8813346845' \

ace.querySql.NonTaxIIALOUS = SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
              and v.alt_identifier = bek.alt_key_code \
              inner join dbo.person p on v.person_id=p.person_id \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
              AND pa.estimate_flag = 'N' \
              AND pa.parent_application_id IS NULL \
              AND PA.APPROVED_FLAG = 'Y' \
              AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
              and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              LEFT JOIN DBO.BILLING_ENTITY BIL ON MC.BILLING_ID= BIL.BILLING_ID \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
              AND ps.pension_status_code NOT IN ('SS_CANCELLED','SS_NOT_TAKEN','SS_UNLOCKED') \
              inner join dbo.addresses a on v.person_id=a.key_value \
              and a.country = 'US' \
              and a.stop_date is null \
              and a.address_type='R' \
              where pbt.INTERNAL_NAME='LOTTERIES' \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' \
              and p.primary_identifier_id !=40 \
              and a.address_3 is null \
              and v.status='L' \
		      and v.PREFIX is null \
			  and v.SUFFIX is null \
			  and v.SORT_NAME NOT LIKE '%-%' \
			  and v.SORT_NAME NOT LIKE '%'||chr(39)||'%' \
              and v.status='L' \
			  
			  
ace.querySql.AnnuitantwithBeneasIndiviual =  SELECT  distinct v.alt_identifier,v.first_name,v.last_name \
              from   dbo.V_ANNUITANT v \
              inner join dbo.business_entity_key bek on v.person_id = bek.KEY_VALUE \
                    and v.alt_identifier = bek.alt_key_code \
                   inner join dbo.person p on v.person_id=p.person_id \
              inner join dbo.business_entity_relation ber on ber.associated_bek_id=bek.business_entity_key_id and ber.entity_id=254 and ber.entity_id=254 and ber.entity_id !=1146 \
              inner join dbo.entity_relationship er on ber.entity_relationship_id=er.entity_relationship_id \
              and er.entity_relationship_name = 'Beneficiary' \
              inner join dbo.MEMBER_CONTRACT mc on v.MEMBER_ID = mc.MEMBER_ID \
              inner join dbo.pension_application pa on mc.MEMBER_CONTRACT_ID = pa.MEMBER_CONTRACT_ID \
                    AND pa.estimate_flag = 'N' \
                    AND pa.parent_application_id IS NULL \
                    AND PA.APPROVED_FLAG = 'Y' \
                    AND NVL (PA.CANCELLED_FLAG, 'N') = 'N' \
              inner join dbo.disburse_schedule ds on ds.source_entity = dbo.pkg_benefit_s.f_get_entity_id('PENSION_APPLICATION') \
                    and pa.application_id = ds.source_key \
              inner join dbo.billing_entity be on be.billing_id = mc.billing_id \
              inner join dbo.product_benefit_type pbt on be.product_benefit_type_id = pbt.product_benefit_type_id \
              inner join dbo.pension_status ps on ps.status_id = pa.status_id \
              AND ps.pension_status_code NOT IN ('IIA_CANCELLED','IIA_NOT_TAKEN','IIA_UNLOCKED') \
            inner join dbo.addresses a on v.person_id=a.key_value \
                    and a.country != 'US' \
                    and a.stop_date is null \
                    and a.address_type='R' \
              where pbt.internal_name = 'IIA' \
               and bek.search_text_02 is null \
              and ds.sched_status <> 'C' \
              and ds.schedule_type = 'R' \
              and a.address_attention is null \
                            and a.address_3 is null \
                            and p.primary_identifier_id !=40 \
                            and a.address_2 is null \
                            and p.citizenship_country_id is not null \
              and v.status='L' \
              ORDER BY dbms_random.random \
              fetch first 1 row only \


ace.querySql.AnnuitantwithJoint=SELECT   \
a.alt_identifier    AS annuitant_alt_id,   \
p.alt_identifier    AS secondary_alt_id,    \
pdt.long_name       AS product_name       \
FROM   \
dbo.person p   \
INNER JOIN business_entity_relation  ber ON ber.business_entity_key_id = p.business_entity_key_id   \
INNER JOIN entity_relationship       er ON er.entity_relationship_id = ber.entity_relationship_id   \
INNER JOIN member_contract           mc ON mc.member_contract_id = ber.source_key_value      \
AND ber.source_entity_id = 798   \
INNER JOIN pension_application       pa ON pa.member_id = mc.member_id   \
INNER JOIN person                      a ON a.person_id = ber.key_value    \
AND ber.entity_id = 254   \
INNER JOIN billing_entity            be ON mc.billing_id = be.billing_id   \
INNER JOIN product                   pdt ON pdt.product_id = be.product_id   \
INNER JOIN product_benefit_type      pbt ON pbt.product_benefit_type_id = pdt.product_benefit_type_id  \
WHERE   \
er.internal_name = 'JOINT_ANNUITANT'  \
AND mc.member_contract_code_01 = 'C'    \
AND pdt.short_name LIKE '%MLIC%'    \
AND pa.status_id = 133  \
  ORDER BY dbms_random.random \
              fetch first 1 row only \  


ace.querySql.BulkCheckInPayLife= SELECT distinct  be.billing_entity_code gac,pbt.internal_name,be.billing_entity_name,'Annuitant'   \
role,p.alt_identifier,mc.member_contract_id,p.first_name first_name,p.middle_name middle_name,p.last_name last_name,  \
decode(p.status, 'L', 'Living', 'D', 'Deceased','PD', 'Presumed Deceased', 'IR', 'Invalid Record',  \
 p.status) life_status,  \
decode(mc.member_contract_status, 'A', 'Active', 'AP', 'Alternate Payee','D', 'Disability', 'IP',  \
'Immediate Pay','R','Retired', 'S','Survivor','T','Terminated', 'TV','Term Vested',mc.member_contract_status)employment_status,  \
decode(mc.member_contract_code_01, 'IP', 'In Pay', 'C', 'Completed','D', 'Deferred', 'H', 'Hold', 'P','Pending',mc.member_contract_code_01)  \
pay_status,pa.pension_effective_date annuity_commencement_date,decode(ds.sched_status, 'V', 'Void', 'A', 'In Pay','S', 'On Hold',   \
 'C', 'Complete', 'QP','Queued','OF','OFAC On Hold','AP','Approval Pending','P','Pending','DR','Draft','D','Denied',ds.sched_status) status,  \
decode(mc.benefit_payment_type, 'D', 'DIRECT PAYMENT', 'B', 'BULK CHECK',mc.benefit_payment_type)payment_type,pa.application_id,pf.payment_form_name, plan_identifier, pl.plan_name, mc.member_contract_code_04 \
FROM dbo.member m  \
INNER JOIN dbo.member_contract mc ON mc.member_id = m.member_id JOIN dbo.person p ON p.person_id = m.person_id JOIN dbo.pension_application pa ON pa.member_contract_id = mc.member_contract_id JOIN dbo.billing_entity be ON be.billing_id = mc.billing_id  \
AND be.employer_id = mc.employer_id JOIN dbo.product pr ON pr.product_id = be.product_id JOIN dbo.product_benefit_type pbt ON pbt.product_benefit_type_id = pr.product_benefit_type_id JOIN dbo.plan pl ON pl.plan_id = mc.plan_id JOIN dbo.payment_form pf ON pf.pension_application_id = pa.application_id AND pf.selected_flag = 'Y' AND pf.master_payment_form_id IS NULL LEFT JOIN dbo.disburse_schedule ds ON ds.source_key = pa.application_id  \
WHERE  \
pbt.internal_name IN ( 'CLOSEOUTS' ) AND mc.member_contract_status NOT IN ('TV' ,'A' ) AND mc.benefit_payment_type = 'B' AND mc.member_contract_code_01 = 'IP' AND p.status='L' AND ds.sched_status= 'A' and plan_identifier= '01' AND mc.member_contract_status! = 'IP'  \
And mc.member_contract_payment_status != 'IM' AND pf.payment_form_name= 'Life Annuity' AND mc.member_contract_code_04='AF' ORDER BY DBMS_RANDOM.value FETCH FIRST 1 ROWS only			  

ace.querySql.IAINCOMEVERIIAUS = select distinct  v.alt_identifier,v.first_name,v.last_name \
from dbo.V_ANNUITANT v where v.alt_identifier ='7634167590'

